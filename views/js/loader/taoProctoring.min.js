(function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function loadController(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function startController(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function loadBundles(bundles){bundles=bundles||[],bundles=bundles.concat(window.bundles),bundles=bundles.filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})})(),define("loader/bootstrap",function(){}),define("taoProctoring/controller/app",["lodash","controller/app","core/dataProvider/request","ui/container","ui/breadcrumbs","util/url"],function(_,appController,request,containerFactory,breadcrumbsFactory,urlHelper){"use strict";function getRoutes(route){var routes=[],parsed=urlHelper.parse(route);return _.forEach(knownRoutes,function(knownRoute){var url=urlHelper.parse(knownRoute.url),params={};return parsed.path===url.path?(routes.push(route),!1):void(_.forEach(knownRoute.params,function(param){parsed.query[param]&&(params[param]=decodeURIComponent(parsed.query[param]))}),routes.push(urlHelper.build(knownRoute.url,params)))}),routes}var breadcrumbsUrl=urlHelper.route("load","Breadcrumbs","tao"),indexUrl=urlHelper.route("index","DeliverySelection","taoProctoring"),monitorUrl=urlHelper.route("index","Monitor","taoProctoring"),historyUrl=urlHelper.route("index","Reporting","taoProctoring"),knownRoutes=[{url:indexUrl,params:["context"]},{url:monitorUrl,params:["delivery","context"]},{url:historyUrl,params:["delivery","session","context"]}];return _.defaults({start:function start(){var toolbox=containerFactory(".header"),breadcrumbs=breadcrumbsFactory({renderTo:toolbox.getElement(),replace:!0,cls:"action-bar horizontal-action-bar"});appController.on("change.breadcrumbs",function(route){var parsedRoute=urlHelper.parse(route),routes=getRoutes(route);parsedRoute.query["link-type"]!==void 0&&"direct"===parsedRoute.query["link-type"]?(delete parsedRoute.query["link-type"],window.location.replace(decodeURIComponent(urlHelper.build(parsedRoute.path,parsedRoute.query)))):request(breadcrumbsUrl,{route:routes},"POST").then(function(data){breadcrumbs.update(data)}).catch(function(err){appController.onError(err)})}).apply("a",toolbox.getElement()).start()}},appController)}),define("taoProctoring/helper/status",["lodash","i18n"],function(_,__){"use strict";function canAddExtraTime(delivery){return 0<delivery.timer.remaining_time||__("test has no time limits")}function getStatus(statusName){return _status[statusName]}function getStatusByCode(statusCode){return _.find(_status,{code:statusCode})}function verifyTestTaker(testTakerData,actionName){var formatted={id:testTakerData.id,label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(testTakerData.state.status);return status&&(formatted.allowed=!0===status.can[actionName],!formatted.allowed&&(formatted.reason=status.can[actionName])),formatted}function getStatuses(){return _.map(_status,function(el){return{code:el.code,label:el.label}})}function buildWarningMessage(action,selection,deniedResources){var warningAction,warningReason,isPlural=1<selection.length,maxReasons=2,warningOmission=__("...");return deniedResources=deniedResources||[{}],warningAction="authorize"===action?isPlural?__("Cannot authorize test sessions."):__("Cannot authorize test session."):"pause"===action?isPlural?__("Cannot pause test sessions."):__("Cannot pause test session."):"terminate"===action?isPlural?__("Cannot terminate test sessions."):__("Cannot terminate test session."):"reactivate"===action?isPlural?__("Cannot reactivate test sessions."):__("Cannot reactivate test session."):"report"===action?isPlural?__("Cannot report test sessions."):__("Cannot report test session."):"print"===action?isPlural?__("Cannot print test sessions."):__("Cannot print test session."):"time"===action?isPlural?__("Cannot extend test sessions."):__("Cannot extend test session."):__("Cannot execute action."),(warningReason=_(deniedResources).slice(0,maxReasons).map(function(deniedResource){return deniedResource.warning}).join(" "),deniedResources.length>maxReasons&&(warningReason+=warningOmission),warningAction+" "+warningReason)}var _awaiting="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAwaiting",_authorized="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAuthorized",_inprogress="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusActive",_paused="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusPaused",_completed="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusFinished",_terminated="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusTerminated",_canceled="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusCanceled",_status={inprogress:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusActive",label:__("In Progress"),can:{authorize:__("already authorized"),pause:!0,terminate:!0,report:!0,print:__("not finished"),reactivate:__("not terminated"),time:canAddExtraTime,changeTime:__("in progress")},warning:{authorize:function(username,testId){return testId?__("Test %s had already been authorized.",testId):username?__("%s's test had already been authorized.",username):__("Test had already been authorized.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},authorized:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAuthorized",label:__("Authorized but not started"),can:{authorize:__("already authorized"),terminate:!0,report:!0,pause:__("not started"),print:__("not finished"),reactivate:__("not terminated"),time:canAddExtraTime,changeTime:__("authorized but not started")},warning:{authorize:function(username,testId){return testId?__("Test %s had already been authorized.",testId):username?__("%s's test had already been authorized.",username):__("Test had already been authorized.")},pause:function(username,testId){return testId?__("Test %s had not been started.",testId):username?__("%s's test had not been started.",username):__("Test had not been started.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},awaiting:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAwaiting",label:__("Awaiting"),can:{authorize:!0,pause:__("not in progress"),terminate:!0,reactivate:__("not terminated"),report:!0,print:__("not finished"),time:canAddExtraTime,changeTime:__("awaiting")},warning:{pause:function(username,testId){return testId?__("Test %s had not been in progress.",testId):username?__("%s's test had not been in progress.",username):__("Test had not been in progress.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},canceled:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusCanceled",label:__("Canceled"),can:{authorize:__("canceled"),pause:__("canceled"),terminate:__("canceled"),reactivate:__("not terminated"),report:!0,print:__("canceled"),time:__("canceled"),changeTime:__("canceled")},warning:{authorize:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},pause:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},terminate:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},reactivate:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},print:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")}}},completed:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusFinished",label:__("Completed"),can:{authorize:__("completed"),pause:__("completed"),terminate:__("completed"),reactivate:__("not terminated"),report:!0,print:!0,time:__("completed"),changeTime:__("completed")},warning:{authorize:function(username,testId){return testId?__("Test %s had been completed.",testId):username?__("%s's test had been completed.",username):__("Test had been completed.")},pause:function(username,testId){return testId?__("Test %s had been completed.",testId):username?__("%s's test had been completed.",username):__("Test had been completed.")},terminate:function(username,testId){return testId?__("Test %s had been completed.",testId):username?__("%s's test had been completed.",username):__("Test had been completed.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},paused:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusPaused",label:__("Paused"),can:{authorize:__("paused"),pause:__("already paused"),reactivate:__("not terminated"),terminate:!0,report:!0,print:__("not finished"),time:canAddExtraTime,changeTime:__("paused")},warning:{authorize:function(username,testId){return testId?__("Test %s had been paused.",testId):username?__("%s's test had been paused.",username):__("Test had been paused.")},pause:function(username,testId){return testId?__("Test %s had already been paused.",testId):username?__("%s's test had already been paused.",username):__("Test had already been paused.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},terminated:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusTerminated",label:__("Terminated"),can:{authorize:__("terminated"),pause:__("terminated"),terminate:__("already terminated"),report:!0,reactivate:!0,print:!0,time:__("terminated"),changeTime:__("terminated")},warning:{authorize:function(username,testId){return testId?__("Test %s had been terminated.",testId):username?__("%s's test had been terminated.",username):__("Test had been terminated.")},pause:function(username,testId){return testId?__("Test %s had been terminated.",testId):username?__("%s's test had been terminated.",username):__("Test had been terminated.")},terminate:function(username,testId){return testId?__("Test %s had already been terminated.",testId):username?__("%s's test had already been terminated.",username):__("Test had alredy been terminated.")}}}};return{buildWarningMessage:buildWarningMessage,getStatuses:getStatuses,getStatus:getStatus,getStatusByCode:getStatusByCode,verifyTestTaker:verifyTestTaker,STATUS_AUTHORIZED:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAuthorized",STATUS_INPROGRESS:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusActive",STATUS_PAUSED:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusPaused",STATUS_COMPLETED:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusFinished",STATUS_TERMINATED:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusTerminated"}}),define("taoProctoring/component/proxy",["core/dataProvider/proxy","core/dataProvider/proxy/ajax"],function(proxyFactory,ajaxProxy){"use strict";return proxyFactory.registerProvider("ajax",ajaxProxy)}),define("tpl!taoProctoring/templates/delivery/index",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<h1>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:21},end:{line:2,column:30}}}):helper))+"</h1>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"content\">\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"title"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:4},end:{line:2,column:42}}}))?"":stack1)+"\n    <div class=\"panel\"></div>\n    <div class=\"list clearfix\"></div>\n</div>"},useData:!0})}),define("tpl!taoProctoring/templates/delivery/listBoxActions",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"listbox-actions\">\n    <span class=\"action pause\" data-delivery=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:2,column:46},end:{line:2,column:52}}}):helper))+"\">\n        <span class=\"icon-pause\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Pause",{name:"__",hash:{},data:data,loc:{start:{line:3,column:40},end:{line:3,column:54}}}))+"\n    </span>\n    <span class=\"action play\">\n        <span class=\"icon-play\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Monitor",{name:"__",hash:{},data:data,loc:{start:{line:6,column:39},end:{line:6,column:55}}}))+"\n    </span>\n</span>"},useData:!0})}),define("tpl!taoProctoring/templates/delivery/listBoxStats",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<ul class=\"plain listbox-properties\">\n    <li>\n        <label>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Start",{name:"__",hash:{},data:data,loc:{start:{line:4,column:15},end:{line:4,column:29}}}))+"</label>: "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"periodStart")||(null==depth0?depth0:lookupProperty(depth0,"periodStart")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"periodStart",hash:{},data:data,loc:{start:{line:4,column:39},end:{line:4,column:54}}}):helper))+"\n    </li>\n    <li>\n        <label>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"End",{name:"__",hash:{},data:data,loc:{start:{line:7,column:15},end:{line:7,column:27}}}))+"</label>: "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"periodEnd")||(null==depth0?depth0:lookupProperty(depth0,"periodEnd")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"periodEnd",hash:{},data:data,loc:{start:{line:7,column:37},end:{line:7,column:50}}}):helper))+"\n    </li>\n</ul>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"showProperties"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:1,column:0},end:{line:10,column:7}}}))?"":stack1)+"<p class=\"listbox-stats\">\n    <span class=\"icon-lock\"></span><span class=\"number\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"locked")||(null==depth0?depth0:lookupProperty(depth0,"locked")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"locked",hash:{},data:data,loc:{start:{line:12,column:56},end:{line:12,column:66}}}):helper))+"</span>\n    <span class=\"icon-play\"></span><span class=\"number\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"inProgress")||(null==depth0?depth0:lookupProperty(depth0,"inProgress")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"inProgress",hash:{},data:data,loc:{start:{line:13,column:56},end:{line:13,column:70}}}):helper))+"</span>\n    <span class=\"icon-pause\"></span><span class=\"number\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"paused")||(null==depth0?depth0:lookupProperty(depth0,"paused")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"paused",hash:{},data:data,loc:{start:{line:14,column:57},end:{line:14,column:67}}}):helper))+"</span>\n</p>"},useData:!0})}),define("taoProctoring/controller/Delivery/index",["jquery","lodash","i18n","module","core/promise","controller/app","util/url","layout/loading-bar","ui/listbox","util/encode","ui/feedback","ui/bulkActionPopup","ui/cascadingComboBox","ui/container","taoProctoring/helper/status","taoProctoring/component/proxy","tpl!taoProctoring/templates/delivery/index","tpl!taoProctoring/templates/delivery/listBoxActions","tpl!taoProctoring/templates/delivery/listBoxStats","util/locale"],function($,_,__,module,Promise,appController,urlHelper,loadingBar,listBoxFactory,encode,feedback,bulkActionPopup,cascadingComboBox,containerFactory,_status,proxyFactory,indexTpl,actionsTpl,statsTpl,locale){"use strict";function getSessionsNames(sessions){return _.map(sessions,function(session){return{id:session.id,label:session.delivery.label+" ["+locale.formatDateTime(session.start_time)+"]"}})}function validateParams(params){return _.isPlainObject(params)&&(_.isUndefined(params.delivery)||!_.isEmpty(params.delivery))&&(_.isUndefined(params.execution)||!_.isEmpty(params.execution))&&(_.isUndefined(params.reason)||!_.isEmpty(params.reason))}var cssScope=".delivery-index",serviceUrl=urlHelper.route("deliveries","DeliverySelection","taoProctoring"),pauseUrl=urlHelper.route("pauseExecutions","Monitor","taoProctoring"),sessionsUrl=urlHelper.route("deliveryExecutions","Monitor","taoProctoring");return loadingBar.start(),{start:function start(){var deliveries,categories,proxyDeliveries,proxySessions,title=__("Sessions"),pageParams=module.config(),context=pageParams.context,container=containerFactory(".container").changeScope(".delivery-index").write(indexTpl({title:title})),listBox=listBoxFactory({title:title,textEmpty:__("No sessions available"),textNumber:__("Available"),textLoading:__("Loading"),renderTo:container.find(".content"),replace:!0,list:[],width:12});appController.on("change.deliveryIndex",function(){appController.off(".deliveryIndex"),listBox.destroy(),container.destroy()}),Promise.all([proxyFactory("ajax").init({actions:{read:serviceUrl}}).then(function(proxy){proxyDeliveries=proxy}),proxyFactory("ajax").init({actions:{read:{url:sessionsUrl,validate:validateParams},pause:{url:pauseUrl,validate:validateParams}}}).then(function(proxy){proxySessions=proxy})]).then(function(){function getDeliveryLabel(id){return deliveries[id]&&deliveries[id].label}function formatPauseWarning(response,deliveryExecutions){var messageContext,unprocessed,responseData;return messageContext="",response&&(responseData=response.data,unprocessed={},responseData&&_.forEach(responseData.unprocessed,function(id){var execution=deliveryExecutions[id],uri=execution&&execution.delivery&&execution.delivery.uri;uri&&(unprocessed[uri]=(unprocessed[uri]||0)+1)}),unprocessed=_.map(unprocessed,function(count,uri){return 1<count?__("%d sessions of the delivery %s have not been paused",count,getDeliveryLabel(uri)):__("A session of the delivery %s have not been paused",getDeliveryLabel(uri))}),unprocessed.length&&(messageContext+="<br>"+unprocessed.join("<br>")),response.error&&(messageContext+="<br>"+encode.html(response.error))),messageContext}function refresh(){return loadingBar.start(),listBox.setLoading(!0),proxyDeliveries.read({context:context}).then(function(data){categories=data.categories,deliveries=_.transform(data.list,function(result,delivery){var props=delivery.properties,tplData={locked:delivery.stats.awaitingApproval,inProgress:delivery.stats.inProgress,paused:delivery.stats.paused};props&&props.periodStart&&props.periodEnd&&(tplData.showProperties=!0,tplData.periodStart=props.periodStart,tplData.periodEnd=props.periodEnd,delivery.cls="has-properties-displayed"),delivery.html=actionsTpl({id:delivery.id}),delivery.content=statsTpl(tplData),delivery.cls=((delivery.cls||"")+" router").trim(),result[delivery.id]=delivery},{}),listBox.update(data.list),loadingBar.stop()}).catch(function(err){appController.onError(err)})}function pause(deliveryId,selection,deliveryExecutions){return new Promise(function(resolve,reject){bulkActionPopup({renderTo:container.getElement(),actionName:__("Pause Session"),reason:!0,resourceType:"session",categoriesSelector:cascadingComboBox({categoriesDefinitions:categories.pause.categoriesDefinitions,categories:categories.pause.categories}),allowedResources:getSessionsNames(selection)}).on("cancel",resolve).on("ok",function(reason){proxySessions.action("pause",{delivery:deliveryId,execution:_.pluck(selection,"id"),reason:reason}).then(function(){feedback().success("Selected deliveries successfully paused"),refresh().then(resolve).catch(reject)}).catch(function(err){err.response?(feedback().warning(__("Something went wrong ...")+"<br>"+formatPauseWarning(err.response,deliveryExecutions),{encodeHtml:!1}),resolve()):reject(err)})})})}listBox.getElement().on("click",".pause",function(e){var deliveryId=$(this).data("delivery");loadingBar.start(),e.stopPropagation(),e.preventDefault(),proxySessions.read({delivery:deliveryId,context:context}).then(function(sessions){var inProgressExecs,deliveryExecutions={};return inProgressExecs=_.filter(sessions,function(session){return deliveryExecutions[session.id]=session,session.state&&session.state.status===_status.getStatus("inprogress").code}),inProgressExecs.length?pause(deliveryId,inProgressExecs,deliveryExecutions):void feedback().info(__("There is no delivery in progress"))}).catch(function(err){appController.onError(err)}).then(function(){loadingBar.stop()})}),refresh()}).catch(function(err){appController.onError(err),loadingBar.stop()})}}}),define("taoProctoring/component/breadcrumbs",["ui/breadcrumbs"],function(breadcrumbs){"use strict";return function breadcrumbFactory($container,crumbs){return breadcrumbs({breadcrumbs:crumbs,renderTo:$container.find(".header"),replace:!0,cls:"action-bar horizontal-action-bar"})}}),define("taoProctoring/controller/Delivery/manage",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory){"use strict";var cssScope=".delivery-manager";loadingBar.start();var proctorDeliveryIndexCtlr={start:function start(){var $container=$(".delivery-manager"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),assignUrl=helpers._url("testTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),removeUrl=helpers._url("removeTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),monitoringUrl=helpers._url("monitoring","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),bc=breadcrumbsFactory($container,crumbs),request=function(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))},remove=function(selection){request(removeUrl,selection,__("Test takers have been removed"))};$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No assigned test takers"),available:__("Assigned test takers"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"back",icon:"preview",title:__("Return to the session monitoring"),label:__("Monitoring"),action:function(){window.location.href=monitoringUrl}},{id:"assign",icon:"add",title:__("Assign more test takers to this session"),label:__("Add test takers"),action:function(){window.location.href=assignUrl}},{id:"remove",icon:"remove",title:__("Remove the selected test takers from the session"),label:__("Remove"),massAction:!0,action:function(selection){dialog({message:__("The test takers will be removed from this session. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}],actions:[{id:"remove",icon:"remove",title:__("Remove the test taker from the session"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The test taker will be removed from this session. Continue ?"),onOkBtn:function(){remove([id])}})}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")},{id:"status",label:__("Status")}]},dataset)}};return proctorDeliveryIndexCtlr}),define("taoProctoring/component/timeHandling/encoder",["core/format","core/encoder/time"],function(format,timeEncoder){"use strict";function encodeExtraTime(extraTime,consumedTime,pattern,unit){var _Mathmin=Math.min,encoded="";return pattern=pattern||"%s",unit=unit||1,extraTime&&(encoded=consumedTime?timeEncoder.encode(_Mathmin(consumedTime,extraTime))+"/"+timeEncoder.encode(extraTime):"HH:mm:ss"===pattern?timeEncoder.encode(extraTime):format(pattern,extraTime/unit),encoded=" +"+encoded),encoded}return encodeExtraTime}),define("tpl!taoProctoring/component/timeHandling/timeHandling",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"        <div class=\"multiple\">\n            <p>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The action will be applied to the following session(s)",{name:"__",hash:{},data:data,loc:{start:{line:6,column:15},end:{line:6,column:78}}}))+":</p>\n            <ul class=\"plain applicables\">\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"changeTimeMode"),{name:"if",hash:{},fn:container.program(2,data,0),inverse:container.program(5,data,0),data:data,loc:{start:{line:8,column:16},end:{line:22,column:23}}}))?"":stack1)+"            </ul>\n        </div>\n\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==(stack1=null==depth0?depth0:lookupProperty(depth0,"deniedResources"))?stack1:lookupProperty(stack1,"length"),{name:"if",hash:{},fn:container.program(11,data,0),inverse:container.noop,data:data,loc:{start:{line:26,column:8},end:{line:36,column:15}}}))?"":stack1)+"\n        <div class=\"form\">\n            <p>\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"changeTimeMode"),{name:"if",hash:{},fn:container.program(14,data,0),inverse:container.program(16,data,0),data:data,loc:{start:{line:40,column:16},end:{line:58,column:23}}}))?"":stack1)+"                <div class=\"errors\">\n                    <div class=\"feedback-error small hidden\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"errorMessage")||(null==depth0?depth0:lookupProperty(depth0,"errorMessage")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"errorMessage",hash:{},data:data,loc:{start:{line:60,column:61},end:{line:60,column:77}}}):helper))+"</div>\n                </div>\n            </p>\n        </div>\n        <p>\n            <strong>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Note",{name:"__",hash:{},data:data,loc:{start:{line:65,column:20},end:{line:65,column:33}}}))+":</strong>\n            <em>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"note")||(null==depth0?depth0:lookupProperty(depth0,"note")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"note",hash:{},data:data,loc:{start:{line:66,column:16},end:{line:66,column:24}}}):helper))+"</em>\n        </p>\n\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"reason"),{name:"if",hash:{},fn:container.program(18,data,0),inverse:container.noop,data:data,loc:{start:{line:69,column:8},end:{line:79,column:15}}}))?"":stack1)+"\n"},2:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"allowedResources"),{name:"each",hash:{},fn:container.program(3,data,0),inverse:container.noop,data:data,loc:{start:{line:9,column:20},end:{line:13,column:29}}}))?"":stack1},3:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                        <li data-resource=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:10,column:43},end:{line:10,column:49}}}):helper))+"\">\n                            <span class=\"resource-label\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:11,column:57},end:{line:11,column:66}}}):helper))+"</span>\n                        </li>\n"},5:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"allowedResources"),{name:"each",hash:{},fn:container.program(6,data,0),inverse:container.noop,data:data,loc:{start:{line:15,column:20},end:{line:21,column:29}}}))?"":stack1},6:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                        <li data-resource=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:16,column:43},end:{line:16,column:49}}}):helper))+"\">\n                            <span class=\"resource-label\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:17,column:57},end:{line:17,column:66}}}):helper))+"</span>\n                            "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"remainingStr"),{name:"if",hash:{},fn:container.program(7,data,0),inverse:container.noop,data:data,loc:{start:{line:18,column:28},end:{line:18,column:102}}}))?"":stack1)+"\n                            "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"extraTimeStr"),{name:"if",hash:{},fn:container.program(9,data,0),inverse:container.noop,data:data,loc:{start:{line:19,column:28},end:{line:19,column:99}}}))?"":stack1)+"\n                        </li>\n"},7:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"remaining\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"remainingStr")||(null==depth0?depth0:lookupProperty(depth0,"remainingStr")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"remainingStr",hash:{},data:data,loc:{start:{line:18,column:72},end:{line:18,column:88}}}):helper))+"</span>"},9:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"time\">("+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"extraTimeStr")||(null==depth0?depth0:lookupProperty(depth0,"extraTimeStr")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"extraTimeStr",hash:{},data:data,loc:{start:{line:19,column:68},end:{line:19,column:84}}}):helper))+")</span>"},11:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"            <p>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"However, the action will not be applied to the following sessions",{name:"__",hash:{},data:data,loc:{start:{line:27,column:15},end:{line:27,column:89}}}))+":</p>\n            <ul class=\"plain no-applicables\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"deniedResources"),{name:"each",hash:{},fn:container.program(12,data,0),inverse:container.noop,data:data,loc:{start:{line:29,column:16},end:{line:34,column:25}}}))?"":stack1)+"            </ul>\n"},12:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                <li data-resource=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:30,column:35},end:{line:30,column:41}}}):helper))+"\">\n                    <span class=\"resource-label\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:31,column:49},end:{line:31,column:58}}}):helper))+"</span>\n                    <span class=\"reason\">("+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"reason")||(null==depth0?depth0:lookupProperty(depth0,"reason")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"reason",hash:{},data:data,loc:{start:{line:32,column:42},end:{line:32,column:52}}}):helper))+")</span>\n                </li>\n"},14:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                    <label for=\"input-extra-time\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"inputLabel")||(null==depth0?depth0:lookupProperty(depth0,"inputLabel")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"inputLabel",hash:{},data:data,loc:{start:{line:41,column:50},end:{line:41,column:64}}}):helper))+":</label>\n                    <span class=\"change-time-controls-container\">\n                        <label class=\"change-time-control-container\">\n                            <input class=\"change-time-control__input\" checked=\"checked\" type=\"radio\" name=\"changeTimeControl\" value=\"\">\n                            <i class=\"change-time-control--add\">+</i>\n                        </label>\n                        <label class=\"change-time-control-container\">\n                            <input class=\"change-time-control__input\" type=\"radio\" name=\"changeTimeControl\" value=\"-\">\n                            <i class=\"change-time-control--sub\">\u2014</i>\n                        </label>\n                    </span>\n                    <input type=\"number\" id=\"input-extra-time\" data-control=\"time\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"time")||(null==depth0?depth0:lookupProperty(depth0,"time")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"time",hash:{},data:data,loc:{start:{line:52,column:90},end:{line:52,column:98}}}):helper))+"\" step=\"1\" min=\"0\" />\n                    <label for=\"input-extra-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"minutes",{name:"__",hash:{},data:data,loc:{start:{line:53,column:50},end:{line:53,column:66}}}))+"</label>\n"},16:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"                    <label for=\"input-extra-time\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"inputLabel")||(null==depth0?depth0:lookupProperty(depth0,"inputLabel")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"inputLabel",hash:{},data:data,loc:{start:{line:55,column:50},end:{line:55,column:64}}}):helper))+":</label>\n                    <input type=\"text\" id=\"input-extra-time\" data-control=\"time\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"time")||(null==depth0?depth0:lookupProperty(depth0,"time")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"time",hash:{},data:data,loc:{start:{line:56,column:88},end:{line:56,column:96}}}):helper))+"\" maxlength=\"4\" size=\"4\" />\n                    <label for=\"input-extra-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"minutes",{name:"__",hash:{},data:data,loc:{start:{line:57,column:50},end:{line:57,column:66}}}))+"</label>\n"},18:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"            <div class=\"reason\">\n                <p>\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Please provide a reason",{name:"__",hash:{},data:data,loc:{start:{line:72,column:20},end:{line:72,column:52}}}))+":\n                </p>\n                <div class=\"categories\"></div>\n                <div class=\"comment\">\n                    <textarea placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"comment...",{name:"__",hash:{},data:data,loc:{start:{line:76,column:43},end:{line:76,column:62}}}))+"\"></textarea>\n                </div>\n            </div>\n"},20:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"        <p>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The action cannot be applied, no eligible sessions found",{name:"__",hash:{},data:data,loc:{start:{line:82,column:11},end:{line:82,column:76}}}))+"</p>\n"},22:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"            <a href=\"#\" class=\"btn action cancel\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"cancel the action",{name:"__",hash:{},data:data,loc:{start:{line:88,column:57},end:{line:88,column:83}}}))+"\" data-control=\"cancel\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"cancel",{name:"__",hash:{},data:data,loc:{start:{line:88,column:107},end:{line:88,column:122}}}))+"</a>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"bulk-action-popup\">\n    <h2 class=\"title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Action",{name:"__",hash:{},data:data,loc:{start:{line:2,column:22},end:{line:2,column:37}}}))+": "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"actionName")||(null==depth0?depth0:lookupProperty(depth0,"actionName")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"actionName",hash:{},data:data,loc:{start:{line:2,column:39},end:{line:2,column:53}}}):helper))+"</h2>\n\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==(stack1=null==depth0?depth0:lookupProperty(depth0,"allowedResources"))?stack1:lookupProperty(stack1,"length"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.program(20,data,0),data:data,loc:{start:{line:4,column:4},end:{line:83,column:11}}}))?"":stack1)+"\n    <div class=\"actions\">\n        <button class=\"btn btn-info small action done\" data-control=\"done\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"OK",{name:"__",hash:{},data:data,loc:{start:{line:86,column:75},end:{line:86,column:86}}}))+"</button>\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==(stack1=null==depth0?depth0:lookupProperty(depth0,"allowedResources"))?stack1:lookupProperty(stack1,"length"),{name:"if",hash:{},fn:container.program(22,data,0),inverse:container.noop,data:data,loc:{start:{line:87,column:8},end:{line:89,column:15}}}))?"":stack1)+"    </div>\n\n</div>"},useData:!0})}),define("taoProctoring/component/timeHandling/timeHandling",["jquery","lodash","i18n","core/encoder/time","ui/component","ui/hider","taoProctoring/component/timeHandling/encoder","tpl!taoProctoring/component/timeHandling/timeHandling","ui/modal"],function($,_,__,timeEncoder,component,hider,encodeExtraTime,extraTimeTpl){"use strict";var _Mathmax=Math.max;function timeHandlingFactory(config){const initConfig=_.defaults(config||{},_defaults),timeUnit=initConfig.unit||_defaults.unit;return _.forEach(initConfig.allowedResources,resource=>{const remaining=parseFloat(resource.remaining)||0,extraTime=parseFloat(resource.extraTime),consumedTime=parseFloat(resource.consumedTime);remaining&&(resource.remainingStr=timeEncoder.encode(remaining)),resource.extraTimeStr=encodeExtraTime(extraTime,consumedTime,__("%s minutes more"),timeUnit)}),component().setTemplate(extraTimeTpl).on("render",function(){function clearErrors(){const $error=$(".feedback-error",$cmp);hider.hide($error),$error.remove()}function renderErrors(errors){const errorMessages=[];$cmp&&(errors.forEach(error=>{errorMessages.push(`<div class="feedback-error small">${error}</div>`)}),$cmp.find(".errors").prepend(errorMessages.join("")),hider.show($error))}function checkInputError(){const value=$time.val().trim(),time=+value,error=isNaN(time)||time!==parseFloat(value)||config.changeTimeMode&&0>=parseFloat(value),timeUnit=config.unit,errList=[];let errs=error,resError=error;return _.forEach(config.allowedResources,resource=>{error&&0===errList.length&&errList.push(config.errorMessage)}),_.forEach(config.allowedResources,resource=>{var _Mathfloor=Math.floor;if(resource.timeAdjustmentLimits){const remainingTime=_Mathfloor(resource.remaining_time)||0,limitTime=_Mathfloor(resource.timeAdjustmentLimits.decrease+resource.timeAdjustmentLimits.increase)||0,tooMuch=""===changeTimeOperator&&-1!==resource.timeAdjustmentLimits.increase&&resource.timeAdjustmentLimits.increase<timeUnit*value,tooFew="-"===changeTimeOperator&&timeUnit*value>resource.remaining_time;if(resError=error||tooMuch||tooFew,"undefined"!=typeof remainingTime)switch(resource.remainingStr=timeEncoder.encode(remainingTime),resource.timeLimitsStr=timeEncoder.encode(limitTime),!0){case error:resource.errorLabel=__("Entered value is not correct");break;case tooFew:errList.unshift(__("The decreased time cannot be higher than remaining time %s",resource.remainingStr)),resource.errorLabel=__("Time decrease is too high");break;case tooMuch:errList.unshift(__("The increased time, when added to the remaining time, %s cannot be higher than the overall time granted for this timer %s",resource.remainingStr,resource.timeLimitsStr)),resource.errorLabel=__("Time increase is too high");break;default:resource.errorLabel=""}if($(`LI[data-resource="${resource.id}"] .error`,$cmp).remove(),resError){const $resError=$("<span class=\"error\"></span>").text(" - "+resource.errorLabel);$(`LI[data-resource="${resource.id}"] .resource-label`,$cmp).append($resError)}errs=errs||resError}}),errs&&(renderErrors(errList),focus()),$ok.attr("disabled",errs||0===value.length),errs}function checkRequiredFields($container){return 0===$("select, textarea",$container).filter(function(){return 0===$.trim($(this).val()).length}).length}function checkReasonError(){return $cmp&&!checkRequiredFields($cmp)&&(renderErrors([__("All fields are required")]),!0)}function submit(){return initConfig.allowedResources.length?void(clearErrors(),!checkInputError()&&!checkReasonError()&&(state.time=parseFloat(`${changeTimeOperator}${$time.val()}`)*timeUnit,self.trigger("ok",state),$cmp.modal("close"))):void $cmp.modal("close")}function cancel(){self.trigger("cancel"),$cmp.modal("close")}function focus(){$time.focus().select()}const self=this,$cmp=this.getElement(),$time=$cmp.find("[data-control=\"time\"]"),$error=$cmp.find(".feedback-error"),$ok=$cmp.find("[data-control=\"done\"]"),$changeTimeControls=$cmp.find("input[name=\"changeTimeControl\"]");let changeTimeOperator="";const defaultTime=1,state={reasons:null,comment:"",time:0};if(config.changeTimeMode||$time.val(_.reduce(initConfig.allowedResources,function(time,testTaker){return _Mathmax(time,testTaker&&testTaker.extraTime||0)},0)/timeUnit),$cmp.addClass("modal").on("closed.modal",function(){self.destroy()}).on("selected.cascading-combobox",(e,reasons)=>{state.reasons=reasons,self.trigger("change",state)}).on("change","textarea",e=>{state.comment=$(e.currentTarget).val(),self.trigger("change",state)}).on("keyup",function(event){13===event.keyCode?submit():event.hasOwnProperty("target")&&event.target.hasOwnProperty("id")&&"input-extra-time"===event.target.id&&(clearErrors(),checkInputError())}).on("click",".action",function(event){const $btn=$(event.target).closest(".action"),control=$btn.data("control");event.preventDefault(),"done"===control?submit():cancel()}).modal({width:800}),_.isObject(this.config.categoriesSelector)){const $reason=$cmp.find(".reason"),$reasonCategories=$reason.children(".categories");this.config.categoriesSelector.on("render",()=>{if(initConfig.hasOwnProperty("predefinedReason")){const predefinedReason=initConfig.predefinedReason;if(predefinedReason.hasOwnProperty("comment")){const $textarea=$("textarea",$reason);$textarea.text(predefinedReason.comment),$textarea.trigger("change")}if(predefinedReason.hasOwnProperty("reasons")){const reasons=predefinedReason.reasons;reasons.hasOwnProperty("category")&&$("select[data-id=\"category\"]",$reasonCategories).val(reasons.category).on("change",()=>{_.defer(()=>{reasons.hasOwnProperty("subCategory")&&$("select[data-id=\"subCategory\"]",$reasonCategories).val(reasons.subCategory).trigger("change")})}).trigger("change")}}}).render($reasonCategories)}$time.on("input",function(){clearErrors(),checkInputError()}),$changeTimeControls.on("change",_ref=>{let{target:{value}}=_ref;changeTimeOperator=value,0===$time.val().length?$time.val(defaultTime):(clearErrors(),checkInputError())}),focus()}).on("destroy",function(){this.getElement().removeClass("modal").modal("destroy")}).init(initConfig)}const _defaults={unit:60,deniedResources:[]};return timeHandlingFactory}),define("tpl!taoProctoring/templates/delivery/monitoring",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<h1>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:21},end:{line:2,column:30}}}):helper))+"</h1>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"content\">\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"title"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:4},end:{line:2,column:42}}}))?"":stack1)+"\n    <div class=\"panel\"></div>\n    <div class=\"list clearfix\"></div>\n</div>"},useData:!0})}),define("tpl!taoProctoring/templates/delivery/deliveryLink",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"elipsis\" title=\""+(null==(stack1=(helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:1,column:29},end:{line:1,column:40}}}):helper))?"":stack1)+"\">"+(null==(stack1=(helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:1,column:42},end:{line:1,column:53}}}):helper))?"":stack1)+"</span>"},useData:!0})}),define("tpl!taoProctoring/templates/delivery/statusFilter",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <option value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"code")||(null==depth0?depth0:lookupProperty(depth0,"code")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"code",hash:{},data:data,loc:{start:{line:4,column:19},end:{line:4,column:27}}}):helper))+"\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:4,column:29},end:{line:4,column:38}}}):helper))+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<select name=\"filter[status]\" class=\"filter status select2\">\n    <option value=\"\" selected></option>\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"statuses"),{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:3,column:4},end:{line:5,column:13}}}))?"":stack1)+"</select>"},useData:!0})}),define("tpl!taoProctoring/templates/delivery/approximatedTimer",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"procotor-timer_time "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"countDown"),{name:"if",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:33},end:{line:2,column:66}}}))?"":stack1)+"\" data-remaining=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"remaining")||(null==depth0?depth0:lookupProperty(depth0,"remaining")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"remaining",hash:{},data:data,loc:{start:{line:2,column:84},end:{line:2,column:97}}}):helper))+"\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"timer")||(null==depth0?depth0:lookupProperty(depth0,"timer")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"timer",hash:{},data:data,loc:{start:{line:2,column:99},end:{line:2,column:108}}}):helper))+"</span>\n"},2:function(container,depth0,helpers,partials,data){return"countDown"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"timer"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:1,column:0},end:{line:3,column:7}}}))?"":stack1},useData:!0})}),define("taoProctoring/controller/Delivery/monitoring",["jquery","lodash","i18n","module","controller/app","core/polling","core/timer","util/url","layout/loading-bar","core/encoder/time","util/encode","ui/feedback","ui/dialog","ui/bulkActionPopup","ui/cascadingComboBox","ui/container","ui/datetime/picker","taoProctoring/component/proxy","taoProctoring/component/timeHandling/timeHandling","taoProctoring/component/timeHandling/encoder","taoProctoring/helper/status","tpl!taoProctoring/templates/delivery/monitoring","tpl!taoProctoring/templates/delivery/deliveryLink","tpl!taoProctoring/templates/delivery/statusFilter","moment","util/locale","tpl!taoProctoring/templates/delivery/approximatedTimer","lib/flatpickr/l10n/index","ui/datatable","select2"],function($,_,__,module,appController,pollingFactory,timerFactory,urlHelper,loadingBar,timeEncoder,encode,feedback,dialog,bulkActionPopup,cascadingComboBox,containerFactory,dateTimePicker,proxyFactory,timeHandlingPopup,encodeTime,_status,monitoringTpl,deliveryLinkTpl,statusFilterTpl,moment,locale,approximatedTimerTpl,flatpickrLocalization){"use strict";function validateParams(params){return _.isPlainObject(params)&&(_.isUndefined(params.delivery)||!_.isEmpty(params.delivery))&&(_.isUndefined(params.testCenter)||!_.isEmpty(params.testCenter))&&!_.isEmpty(params.execution)}var cssScope=".delivery-monitoring",terminateUrl=urlHelper.route("terminateExecutions","Monitor","taoProctoring"),reactivateUrl=urlHelper.route("reactivateExecutions","MonitorProctorAdministrator","taoProctoring"),pauseUrl=urlHelper.route("pauseExecutions","Monitor","taoProctoring"),authorizeUrl=urlHelper.route("authoriseExecutions","Monitor","taoProctoring"),extraTimeUrl=urlHelper.route("extraTime","Monitor","taoProctoring"),reportUrl=urlHelper.route("reportExecutions","Monitor","taoProctoring"),serviceUrl=urlHelper.route("monitor","Monitor","taoProctoring"),executionsUrl=urlHelper.route("deliveryExecutions","Monitor","taoProctoring"),historyUrl=urlHelper.route("index","Reporting","taoProctoring");const adjustTimeUrl=urlHelper.route("adjustTime","Monitor","taoProctoring");var extraTimeUnit=60;return loadingBar.start(),{start(){var dataset,extraFields,categories,originalDataset,container=containerFactory().changeScope(".delivery-monitoring").write(monitoringTpl()),$content=container.find(".content"),$list=container.find(".list"),pageParams=module.config(),deliveryId=pageParams.delivery,context=pageParams.context,defaultTag=pageParams.defaultTag,allowIrr="false"!==pageParams.allowIrr,defaultAvailableLabel=__("Current sessions");let timeHandlingMode,changeTimeMode;var allowedConnectivity,printReportButton,printReportUrl,hasAccessToReactivate,actionButtons,actionList,label,startDatePicker,dialogSettings,tools=[],model=[],highlightRows=[],serviceParams={},sessionsHistoryUrl=historyUrl,timer=timerFactory({autoStart:!1}),polling=pollingFactory({action(){var elapsed=timer.tick()/1e3,timers=$(".procotor-timer_time.countDown");_.forEach(timers,function(timerItem){var _Mathround=Math.round,remaining=$(timerItem).data("remaining");0<remaining&&(remaining-=elapsed,$(timerItem).html(timeEncoder.encode(_Mathround(remaining))),$(timerItem).data("remaining",remaining))})},interval:1e3,autoStart:!1});const dataPolling=pollingFactory({interval:2e3,autoStart:!1});appController.on("change.deliveryMonitoring",function(){appController.off(".deliveryMonitoring"),container.destroy()}),proxyFactory("ajax").init({actions:{read:serviceUrl,authorize:{url:authorizeUrl,validate:validateParams},pause:{url:pauseUrl,validate:validateParams},terminate:{url:terminateUrl,validate:validateParams},reactivate:{url:reactivateUrl,validate:validateParams},report:{url:reportUrl,validate:validateParams},extraTime:{url:extraTimeUrl,validate:validateParams},adjustTime:{url:adjustTimeUrl,validate:validateParams}}}).then(function(proxyExecutions){function request(action,selection,data,message){var params;selection&&selection.length&&(loadingBar.start(),params=_.merge({execution:selection},data),deliveryId&&(params.delivery=deliveryId),context&&(params.testCenter=context),proxyExecutions.action(action,params).then(function(){message&&feedback().success(message),$list.trigger("reset-checkboxes"),$list.datatable("refresh")}).catch(function(err){var responseData,unprocessed,messageContext="";err.response&&(responseData=err.response.data,unprocessed=_.map(responseData.unprocessed,function(msg,id){var execution;return(id||(id=msg,msg=null),msg)?msg:(execution=getExecutionData(id),execution)?__("Session %s - %s has not been processed",execution.delivery.label,execution.start_time):void 0}),unprocessed.length&&(messageContext+=`<br>${unprocessed.join("<br>")}`),responseData.error&&(messageContext+=`<br>${encode.html(responseData.error)}`)),appController.onError(err),feedback().error(`${__("Something went wrong ...")}<br>${messageContext}`,{encodeHtml:!1})}).then(function(){loadingBar.stop()}))}function authorize(selection){execBulkAction("authorize",__("Authorize Session"),selection,function(sel,reason){request("authorize",sel,{reason:reason},__("Sessions authorized"))})}function pause(selection){execBulkAction("pause",__("Pause Session"),selection,function(sel,reason){request("pause",sel,{reason:reason},__("Sessions paused"))})}function terminate(selection){execBulkAction("terminate",__("Terminate Session"),selection,function(sel,reason){request("terminate",sel,{reason:reason},__("Sessions terminated"))})}function reactivate(selection){execBulkAction("reactivate",__("Reactivate Session"),selection,function(sel,reason){request("reactivate",sel,{reason:reason},__("Sessions reactivated"))})}function report(selection){allowIrr&&execBulkAction("report",__("Report Irregularity"),selection,function(sel,reason){request("report",sel,{reason:reason},__("Sessions reported"))})}function terminateOrReactivateAndIrregularity(selection){const delivery=getExecutionData(selection),buttons=[];hasAccessToReactivate&&canDo("reactivate",delivery)?buttons.push({id:"reactivate",type:"error",label:__("Reactivate session"),icon:"play",close:!0,action(){reactivate(selection)}}):canDo("terminate",delivery)&&buttons.push({id:"terminate",type:"error",label:__("Terminate session"),icon:"stop",close:!0,action(){terminate(selection)}}),allowIrr&&buttons.push({id:"irregularity",type:"info",label:__("Report irregularity"),icon:"delivery-small",close:!0,action(){report(selection)}}),buttons.length&&dialog({message:__("Please, make your selection"),autoRender:!0,autoDestroy:!0,buttons:buttons})}function showHistory(selection){var monitoringRoute=window.location.toString(),urlParams={session:selection};context&&(urlParams.context=context),deliveryId&&(urlParams.delivery=deliveryId),appController.getRouter().redirect(urlHelper.build(sessionsHistoryUrl,urlParams)).then(function(){appController.trigger("set-referrer",monitoringRoute)}).catch(function(err){appController.onError(err)})}function printReport(selection){execBulkAction("print",__("Print Score"),selection,function(sel){var params={id:sel};context&&(params.context=context);const url=urlHelper.route(printReportUrl.action,printReportUrl.controller,printReportUrl.extension,params);window.open(url,`printReport${JSON.stringify(sel)}`)})}function timeHandling(selection){const _selection=listSessions("time",_.isArray(selection)?selection:[selection]),config=_.merge(_selection,{renderTo:$content,actionName:__("Grant Extra Time"),errorMessage:__("The extra time must be a number"),unit:60,note:__("the already granted time will be replaced by the new value"),inputLabel:__("Extra time")});timeHandlingPopup(config).on("ok",function(state){const sessionsToUpdate=_selection.allowedResources.map(session=>session.id);request("extraTime",sessionsToUpdate,{time:state.time},__("Extra time granted"))})}function timeAdjustment(selection){const _selection=_.isArray(selection)?selection:[selection],sessionsList=listSessions("changeTime",_selection),actionName="timeAdjustment",askForReason=categories[actionName]&&categories[actionName].categoriesDefinitions&&categories[actionName].categoriesDefinitions.length,config=Object.assign({},sessionsList,{renderTo:$content,actionName:__("Change time"),errorMessage:__("The extra time must be a number bigger than 0"),unit:60,note:__("Already changed time will be added or subtracted by the new value."),inputLabel:__("Change time"),changeTimeMode:!0,reason:askForReason,reasonRequired:!0});_.isEmpty(categories[actionName])||(config.categoriesSelector=cascadingComboBox(categories[actionName])),_.each(_selection,function(uri){const deliveryExecutionData=getExecutionData(uri);deliveryExecutionData.hasOwnProperty("lastPauseReason")&&(config.predefinedReason=deliveryExecutionData.lastPauseReason)}),timeHandlingPopup(config).on("ok",state=>{request("adjustTime",sessionsList.allowedResources.map(_ref2=>{let{id}=_ref2;return id}),state,__("Time adjusted"))})}function canDo(what,delivery){if(delivery&&delivery.state&&delivery.state.status){const status=_status.getStatusByCode(delivery.state.status),isAllowed=_.isFunction(status.can[what])?status.can[what](delivery):status.can[what];return status&&!0===isAllowed}return!1}function verifyDelivery(testTakerData,actionName){var deliveryName,formatted,status;return deliveryName=_.isObject(testTakerData.delivery)?testTakerData.delivery.label:testTakerData.delivery,deliveryName=$("<div/>").html(deliveryName).text(),formatted={id:testTakerData.id,label:`${deliveryName} [${testTakerData.start_time}] ${testTakerData.test_taker_first_name} ${testTakerData.test_taker_last_name}`},status=_status.getStatusByCode(testTakerData.state.status),status&&(formatted.allowed=!0===canDo(actionName,testTakerData),"changeTime"===actionName&&(formatted.allowed=testTakerData.allowTimerAdjustment),!formatted.allowed&&(formatted.reason=_.isFunction(status.can[actionName])?status.can[actionName](testTakerData):status.can[actionName],formatted.warning=status.warning[actionName]?status.warning[actionName](null,testTakerData.id):__("Unable to perform action on test %s.",testTakerData.id))),testTakerData.timer&&(formatted.extraTime=testTakerData.timer.extraTime,formatted.consumedTime=testTakerData.timer.consumedExtraTime,formatted.remaining_time=testTakerData.timer.remaining_time,formatted.adjustedTime=testTakerData.timer.adjustedTime,formatted.approximatedRemaining=testTakerData.timer.approximatedRemaining,formatted.countDown=testTakerData.timer.countDown,formatted.extendedTime=testTakerData.timer.extendedTime,formatted.lastActivity=testTakerData.timer.lastActivity,formatted.timeAdjustmentLimits=testTakerData.timer.timeAdjustmentLimits),formatted}function getExecutionData(uri){return _.find(dataset.data,{id:uri})}function listSessions(actionName,selection){var allowedDeliveries=[],forbiddenDeliveries=[];return _.each(selection,function(uri){var checkedDelivery,testTakerData=getExecutionData(uri);testTakerData&&(checkedDelivery=verifyDelivery(testTakerData,actionName),checkedDelivery.allowed?allowedDeliveries.push(checkedDelivery):forbiddenDeliveries.push(checkedDelivery))}),{resourceType:__("session"),resourceTypes:__("sessions"),allowedResources:allowedDeliveries,deniedResources:forbiddenDeliveries}}function execBulkAction(actionName,actionTitle,selection,cb){var _selection=_.isArray(selection)?selection:[selection],askForReason=categories[actionName]&&categories[actionName].categoriesDefinitions&&categories[actionName].categoriesDefinitions.length,config=_.merge(listSessions(actionName,_selection),{renderTo:$content,actionName:actionTitle,reason:askForReason,reasonRequired:!0});dialogSettings&&dialogSettings[actionName]&&(config.message=dialogSettings[actionName].message,config.icon=dialogSettings[actionName].icon),_.isEmpty(categories[actionName])||(config.categoriesSelector=cascadingComboBox(categories[actionName])),config.allowedResources.length?bulkActionPopup(config).on("ok",function(reason){_.isFunction(cb)&&cb(config.allowedResources.map(res=>res.id),reason)}):feedback().warning(_status.buildWarningMessage(actionName,_selection,config.deniedResources))}function buildStatusFilter(){return statusFilterTpl({statuses:_status.getStatuses()})}function setTagUsage(applyTags){var $filter;defaultTag&&(!$list.find(".tag").length&&($filter=$(`<span class="filter"><input type="hidden" name="tag" class="tag" value="${applyTags}"/></span>`),$filter.appendTo($list)),$list.find(".tag").val(applyTags),$list.data("applytags",applyTags),applyTags?$list.find(".action-bar").children(".tool-tag").hide():$list.find(".action-bar").children(".tool-notag").hide())}function getTagsUsage(){return $list.data("applytags")}function setInitialFilters(){defaultTag&&setTagUsage(!0)}function statusFilterHandler($el){$el.select2({dropdownAutoWidth:!0,placeholder:__("Filter"),minimumResultsForSearch:1/0,allowClear:!0})}function getPageLang(){const documentLang=window.document.documentElement.getAttribute("lang");return documentLang&&documentLang.split("-")[0]}function getDefaultStartTimeFilter(){const dateFormat=locale.getDateTimeFormat().split(" ")[0];let separator=" - ";const lang=getPageLang();if(_.isObject(flatpickrLocalization.default[lang])){const flatpickrLang=flatpickrLocalization.default[lang];flatpickrLang.hasOwnProperty("rangeSeparator")&&(separator=flatpickrLang.rangeSeparator)}return`${moment().format(dateFormat)} ${separator} ${moment().add("1","d").format(dateFormat)}`}function extractOption(object,option,defaultValue){return _.isUndefined(object[option],void 0)?defaultValue:object[option]}function startPollingData(pollingInterval,ajaxConfig){stopPollingData(),dataPolling.setAction(function(process){const action=process.async();$.ajax(ajaxConfig).then(response=>{$list.datatable("refresh",response),action.resolve()}).fail(action.resolve)}),dataPolling.setInterval(pollingInterval),dataPolling.start()}function stopPollingData(){dataPolling.stop()}return deliveryId&&(serviceParams.delivery=deliveryId),context&&(serviceParams.context=context),proxyExecutions.read(serviceParams).then(function(data){dataset=data.set,extraFields=data.extrafields,categories=data.categories,deliveryId=data.delivery||deliveryId,context=data.context||context,timeHandlingMode="extra_time"===data.timeHandling,changeTimeMode="timer_adjustment"===data.timeHandling,allowedConnectivity=data.onlineStatus||!1,printReportButton=data.printReportButton,printReportUrl=data.printReportUrl,hasAccessToReactivate=data.hasAccessToReactivate,sessionsHistoryUrl=data.historyUrl||historyUrl,dialogSettings=data.dialogSettings;var showColumnFirstName=extractOption(data,"showColumnFirstName",!0),showColumnLastName=extractOption(data,"showColumnLastName",!0),showColumnAuthorize=extractOption(data,"showColumnAuthorize",!0),showColumnRemainingTime=extractOption(data,"showColumnRemainingTime",!0),showColumnExtendedTime=extractOption(data,"showColumnExtendedTime",!0),showActionShowHistory=extractOption(data,"showActionShowHistory",!0),setStartDataOneDay=extractOption(data,"setStartDataOneDay",!0);deliveryId&&(serviceParams.delivery=deliveryId),context&&(serviceParams.context=context),data.refreshBtn&&tools.push({id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action(){$list.trigger("reset-checkboxes"),$list.datatable("refresh")}}),defaultTag&&(tools.push({id:"notag",icon:"filter",css:"btn-warning",label:__("Remove default tag filtering"),title:__("Remove default tag filtering"),action(){setTagUsage(!1),$list.datatable("filter")}}),tools.push({id:"tag",icon:"filter",title:__("Apply default tag"),label:__("Apply default tag"),action(){setTagUsage(!0),$list.datatable("filter")}})),tools.push({id:"authorize",icon:"play",title:__("Authorize sessions"),label:__("Authorize"),massAction:!0,action:authorize}),(null===data.canPause||data.canPause)&&tools.push({id:"pause",icon:"pause",title:__("Pause sessions"),label:__("Pause"),massAction:!0,action:pause}),tools.push({id:"terminate",icon:"stop",title:__("Terminate sessions"),label:__("Terminate"),massAction:!0,action:terminate}),allowIrr&&tools.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularities"),label:__("Report"),massAction:!0,action:report}),printReportButton&&tools.push({id:"printReport",title:__("Print the assessment results"),icon:"result",label:__("Print Results"),massAction:!0,action:printReport}),timeHandlingMode&&tools.push({id:"timeHandling",title:__("Session time handling"),icon:"time",label:__("Time"),massAction:!0,action:timeHandling}),changeTimeMode&&tools.push({id:"timeAdjustment",title:__("Session time handling"),icon:"time",label:__("Time"),massAction:!0,action:timeAdjustment}),model.push({id:"deliveryLabel",label:__("Session"),sortable:!0,transform(value,row){var delivery=row&&row.delivery;return delivery&&(value=deliveryLinkTpl(delivery)),value}}),showColumnFirstName&&model.push({id:"test_taker_first_name",label:__("First name"),filterable:!0,sortable:!0,transform(value,row){return row&&row.testTaker&&row.testTaker.test_taker_first_name||""}}),showColumnLastName&&model.push({id:"test_taker_last_name",label:__("Last name"),filterable:!0,sortable:!0,transform(value,row){return row&&row.testTaker&&row.testTaker.test_taker_last_name||""}}),_.each(extraFields,function(extraField){model.push({id:extraField.id,label:extraField.label,filterable:extraField.filterable,sortable:!0,order:extraField.columnPosition,transform(value,row){return row&&row.extraFields&&row.extraFields[extraField.id]||""}})}),model.push({id:"start_time",sortable:!0,label:__("Started at"),filterable:!0,transform(value){return locale.formatDateTime(value)},filterTransform(value){var dateFormat=locale.getDateTimeFormat().split(" ")[0],values=value.split(" "),result="";const start_day=values[0],last_day=values[values.length-1];return start_day&&last_day&&(result+=moment(start_day,dateFormat).format("X"),result+=" - ",result+=moment(last_day,dateFormat).add(1,"d").format("X")),result},customFilter:{template:`<input type="text" id="start_time_filter" name="filter[start_time]" placeholder="${__("Filter")}"/>`,callback($elt){var $filterContainer=$elt.closest(".filter"),dateFormat=locale.getDateTimeFormat().split(" "),dateFormatStr=dateFormat[0];$filterContainer.css("position","static"),startDatePicker&&startDatePicker.destroy(),startDatePicker=dateTimePicker($filterContainer,{setup:"date-range",format:dateFormatStr,replaceField:$elt[0]}).on("close",function(){const selection=this.getSelectedDates();2===selection.length&&$list.datatable("filter")}).on("clear",function(){$list.datatable("filter")})}}}),model.push({id:"status",label:__("Status"),sortable:!0,filterable:!0,customFilter:{template:buildStatusFilter(),callback:statusFilterHandler},transform(value,row){var status,result="";return row&&row.state&&row.state.status&&(status=_status.getStatusByCode(row.state.status),status&&(result=status.label,row.state.status===__("INPROGRESS")&&(result=status.label),result===__("Awaiting")&&highlightRows.push(row.id))),result}}),showColumnAuthorize&&model.push({id:"authorizeCl",label:__("Authorize"),type:"actions",actions:[{id:"authorize",icon:"play",title:__("Authorize session"),disabled(){return!canDo("authorize",this)},action:authorize}]}),(null===data.canPause||data.canPause)&&model.push({id:"pauseCl",label:__("Pause"),type:"actions",actions:[{id:"pause",icon:"pause",title:__("Pause session"),disabled(){return!canDo("pause",this)},action:pause}]}),showColumnRemainingTime&&model.push({id:"remaining_time",sortable:!0,sorttype:"numeric",label:__("Remaining"),transform(value,row){var rowTimer=_.isObject(row.timer)?row.timer:{},refinedValue=rowTimer.approximatedRemaining?rowTimer.approximatedRemaining:rowTimer.remaining_time,remaining=parseInt(refinedValue,10);return(remaining||_.isFinite(remaining))&&(0>remaining&&(rowTimer.extraTime&&rowTimer.consumedExtraTime&&(rowTimer.consumedExtraTime+=-remaining),remaining=0),remaining?(rowTimer.extraTime&&rowTimer.consumedExtraTime&&(remaining-=rowTimer.consumedExtraTime),refinedValue=timeEncoder.encode(remaining)):refinedValue="",refinedValue=approximatedTimerTpl({timer:refinedValue,remaining:remaining,countDown:rowTimer.countDown})),refinedValue}}),timeHandlingMode&&model.push({id:"extraTime",label:__("Extra Time"),type:"actions",actions:[{id:"timeHandling",title:__("Session time handling"),icon:"time",action:timeHandling,hidden(){const allowExtraTime=_.isNull(this.allowExtraTime)||this.allowExtraTime;return!canDo("time",this)||!allowExtraTime}}]}),changeTimeMode&&model.push({id:"adjustTime",label:__("Change time"),type:"actions",actions:[{id:"timeHandling",title:__("Session time handling"),icon:"time",action:timeAdjustment,disabled(){return!this.allowTimerAdjustment}}]}),showColumnExtendedTime&&model.push({id:"extendedTime",label:__("Changed Time"),transform(value,row){var _Mathabs=Math.abs;const state=[],timer=_.isObject(row.timer)?row.timer:{},{adjustedTime,extendedTime,extraTime}=timer;return extendedTime&&state.push(`${__("Extended time")}: x${extendedTime}`),extraTime&&state.push(`${__("Extra")}: ${timeEncoder.encode(extraTime)}`),adjustedTime&&state.push(`${__("Adjusted")}: ${0<adjustedTime?"":"-"}${timeEncoder.encode(_Mathabs(adjustedTime))}`),state.join("<br />")}}),allowedConnectivity&&model.push({id:"last_connect",sortable:!0,label:__("Connectivity"),transform(value,row){return row.state.status===_status.STATUS_INPROGRESS?row.online?__("online"):__("offline"):""}}),model.push({id:"progress",label:__("Progress"),transform(value,row){return row&&row.state&&row.state.progress||""}}),label=__("Terminate"),allowIrr?(label=__("Terminate and irregularity"),hasAccessToReactivate&&(label=__("Terminate/Reactivate and irregularity"))):hasAccessToReactivate&&(label=__("Terminate/Reactivate")),actionList=[{id:"terminateOrReactivateAndIrregularity",icon:"delivery-small",title:label,disabled:!0,action:terminateOrReactivateAndIrregularity}],showActionShowHistory&&actionList.push({id:"history",icon:"history",title:__("Show the detailed session history"),action:showHistory}),printReportButton&&actionList.push({id:"printReport",title:__("Print the assessment results"),icon:"result",action:printReport}),model.push({id:"administrationCl",label:__("Administration"),type:"actions",actions:actionList}),$list.on("query.datatable",function(event,ajaxConfig){loadingBar.start(),highlightRows=[];const isPollingAvailable=data.autoRefresh&&ajaxConfig;isPollingAvailable&&startPollingData(data.autoRefresh,ajaxConfig)}).on("beforeload.datatable",(e,dataSet)=>{originalDataset=dataSet,highlightRows=[]}).on("load.datatable",function(e,newDataset){newDataset.data&&newDataset.data.forEach(session=>{session.test_taker_first_name=session.test_taker_first_name?$("<div>").html(session.test_taker_first_name).text():void 0,session.test_taker_last_name=session.test_taker_last_name?$("<div>").html(session.test_taker_last_name).text():void 0});var applyTags;dataset=newDataset,$(".terminateOrReactivateAndIrregularity",$list).each((ind,btn)=>{const $btn=$(btn),uri=$btn.closest("[data-item-identifier]").data("item-identifier"),delivery=getExecutionData(uri);(hasAccessToReactivate&&canDo("reactivate",delivery)||canDo("terminate",delivery)||allowIrr)&&$btn.prop("disabled",!1)}),actionButtons=_({authorize:$list.find(".action-bar").children(".tool-authorise"),pause:$list.find(".action-bar").children(".tool-pause"),terminate:$list.find(".action-bar").children(".tool-terminate"),report:$list.find(".action-bar").children(".tool-irregularity")}),defaultTag&&(applyTags=$list.data("applytags"),applyTags=!!_.isUndefined(applyTags)||applyTags,setTagUsage(applyTags)),$list.datatable("highlightRows",highlightRows),loadingBar.stop(),appController.off("change.polling").on("change.polling",function(){polling.stop()}),$list.off("reset-checkboxes").on("reset-checkboxes",function(a){const $checkboxes=$list.find("td.checkboxes input"),$checkAll=$list.find("th.checkboxes input");$checkAll.prop("checked",!1),$checkboxes.prop("checked",!1)}),polling.start(),timer.resume()}).on("select.datatable",function(){actionButtons.each(function($btn){$btn.hide()}),_($list.datatable("selection")).map(function(uri){var row=getExecutionData(uri);return row.state.status}).uniq().each(function(statusCode){var status=_status.getStatusByCode(statusCode);actionButtons.forIn(function($btn,action){status&&!0===status.can[action]&&$btn.show()})})}).on("error.datatable",function(e,err){appController.onError(err)}).datatable({url:urlHelper.build(executionsUrl,serviceParams),status:{empty:__("No sessions"),available(){return getTagsUsage()?__("Groups: %s. %s",defaultTag.split(",").join(", "),defaultAvailableLabel):defaultAvailableLabel},loading:__("Loading")},atomicUpdate:!!data.autoRefresh,filterStrategy:"multiple",filterSelector:"select, input:not(.select2-input, .select2-focusser)",filtercolumns:{start_time:setStartDataOneDay?getDefaultStartTimeFilter():""},filter:!0,tools:tools,model:model,selectable:!0,sortorder:"desc",sortby:"start_time",pageSizeSelector:!0},dataset),setInitialFilters()})}).catch(function(err){appController.onError(err),loadingBar.stop()})}}}),define("taoProctoring/controller/Delivery/testTakers",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,breadcrumbsFactory){"use strict";var cssScope=".delivery-testtakers";loadingBar.start();var proctorDeliveryAssignCtlr={start:function start(){var $container=$(".delivery-testtakers"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),serviceUrl=helpers._url("availableTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),assignUrl=helpers._url("assignTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),managerUrl=helpers._url("manage","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),bc=breadcrumbsFactory($container,crumbs),assign=function(selection){selection&&selection.length&&(loadingBar.start(),$.ajax({url:assignUrl,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success(__("Test takers have been added")),window.location.href=managerUrl):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))};$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(event,response){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No available test takers to assign"),available:__("Available test takers"),loading:__("Loading")},tools:[{id:"back",icon:"left",title:__("Return to the session manager"),label:__("Back"),action:function(){window.location.href=managerUrl}},{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"assign",icon:"add",title:__("Assign the selected test takers to the session"),label:__("Assign the selected test takers"),massAction:!0,action:function(selection){assign(selection)}}],actions:[{id:"assign",icon:"add",title:__("Assign the test taker to the session"),action:function(id){assign([id])}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")}]},dataset)}};return proctorDeliveryAssignCtlr}),define("tpl!taoProctoring/templates/deliveryServer/authorizationSuccess",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"success-message\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"message")||(null==depth0?depth0:lookupProperty(depth0,"message")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"message",hash:{},data:data,loc:{start:{line:1,column:30},end:{line:1,column:41}}}):helper))+"<span class=\"icon-result-ok\"></span></span>"},useData:!0})}),define("tpl!taoProctoring/templates/deliveryServer/authorizationListBoxActions",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <span class=\"action cancel js-cancel\" tabindex=\"0\" role=\"button\">\n        <span class=\"action-control\">\n            <span class=\"icon-stop\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Cancel",{name:"__",hash:{},data:data,loc:{start:{line:5,column:43},end:{line:5,column:58}}}))+"\n        </span>\n    </span>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"listbox-actions\">\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"cancelable"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:4},end:{line:8,column:11}}}))?"":stack1)+"    <span class=\"action play js-proceed\" data-delivery=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:9,column:56},end:{line:9,column:62}}}):helper))+"\" tabindex=\"0\" role=\"button\">\n        <span class=\"action-control\">\n            <span class=\"icon-play\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Proceed",{name:"__",hash:{},data:data,loc:{start:{line:11,column:43},end:{line:11,column:59}}}))+"\n        </span>\n    </span>\n</span>"},useData:!0})}),define("tpl!taoProctoring/templates/deliveryServer/authorizationEntryPoint",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"entry-point-box authorization-container\">\n    <div class=\"block entry-point entry-point-all-deliveries\">\n        <h1>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:3,column:12},end:{line:3,column:21}}}):helper))+"</h1>\n        <p class=\"authorization-status\" aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Authorization status",{name:"__",hash:{},data:data,loc:{start:{line:4,column:52},end:{line:4,column:81}}}))+"\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Please wait, authorization in process ...",{name:"__",hash:{},data:data,loc:{start:{line:4,column:83},end:{line:4,column:133}}}))+"</p>\n        <div class=\"authorization-actions clearfix\"></div>\n    </div>\n</div>"},useData:!0})}),define("taoProctoring/controller/DeliveryServer/awaiting",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/dialog/alert","core/polling","taoQtiTest/testRunner/resumingStrategy/keepAfterResume","ui/dialog/confirm","tpl!taoProctoring/templates/deliveryServer/authorizationSuccess","tpl!taoProctoring/templates/deliveryServer/authorizationListBoxActions","tpl!taoProctoring/templates/deliveryServer/authorizationEntryPoint","util/clipboard","ui/component"],function(_,$,__,helpers,loadingBar,dialogAlert,polling,keepAfterResume,dialogConfirm,authSuccessTpl,listBoxActionsTpl,authorizationEntryPointTpl,clipboard){"use strict";const refreshPolling=10000,cssScope=".awaiting-authorization",awaitingAuthorizationCtlr={start:function start(config){const $container=$(cssScope),isAuthorizedUrl=helpers._url("isAuthorized","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),runDeliveryUrl=config.runDeliveryUrl,spaceEnterKeyCodes=[13,32];$container.html(authorizationEntryPointTpl({label:config.deliveryLabel})),$container.find(".authorization-actions").html(listBoxActionsTpl({id:config.deliveryExecution,cancelable:config.cancelable}));const $content=$container.find(".authorization-status"),$proccedButton=$container.find(".js-proceed");let deliveryStarted=!1;const runDelivery=()=>{loadingBar.start(),$.get(isAuthorizedUrl,result=>{result.success?result.authorized?(clipboard.clean(),deliveryStarted=!0,window.location.href=runDeliveryUrl):dialogAlert(__("Unexpected response"),exit):result.message?dialogAlert(result.message,exit):dialogAlert(__("Unexpected response"),exit)})},isRunnable=()=>!$container.hasClass("authorization-in-progress")&&!deliveryStarted,authorized=()=>{$content.html(authSuccessTpl({message:__("Authorized, you may proceed")})),loadingBar.stop(),$container.addClass("authorization-granted").removeClass("authorization-in-progress"),$proccedButton.removeClass("dissabled-action"),$proccedButton.attr("aria-disabled",!1)},exit=()=>{window.location.href=config.returnUrl};$proccedButton.addClass("dissabled-action"),$proccedButton.attr("aria-disabled",!0),keepAfterResume().reset(),loadingBar.start(!1),$container.on("click",".js-cancel",()=>{dialogConfirm(__("Are you sure you want to end the test?"),function(){window.location.href=config.cancelUrl})}),$container.on("keyup",".js-cancel",e=>{spaceEnterKeyCodes.includes(e.which)&&dialogConfirm(__("Are you sure you want to end the test?"),function(){window.location.href=config.cancelUrl})}),$container.on("click",".js-proceed",()=>(isRunnable()&&runDelivery(),!1)),$container.on("keyup",".js-proceed",e=>(spaceEnterKeyCodes.includes(e.which)&&isRunnable()&&runDelivery(),!1)),polling({action:function(){const async=this.async();$.get(isAuthorizedUrl,result=>{let stop=!1;result.success?result.authorized&&(stop=!0,authorized()):(stop=!0,result.message?dialogAlert(result.message,exit):dialogAlert(__("Unexpected response"),exit)),stop?async.reject():async.resolve()})},interval:refreshPolling,autoStart:!0}).next()}};return awaitingAuthorizationCtlr}),define("taoProctoring/controller/Irregularity/index",["jquery","lodash","i18n","ui/hider","util/url","ui/feedback","ui/taskQueue/taskQueue","ui/taskQueueButton/standardButton"],function($,_,__,hider,urlHelper,feedback,taskQueue,taskCreationButtonFactory){"use strict";return{start:function start(){function switchContainer(purpose){hider.hide($containers),hider.show($containers.filter("[data-purpose=\""+purpose+"\"]"))}function refreshTree(){$(".tree").trigger("refresh.taotree",[{uri:$header.data("select-node")}])}var taskCreationButton,$header=$("header.section-header"),$formContainer=$(".print-form"),$reportContainer=$(".print-report"),$form=$("form",$formContainer),$submitter=$(".form-submitter",$form),$containers=$(".main-container");switchContainer("form"),taskCreationButton=taskCreationButtonFactory({type:"info",icon:"export",title:__("Export Irregularities"),label:__("Export"),taskQueue:taskQueue,taskCreationUrl:$form.prop("action"),taskCreationData:function getTaskCreationData(){return $form.serializeArray()},taskReportContainer:$reportContainer}).on("finished",function(result){result.task&&result.task.report&&_.isArray(result.task.report.children)&&result.task.report.children.length&&result.task.report.children[0]&&(result.task.report.children[0].data&&result.task.report.children[0].data.uriResource?(feedback().info(__("%s completed",result.task.taskLabel)),refreshTree(result.task.report.children[0].data.uriResource)):this.displayReport(result.task.report.children[0],__("Error")))}).on("continue",function(){refreshTree()}).on("error",function(err){feedback().error(err)}).render($submitter.closest(".form-toolbar")),$submitter.replaceWith(taskCreationButton.getElement().css({float:"right"}))}}}),define("taoProctoring/component/history/historyTable",["jquery","lodash","i18n","ui/component","ui/datatable"],function($,_,__,component){"use strict";function renderDetails(details){return _.isArray(details)&&(details=details.join("<br />")),details}function historyTableFactory(config,data){var initConfig=_.defaults(config||{},_defaults),historyTable={refresh:function refresh(params){var $element;this.is("rendered")?($element=this.getElement(),params&&$element.datatable("options",{params:params}),$element.datatable("refresh")):params&&(initConfig.params=_.merge(initConfig.params,params))}};return component(historyTable).on("render",function(){var self=this,tools=[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){self.refresh()}}];this.getElement().on("query.datatable",function(){self.trigger("loading")}).on("load.datatable",function(){self.trigger("loaded")}).on("error.datatable",function(e,err){self.trigger("error",err)}).datatable({url:initConfig.service,params:initConfig.params,sortby:initConfig.sortBy,sortorder:initConfig.sortOrder,status:{empty:__("No history to display!"),available:__("Available history"),loading:__("Loading")},selectable:!!(initConfig.tools&&_.find(initConfig.tools,{massAction:!0})),tools:tools.concat(initConfig.tools||[]),model:[{id:"date",label:__("Date"),sortable:!0},{id:"role",label:__("Role"),sortable:!0},{id:"actor",label:__("Actor"),sortable:!0},{id:"event",label:__("Event"),sortable:!0},{id:"details",label:__("Details"),transform:renderDetails},{id:"context",label:__("Context"),transform:renderDetails}]},data)}).init(initConfig)}var _defaults={sortBy:"timestamp",sortOrder:"desc"};return historyTableFactory}),define("tpl!taoProctoring/templates/reporting/index",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<h1>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:21},end:{line:2,column:30}}}):helper))+"</h1>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"content\">\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"title"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:4},end:{line:2,column:42}}}))?"":stack1)+"\n    <div class=\"panel\"></div>\n    <div class=\"list clearfix\"></div>\n</div>"},useData:!0})}),define("taoProctoring/controller/Reporting/history",["lodash","i18n","util/url","controller/app","layout/loading-bar","ui/container","ui/button","ui/dateRange/dateRange","util/encode","util/locale","taoProctoring/component/proxy","taoProctoring/component/history/historyTable","tpl!taoProctoring/templates/reporting/index","moment","ui/datatable"],function(_,__,urlHelper,appController,loadingBar,containerFactory,buttonFactory,dateRangeFactory,encode,locale,proxyFactory,historyTableFactory,indexTpl,moment){"use strict";var cssScope=".session-history",serviceUrl=urlHelper.route("sessionHistory","Reporting","taoProctoring"),sessionsUrl=urlHelper.route("history","Reporting","taoProctoring");return loadingBar.start(),{start:function start(){function transformDateQueryParam(pickerDate){if(pickerDate){const dateObject=moment(pickerDate,dateFormat);if(dateObject.isValid())return dateObject.format("YYYY-MM-DD")}return null}var container=containerFactory().changeScope(".session-history").write(indexTpl()),currentRoute=urlHelper.parse(window.location.href),context=currentRoute.query.context&&decodeURIComponent(currentRoute.query.context),deliveryId=currentRoute.query.delivery&&decodeURIComponent(currentRoute.query.delivery),sessions=decodeURIComponent(currentRoute.query.session).split(","),monitoringUrl=currentRoute.query.monitoring&&decodeURIComponent(currentRoute.query.monitoring),dateFormat=locale.getDateTimeFormat().split(" ")[0];appController.on("set-referrer.history",function(route){monitoringUrl=route}).on("change.history",function(){appController.off(".history"),container.destroy()}),proxyFactory("ajax").init({actions:{read:serviceUrl}}).then(function(proxyService){return proxyService.read({delivery:deliveryId,context:context,session:sessions}).then(function(data){var detailedHistory=data.detailedHistory,historyTable=historyTableFactory({tools:[{id:"show-detailed-report",icon:"insert-horizontal-line",title:__("Show detailed session history messages"),label:__("Show detailed report"),action:function(){var tool=_.find(historyTable.config.tools,{id:"show-detailed-report"});historyTable.config.params.detailed=detailedHistory=!detailedHistory,tool.label=detailedHistory?__("Show brief report"):__("Show detailed report"),historyTable.refresh()}}],params:{detailed:detailedHistory,delivery:deliveryId,context:context,session:sessions},service:sessionsUrl,sortBy:data.sortBy,sortOrder:data.sortOrder},data.set).on("loading",function(){loadingBar.start()}).on("loaded",function(){loadingBar.stop()}).on("error",function(err){appController.onError(err)}).render(container.find(".list"));return data.monitoringUrl&&(monitoringUrl=data.monitoringUrl),new Promise(function(resolve,reject){dateRangeFactory(container.find(".panel"),{resetButton:{enable:!1},applyButton:{enable:!0,label:__("Filter"),title:__("Filter by the selected dates")},startPicker:{setup:"date",format:dateFormat,field:{value:data.periodStart,name:"periodStart"}},endPicker:{setup:"date",format:dateFormat,field:{value:data.periodEnd,name:"periodEnd"}}}).on("ready",resolve).on("error",reject).on("submit reset",function(){historyTable.refresh({periodStart:transformDateQueryParam(this.getStart()),periodEnd:transformDateQueryParam(this.getEnd())})})}).then(function(){buttonFactory({id:"back",type:"info",label:__("Back to sessions"),cls:"back-button",renderTo:container.find(".panel")}).on("click",function(){monitoringUrl?appController.getRouter().redirect(monitoringUrl):history.go(-1)})})})}).catch(function(err){appController.onError(err),loadingBar.stop()})}}}),define("taoProctoring/controller/routes",{Reporting:{actions:{index:"controller/Reporting/history"}},Irregularity:{actions:{index:"controller/Irregularity/index"}},DeliverySelection:{actions:{index:"controller/Delivery/index"}},Monitor:{actions:{index:"controller/Delivery/monitoring"}},Tools:{css:"tools",actions:{assessmentActivity:"controller/Tools/assessmentActivity"}}}),define("tpl!taoProctoring/component/activityMonitoring/userActivity/userActivityBlock",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"col-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"size")||(null==depth0?depth0:lookupProperty(depth0,"size")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"size",hash:{},data:data,loc:{start:{line:1,column:16},end:{line:1,column:24}}}):helper))+" dashboard-block\">\n        <span class=\"dashboard-block-number "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"container")||(null==depth0?depth0:lookupProperty(depth0,"container")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"container",hash:{},data:data,loc:{start:{line:2,column:44},end:{line:2,column:59}}}):helper))+"\">\n            "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"value")||(null==depth0?depth0:lookupProperty(depth0,"value")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"value",hash:{},data:data,loc:{start:{line:3,column:12},end:{line:3,column:23}}}):helper))+"\n        </span>\n    <h3>\n        <span class=\"icon icon-test-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"icon")||(null==depth0?depth0:lookupProperty(depth0,"icon")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"icon",hash:{},data:data,loc:{start:{line:6,column:36},end:{line:6,column:44}}}):helper))+"\"></span>\n        "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:7,column:8},end:{line:7,column:19}}}):helper))+"\n    </h3>\n</div>"},useData:!0})}),define("tpl!taoProctoring/component/activityMonitoring/userActivity/userActivity",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return null==(stack1=container.invokePartial(lookupProperty(partials,"ui-activity-widget-group"),depth0,{name:"ui-activity-widget-group",data:data,indent:"    ",helpers:helpers,partials:partials,decorators:container.decorators}))?"":stack1},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div>\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:4},end:{line:4,column:13}}}))?"":stack1)+"</div>"},usePartial:!0,useData:!0})}),define("taoProctoring/component/activityMonitoring/userActivity/userActivity",["jquery","lodash","i18n","ui/component","handlebars","tpl!taoProctoring/component/activityMonitoring/userActivity/userActivityBlock","tpl!taoProctoring/component/activityMonitoring/userActivity/userActivity"],function($,_,__,component,Handlebars,groupTpl,componentTpl){"use strict";function userActivityFactory(config){return config=config||{},component({update:function update(data){var metricsWidget;for(metricsWidget in _.merge(this.config,data),this.config)this.config.hasOwnProperty(metricsWidget)&&$("."+this.config[metricsWidget].container,this.getElement()).text(this.config[metricsWidget].value)}},_defaults).setTemplate(componentTpl).init(config)}var _defaults={activeProctors:{container:"active-proctors",label:__("Active proctors"),size:4,icon:"taker",value:0},activeTestTakers:{container:"active-test-takers",label:__("Active test-takers"),size:4,icon:"takers",value:0}};return Handlebars.registerPartial("ui-activity-widget-group",groupTpl),userActivityFactory}),define("tpl!taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div>\n    <div class=\"col-4 dashboard-block\">\n        <h4>\n            <span class=\"icon icon-play\"></span>\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"current"))?stack1:lookupProperty(stack1,"label"),depth0))+"\n        </h4>\n        <span class=\"dashboard-block-number "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"current"))?stack1:lookupProperty(stack1,"container"),depth0))+"\">\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"current"))?stack1:lookupProperty(stack1,"value"),depth0))+"\n        </span>\n    </div>\n\n    <div class=\"col-2 dashboard-block\">\n        <h4>\n            <span class=\"icon icon-play\"></span>\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"inProgress"))?stack1:lookupProperty(stack1,"label"),depth0))+"\n        </h4>\n        <span class=\"dashboard-block-number "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"inProgress"))?stack1:lookupProperty(stack1,"container"),depth0))+"\">\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"inProgress"))?stack1:lookupProperty(stack1,"value"),depth0))+"\n        </span>\n    </div>\n\n    <div class=\"col-2 dashboard-block\">\n        <h4>\n            <span class=\"icon icon-time\"></span>\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"awaiting"))?stack1:lookupProperty(stack1,"label"),depth0))+"\n        </h4>\n        <span class=\"dashboard-block-number "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"awaiting"))?stack1:lookupProperty(stack1,"container"),depth0))+"\">\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"awaiting"))?stack1:lookupProperty(stack1,"value"),depth0))+"\n        </span>\n    </div>\n\n    <div class=\"col-2 dashboard-block\">\n        <h4>\n            <span class=\"icon icon-continue\"></span>\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"authorized"))?stack1:lookupProperty(stack1,"label"),depth0))+"\n        </h4>\n        <span class=\"dashboard-block-number "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"authorized"))?stack1:lookupProperty(stack1,"container"),depth0))+"\">\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"authorized"))?stack1:lookupProperty(stack1,"value"),depth0))+"\n        </span>\n    </div>\n\n    <div class=\"col-2 dashboard-block\">\n        <h4>\n            <span class=\"icon icon-pause\"></span>\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"paused"))?stack1:lookupProperty(stack1,"label"),depth0))+"\n        </h4>\n        <span class=\"dashboard-block-number "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"paused"))?stack1:lookupProperty(stack1,"container"),depth0))+"\">\n            "+container.escapeExpression(container.lambda(null==(stack1=null==(stack1=null==depth0?depth0:lookupProperty(depth0,"assessments"))?stack1:lookupProperty(stack1,"paused"))?stack1:lookupProperty(stack1,"value"),depth0))+"\n        </span>\n    </div>\n</div>"},useData:!0})}),define("taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity",["jquery","lodash","i18n","ui/component","tpl!taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity"],function($,_,__,component,tpl){"use strict";function currentAssessmentActivityFactory(config){return config=config||{},component({update:function update(data){_.merge(this.config.assessments,data),_.each(this.config.assessments,function(val){$("."+val.container,this.getElement()).text(val.value)},this)}},_defaults).setTemplate(tpl).init(config)}var _defaults={assessments:{awaiting:{container:"awaiting-assessments",label:__("Awaiting"),value:0},authorized:{container:"authorized-but-not-started-assessments",label:__("Authorized"),value:0},current:{container:"current-assessments",label:__("Total Current Assessments"),value:0},inProgress:{container:"in-progress-assessments",label:__("In Progress"),value:0},paused:{container:"paused-assessments",label:__("Paused"),value:0}}};return currentAssessmentActivityFactory}),define("tpl!taoProctoring/component/activityMonitoring/progressbar",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){return"<div class=\"js-completed-assessments-refresh-bar refresh-bar\">\n    <div class=\"js-refresh-bar-progress refresh-bar-progress\"></div>\n</div>"},useData:!0})}),define("taoProctoring/component/activityMonitoring/activityGraph",["jquery","lodash","i18n","ui/component","util/url","c3","tpl!taoProctoring/component/activityMonitoring/progressbar","core/polling"],function($,_,__,component,url,c3,progressbarTpl,pollingFactory){"use strict";function runRefreshProgressBar($refreshProgress,duration){duration/=1e3,$refreshProgress.css({"-webkit-transition":"width 0s","-moz-transition":"width 0s","-o-transition":"width 0s",transition:"width 0s",width:"0%"}),$refreshProgress.hide().show(),$refreshProgress.css({"-webkit-transition":"width "+duration+"s linear","-moz-transition":"width "+duration+"s linear","-o-transition":"width "+duration+"s linear",transition:"width "+duration+"s linear",width:"100%"})}function activityGraphFactory(config){var chart,$refreshProgress,$progressbar,polling,initConfig=_.merge({},_defaults,config),activityGraph={refresh:function refresh(newConfig){chart&&(initConfig=_.merge({},initConfig,newConfig),chart.internal.config.axis_x_tick_format=initConfig.graphConfig.axis.x.tick.format,chart.axis.labels({x:initConfig.graphConfig.axis.x.label.text}),chart.load(initConfig.graphConfig.data))}};return component(activityGraph).on("render",function(){chart=c3.generate(initConfig.graphConfig),initConfig.autoRefresh&&($progressbar=$(progressbarTpl()),$(initConfig.graphConfig.bindto).after($progressbar),$refreshProgress=$progressbar.find(".js-refresh-bar-progress"),initConfig.autoRefreshBar&&runRefreshProgressBar($refreshProgress,initConfig.autoRefresh),polling=pollingFactory({action:function(){chart.load(initConfig.graphConfig.data),initConfig.autoRefreshBar&&runRefreshProgressBar($refreshProgress,initConfig.autoRefresh)},interval:initConfig.autoRefresh,autoStart:!0}))}).on("destroy",function(){polling&&polling.stop()}).init(initConfig)}var _defaults={autoRefresh:0,autoRefreshBar:!1,transition:{duration:3e3},graphConfig:{padding:{bottom:0,left:35},data:{x:"time",xFormat:"%Y-%m-%d %H:%M:%S",mimeType:"json",type:"bar"},axis:{x:{type:"timeseries",tick:{format:"%H:%M"},label:{position:"bottom center"}},y:{label:{position:"top"}}}}};return activityGraphFactory}),define("taoProctoring/component/activityMonitoring/deliveriesList/deliveriesList",["jquery","i18n","util/url","ui/component","util/locale","ui/datatable"],function($,__,url,component,locale){"use strict";function deliveriesListFactory(config){return config=config||{},component({update:function update(){this.$datatable.datatable("refresh")}},_defaults).on("render",function(){this.$datatable=this.getElement().datatable({url:url.route("deliveriesActivityData","Tools","taoProctoring"),filter:!1,model:this.config.model,paginationStrategyTop:"none",paginationStrategyBottom:"simple",rows:10,selectable:!0,sortorder:"asc",sortby:"label"},this.config.model)}).init(config)}var _defaults={model:[{id:"label",label:__("Delivery"),sortable:!0},{id:__("Awaiting"),label:__("Awaiting"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Authorized"),label:__("Authorized"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Paused"),label:__("Paused"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Active"),label:__("Active"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Terminated"),label:__("Terminated"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Canceled"),label:__("Canceled"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Finished"),label:__("Finished"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Last launch"),label:__("Last launch"),sortable:!0,transform:function(value){return locale.formatDateTime(value)}}]};return deliveriesListFactory}),define("taoProctoring/controller/Tools/assessmentActivity",["jquery","d3","lodash","i18n","helpers","util/url","core/dataProvider/request","core/polling","ui/feedback","ui/cascadingComboBox","ui/bulkActionPopup","taoProctoring/component/activityMonitoring/userActivity/userActivity","taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity","taoProctoring/component/activityMonitoring/activityGraph","taoProctoring/component/activityMonitoring/deliveriesList/deliveriesList"],function($,d3,_,__,helpers,url,request,polling,feedback,cascadingComboBox,bulkActionPopup,userActivityFactory,currentAssessmentActivityFactory,activityGraphFactory,deliveriesListFactory){"use strict";function doPause(reason){request(url.route("pauseActiveExecutions","Tools","taoProctoring"),{reason:reason},"POST").then(function(data){helpers.loaded(),feedback().success(data.message)}).catch(function(err){helpers.loaded(),feedback().error(err.message)})}var pauseMsg=__("Warning, you are about to pause all in progress tests. All test takers will be paused on or before the next heartbeat. Please provide a reason for this action.");return{start:function(){var activityGraph,assessmentActivityAutoRefreshInterval,completedAssessmentsAutoRefreshInterval,config,currentAssessmentActivity,deliveriesList,pauseReasonCategories,poll,userActivity,$container=$(".activity-dashboard");config=$container.data("config"),assessmentActivityAutoRefreshInterval=1e3*parseInt(config.assessment_activity_auto_refresh),completedAssessmentsAutoRefreshInterval=1e3*parseInt(config.completed_assessments_auto_refresh),userActivity=userActivityFactory(config.userActivityWidgets).render($(".user-activity",$container)),currentAssessmentActivity=currentAssessmentActivityFactory().render($(".assessment-activity",$container)),activityGraph=activityGraphFactory({autoRefresh:Math.max(completedAssessmentsAutoRefreshInterval,assessmentActivityAutoRefreshInterval),autoRefreshBar:!0,graphConfig:{bindto:$(".js-completed-assessments",$container).selector,data:{url:url.route("completedAssessmentsData","Tools","taoProctoring")},axis:{x:{label:{text:__("Hours")}},y:{label:{text:__("Completed tests")},tick:{format:d3.format("d")}}},tooltip:{format:{name:function(){return __("Completed")}}},legend:{show:!1}}}).render(),$(".js-activity-chart-interval",$container).on("change",function(){var interval=$(this).val();activityGraph.refresh({graphConfig:{data:{url:url.route("completedAssessmentsData","Tools","taoProctoring",{interval:interval})},axis:{x:{tick:{format:"day"===interval?"%H:%M":"%m-%d"},label:{text:"day"===interval?__("Hours"):__("Days")}}}}})}),deliveriesList=deliveriesListFactory().render($(".js-delivery-list")),poll=polling({action:function(){request(url.route("assessmentActivityData","Tools","taoProctoring")).then(function(data){var uaData={};data&&data.group_user_activity&&_.forEach(data.group_user_activity,function(v,k){uaData[$.camelCase(k.replace(/_/g,"-"))]={value:v}}),userActivity.update(uaData),currentAssessmentActivity.update({awaiting:{value:data&&data.awaiting_assessments},authorized:{value:data&&data.authorized_but_not_started_assessments},current:{value:data&&data.total_current_assessments},inProgress:{value:data&&data.in_progress_assessments},paused:{value:data&&data.paused_assessments}}),deliveriesList.update()}).catch(function(err){feedback().error(err.message),poll.stop()})}}).next().stop(),assessmentActivityAutoRefreshInterval&&(poll.setInterval(assessmentActivityAutoRefreshInterval),poll.start()),pauseReasonCategories=$(".js-pause-active-executions-container").data("reasoncategories"),$(".js-pause",$container).on("click",function(){bulkActionPopup({renderTo:$(".js-pause-active-executions-container",$container),actionName:pauseMsg,reason:!0,allowedResources:[],reasonRequired:!0,categoriesSelector:cascadingComboBox(pauseReasonCategories.pause)}).on("ok",function(reason){doPause(reason)})})}}}),define("taoProctoring/helper/textConverter",["jquery","lodash","core/format","core/promise","util/url"],function($,_,format,Promise,url){"use strict";function proctoringLabelsLoader(){return pendingPromise||(pendingPromise=new Promise(function(resolve,reject){$.ajax({url:url.route("getAll","TextConverter","taoProctoring"),type:"POST",dataType:"json"}).done(function(data){labels=data.translations,resolve(proctoringLabels)}).fail(reject)})),pendingPromise}var pendingPromise,labels=null,proctoringLabels={get:function get(message){null==labels[message]&&console.log(message);var localized=labels[message]?labels[message]:message;return 1<arguments.length&&(arguments[0]=localized,localized=format.apply(null,arguments)),localized}};return proctoringLabelsLoader}),define("taoProctoring/loader/taoProctoring.bundle",function(){}),window.bundles=(window.bundles||[]).concat(["taoQtiItem/loader/taoQtiItem.min","taoItems/loader/taoItems.min","taoQtiTest/loader/taoQtiTest.min"]);
//# sourceMappingURL=taoProctoring.min.js.map