define("taoProctoring/controller/routes",{TestCenter:{actions:{index:"controller/TestCenter/index",testCenter:"controller/TestCenter/testCenter"}},TestCenterManager:{actions:{editCenter:"controller/TestCenterManager/editCenter"}},ProctorManager:{actions:{index:"controller/ProctorManager/index"}},Diagnostic:{actions:{index:"controller/Diagnostic/index",diagnostic:"controller/Diagnostic/diagnostic"}},Reporting:{actions:{index:"controller/Reporting/index"}},Delivery:{actions:{index:"controller/Delivery/index",manage:"controller/Delivery/manage",monitoring:"controller/Delivery/monitoring",monitoringAll:"controller/Delivery/monitoring",testTakers:"controller/Delivery/testTakers"
}}}),define("taoProctoring/helper/status",["lodash","i18n"],function(_,__){"use strict";function getStatus(statusName){return _status[statusName]}function getStatusByCode(statusCode){return _.find(_status,{code:statusCode})}function verifyTestTaker(testTakerData,actionName){var formatted={id:testTakerData.id,label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(testTakerData.state.status);return status&&(formatted.allowed=status.can[actionName]===!0,formatted.allowed||(formatted.reason=status.can[actionName])),formatted}function getStatuses(){return _.map(_status,function(el){return{code:el.code,label:el.label}})}var _init="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusInit",_awaiting="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAwaiting",_authorized="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAuthorized",_inprogress="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusActive",_paused="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusPaused",_completed="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusFinished",_terminated="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusTerminated",_status={
init:{code:_init,label:__("Init"),can:{authorize:__("not awaiting"),pause:__("not in progress"),terminate:!0,report:!0}},awaiting:{code:_awaiting,label:__("Awaiting"),can:{authorize:!0,pause:__("not in progress"),terminate:!0,report:!0}},authorized:{code:_authorized,label:__("Authorized but not started"),can:{authorize:__("already authorized"),pause:__("not started"),terminate:!0,report:!0}},inprogress:{code:_inprogress,label:__("In Progress"),can:{authorize:__("already authorized"),pause:!0,terminate:!0,report:!0}},paused:{code:_paused,label:__("Paused"),can:{authorize:__("is paused"),pause:__("is already paused"),terminate:!0,report:!0}},completed:{code:_completed,
label:__("Completed"),can:{authorize:__("is completed"),pause:__("is completed"),terminate:__("is completed"),report:!0}},terminated:{code:_terminated,label:__("Terminated"),can:{authorize:__("is terminated"),pause:__("is terminated"),terminate:__("is terminated"),report:!0}}};return{getStatuses:getStatuses,getStatus:getStatus,getStatusByCode:getStatusByCode,verifyTestTaker:verifyTestTaker,STATUS_INIT:_init,STATUS_AUTHORIZED:_authorized,STATUS_INPROGRESS:_inprogress,STATUS_PAUSED:_paused,STATUS_COMPLETED:_completed,STATUS_TERMINATED:_terminated}}),define("taoProctoring/component/breadcrumbs",["ui/breadcrumbs"],function(breadcrumbs){return function($container,crumbs){
return breadcrumbs({breadcrumbs:crumbs||$container.data("breadcrumbs"),renderTo:$container.find(".header"),replace:!0,cls:"action-bar horizontal-action-bar"})}}),define("tpl!taoProctoring/templates/delivery/listBoxActions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<span class="listbox-actions">\n    <span class="action pause" data-delivery="',(helper=helpers.id)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n        <span class="icon-pause"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'\n    </span>\n    <span class="action play">\n        <span class="icon-play"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Monitor",options):helperMissing.call(depth0,"__","Monitor",options)))+"\n    </span>\n</span>";
})}),define("tpl!taoProctoring/templates/delivery/listBoxStats",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n<ul class="plain listbox-properties">\n    <li>\n        <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start",options):helperMissing.call(depth0,"__","Start",options)))+"</label>: ",(helper=helpers.periodStart)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.periodStart,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </li>\n    <li>\n        <label>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"End",options):helperMissing.call(depth0,"__","End",options)))+"</label>: ",(helper=helpers.periodEnd)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.periodEnd,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </li>\n</ul>\n"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return stack1=helpers["if"].call(depth0,depth0&&depth0.showProperties,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n<p class="listbox-stats">\n    <span class="icon-lock"></span><span class="number">',(helper=helpers.locked)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.locked,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span class="icon-play"></span><span class="number">',(helper=helpers.inProgress)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.inProgress,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span class="icon-pause"></span><span class="number">',(helper=helpers.paused)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.paused,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</p>"})}),define("taoProctoring/controller/Delivery/index",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/listbox","util/encode","ui/feedback","ui/bulkActionPopup","ui/cascadingComboBox","taoProctoring/helper/status","taoProctoring/component/breadcrumbs","tpl!taoProctoring/templates/delivery/listBoxActions","tpl!taoProctoring/templates/delivery/listBoxStats"],function(_,$,__,helpers,loadingBar,listBox,encode,feedback,bulkActionPopup,cascadingComboBox,_status,breadcrumbsFactory,actionsTpl,statsTpl){
"use strict";var cssScope=".delivery-index";loadingBar.start();var taoProctoringCtlr={start:function(){function format(boxes){return _.each(boxes,function(box){var props=box.properties,tplData={locked:box.stats.awaitingApproval,inProgress:box.stats.inProgress,paused:box.stats.paused};props&&props.periodStart&&props.periodEnd&&(tplData.showProperties=!0,tplData.periodStart=props.periodStart,tplData.periodEnd=props.periodEnd,box.cls="has-properties-displayed"),box.html=actionsTpl({id:box.id}),box.content=statsTpl(tplData)}),boxes}function update(boxes){list.update(format(boxes)),loadingBar.stop()}function refresh(){loadingBar.start(),list.setLoading(!0),$.ajax({
url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(boxes){update(boxes)})}function pause(deliveryId,selection){var allowed=_.map(selection,function(data){return{id:data.id,label:data.testTaker.firstName+" "+data.testTaker.lastName}});bulkActionPopup({renderTo:$container,actionName:__("Pause Session"),reason:!0,resourceType:"test taker",categoriesSelector:cascadingComboBox({categoriesDefinitions:categories.pause.categoriesDefinitions,categories:categories.pause.categories}),allowedResources:allowed}).on("ok",function(reason){$.ajax({url:helpers._url("pauseExecutions","Delivery","taoProctoring"),data:{delivery:deliveryId,testCenter:testCenterId,
execution:_.pluck(selection,"id"),reason:reason},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success("Selected deliveries successfully paused"),refresh()):feedback().warning(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})})})}var $container=$(cssScope),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),categories=$container.data("categories"),testCenterId=$container.data("testcenter"),list=listBox({title:__("Sessions"),textEmpty:__("No sessions available"),textNumber:__("Available"),textLoading:__("Loading"),
renderTo:$container.find(".content"),replace:!0,list:format(boxes),width:12,countRenderer:function(count){return count-1}}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("deliveries","Delivery","taoProctoring",{testCenter:testCenterId}));$container.on("click",".pause",function(e){var deliveryId=$(this).data("delivery"),pauseUrl="all"===deliveryId?helpers._url("allDeliveriesExecutions","Delivery","taoProctoring",{testCenter:testCenterId}):helpers._url("deliveryExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId});e.stopPropagation(),e.preventDefault(),$.get(pauseUrl,function(res){if(_.isPlainObject(res)&&_.isArray(res.data)){
var inProgressExecs=_.filter(res.data,function(data){return data.state&&data.state.status===_status.getStatus("inprogress").code});inProgressExecs.length?pause(deliveryId,inProgressExecs):feedback().info(__("There is no delivery in progress"))}})}),boxes?loadingBar.stop():refresh()}};return taoProctoringCtlr}),define("taoProctoring/controller/Delivery/manage",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory){"use strict";var cssScope=".delivery-manager";loadingBar.start();var proctorDeliveryIndexCtlr={
start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),assignUrl=helpers._url("testTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),removeUrl=helpers._url("removeTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),monitoringUrl=helpers._url("monitoring","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId
}),request=(breadcrumbsFactory($container,crumbs),function(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}),remove=function(selection){request(removeUrl,selection,__("Test takers have been removed"))};$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){loadingBar.stop();
}).datatable({url:serviceUrl,status:{empty:__("No assigned test takers"),available:__("Assigned test takers"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"back",icon:"preview",title:__("Return to the session monitoring"),label:__("Monitoring"),action:function(){location.href=monitoringUrl}},{id:"assign",icon:"add",title:__("Assign more test takers to this session"),label:__("Add test takers"),action:function(){location.href=assignUrl}},{id:"remove",icon:"remove",title:__("Remove the selected test takers from the session"),label:__("Remove"),massAction:!0,
action:function(selection){dialog({message:__("The test takers will be removed from this session. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}],actions:[{id:"remove",icon:"remove",title:__("Remove the test taker from the session"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The test taker will be removed from this session. Continue ?"),onOkBtn:function(){remove([id])}})}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")},{id:"status",label:__("Status")}]},dataset)}};return proctorDeliveryIndexCtlr}),define("tpl!taoProctoring/templates/delivery/deliveryLink",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<a class="elipsis" href="',(helper=helpers.url)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.url,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</a>"})}),define("tpl!taoProctoring/templates/delivery/statusFilter",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <option value="',(helper=helpers.code)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.code,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<select class="filter status select2">\n    <option value="" selected></option>\n    ',stack1=helpers.each.call(depth0,depth0&&depth0.statuses,{hash:{},inverse:self.noop,
fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</select>"})}),define("taoProctoring/controller/Delivery/monitoring",["jquery","lodash","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","ui/bulkActionPopup","ui/cascadingComboBox","taoProctoring/component/breadcrumbs","taoProctoring/helper/status","tpl!taoProctoring/templates/delivery/deliveryLink","tpl!taoProctoring/templates/delivery/statusFilter","ui/datatable","select2"],function($,_,__,helpers,loadingBar,encode,feedback,dialog,bulkActionPopup,cascadingComboBox,breadcrumbsFactory,_status,deliveryLinkTpl,statusFilterTpl){"use strict";
var cssScope=".delivery-monitoring";loadingBar.start();var proctorDeliveryIndexCtlr={start:function(){function request(url,selection,reason,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{execution:selection,reason:reason},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}function authorise(selection){execBulkAction("authorize",__("Authorize Session"),selection,function(selection,reason){
request(authoriseUrl,selection,reason,__("Sessions authorized"))})}function pause(selection){execBulkAction("pause",__("Pause Session"),selection,function(selection,reason){request(pauseUrl,selection,reason,__("Sessions paused"))})}function terminate(selection){execBulkAction("terminate",__("Terminate Session"),selection,function(selection,reason){request(terminateUrl,selection,reason,__("Sessions terminated"))})}function report(selection){execBulkAction("report",__("Report Irregularity"),selection,function(selection,reason){request(reportUrl,selection,reason,__("Sessions reported"))})}function verifyTestTaker(testTakerData,actionName){var formatted={id:testTakerData.id,
label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(testTakerData.state.status);return status&&(formatted.allowed=status.can[actionName]===!0,formatted.allowed||(formatted.reason=status.can[actionName])),formatted}function getExecutionData(uri){return _.find(dataset.data,{id:uri})}function execBulkAction(actionName,actionTitle,selection,cb){var allowedTestTakers=[],forbiddenTestTakers=[],_selection=_.isArray(selection)?selection:[selection],askForReason=categories[actionName]&&categories[actionName].categoriesDefinitions&&categories[actionName].categoriesDefinitions.length;_.each(_selection,function(uri){var checkedTestTaker,testTaker=getExecutionData(uri);
testTaker&&(checkedTestTaker=verifyTestTaker(testTaker,actionName),checkedTestTaker.allowed?allowedTestTakers.push(checkedTestTaker):forbiddenTestTakers.push(checkedTestTaker))});var config={renderTo:$content,actionName:actionTitle,reason:askForReason,reasonRequired:!0,resourceType:"test taker",categoriesSelector:cascadingComboBox(categories[actionName]),allowedResources:allowedTestTakers,deniedResources:forbiddenTestTakers};bulkActionPopup(config).on("ok",function(reason){_.isFunction(cb)&&cb(_selection,reason)})}function buildStatusFilter(){return statusFilterTpl({statuses:_status.getStatuses()})}function statusFilterHandler($el){$el.select2({dropdownAutoWidth:!0,
placeholder:__("Filter"),minimumResultsForSearch:1/0,allowClear:!0})}var actionButtons,$container=$(cssScope),$content=$container.find(".content"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),extraFields=$container.data("extrafields"),categories=$container.data("categories"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),manageUrl=helpers._url("manage","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),terminateUrl=helpers._url("terminateExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),pauseUrl=helpers._url("pauseExecutions","Delivery","taoProctoring",{
delivery:deliveryId,testCenter:testCenterId}),authoriseUrl=helpers._url("authoriseExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),reportUrl=helpers._url("reportExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceAllUrl=helpers._url("allDeliveriesExecutions","Delivery","taoProctoring",{testCenter:testCenterId}),tools=[],actions=[],model=[];breadcrumbsFactory($container,crumbs);tools.push({id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){
$list.datatable("refresh")}}),deliveryId&&tools.push({id:"manage",icon:"property-advanced",title:__("Manage sessions"),label:__("Manage"),action:function(){location.href=manageUrl}}),tools.push({id:"authorise",icon:"play",title:__("Authorize sessions"),label:__("Authorise"),massAction:!0,action:authorise}),tools.push({id:"pause",icon:"pause",title:__("Pause sessions"),label:__("Pause"),massAction:!0,action:pause}),tools.push({id:"terminate",icon:"stop",title:__("Terminate sessions"),label:__("Terminate"),massAction:!0,action:terminate}),tools.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularities"),label:__("Report"),massAction:!0,action:report
}),actions.push({id:"authorise",icon:"play",title:__("Authorize session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.authorize!==!0):!0},action:authorise}),actions.push({id:"pause",icon:"pause",title:__("Pause session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.pause!==!0):!0},action:pause}),actions.push({id:"terminate",icon:"stop",title:__("Terminate session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),
!status||status.can.terminate!==!0):!0},action:terminate}),actions.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularity"),action:report}),deliveryId||model.push({id:"delivery",label:__("Session"),sortable:!0,transform:function(value,row){var delivery=row&&row.delivery;return delivery&&(delivery.url=helpers._url("monitoring","Delivery","taoProctoring",{delivery:delivery.uri,testCenter:testCenterId}),value=deliveryLinkTpl(delivery)),value}}),model.push({id:"firstname",label:__("First name"),sortable:!0,transform:function(value,row){return row&&row.testTaker&&row.testTaker.firstName||""}}),model.push({id:"lastname",label:__("Last name"),sortable:!0,
transform:function(value,row){return row&&row.testTaker&&row.testTaker.lastName||""}}),_.each(extraFields,function(extraField){model.push({id:extraField.id,label:extraField.label,sortable:!0,transform:function(value,row){return row&&row.extraFields&&row.extraFields[extraField.id]||""}})}),model.push({id:"date",sortable:!0,label:__("Started at")}),model.push({id:"status",label:__("Status"),sortable:!0,filterable:!0,customFilter:{template:buildStatusFilter(),callback:statusFilterHandler},transform:function(value,row){var status,result="";return row&&row.state&&row.state.status&&(status=_status.getStatusByCode(row.state.status),status&&(result=status.label,"INPROGRESS"===row.state.status&&(result=status.label))),
result}}),model.push({id:"connectivity",sortable:!0,label:__("Connectivity"),transform:function(value,row){return row.state.status===_status.STATUS_INPROGRESS?__(row.online?"online":"offline"):""}}),model.push({id:"progress",label:__("Progress"),transform:function(value,row){return row&&row.state&&row.state.progress||""}}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,newDataset){dataset=newDataset,actionButtons=_({authorize:$list.find(".action-bar").children(".tool-authorise"),pause:$list.find(".action-bar").children(".tool-pause"),terminate:$list.find(".action-bar").children(".tool-terminate"),report:$list.find(".action-bar").children(".tool-irregularity")
}),loadingBar.stop()}).on("select.datatable",function(e,newDataset){actionButtons.each(function($btn){$btn.hide()}),_($list.datatable("selection")).map(function(uri){var row=getExecutionData(uri);return row.state.status}).uniq().each(function(statusCode){var status=_status.getStatusByCode(statusCode);actionButtons.forIn(function($btn,action){status&&status.can[action]===!0&&$btn.show()})})}).datatable({url:deliveryId?serviceUrl:serviceAllUrl,status:{empty:__("No sessions"),available:__("Current sessions"),loading:__("Loading")},filter:!0,filtercolumns:["status"],tools:tools,actions:actions,model:model,selectable:!0,sortorder:"desc",sortby:"date"},dataset)}};return proctorDeliveryIndexCtlr;
}),define("taoProctoring/controller/Delivery/testTakers",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,breadcrumbsFactory){"use strict";var cssScope=".delivery-testtakers";loadingBar.start();var proctorDeliveryAssignCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),serviceUrl=helpers._url("availableTestTakers","Delivery","taoProctoring",{delivery:deliveryId,
testCenter:testCenterId}),assignUrl=helpers._url("assignTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),managerUrl=helpers._url("manage","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),assign=(breadcrumbsFactory($container,crumbs),function(selection){selection&&selection.length&&(loadingBar.start(),$.ajax({url:assignUrl,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success(__("Test takers have been added")),location.href=managerUrl):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{
encodeHtml:!1})}))});$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(event,response){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No available test takers to assign"),available:__("Available test takers"),loading:__("Loading")},tools:[{id:"back",icon:"left",title:__("Return to the session manager"),label:__("Back"),action:function(){location.href=managerUrl}},{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"assign",icon:"add",title:__("Assign the selected test takers to the session"),label:__("Assign the selected test takers"),
massAction:!0,action:function(selection){assign(selection)}}],actions:[{id:"assign",icon:"add",title:__("Assign the test taker to the session"),action:function(id){assign([id])}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")}]},dataset)}};return proctorDeliveryAssignCtlr}),define("taoQtiTest/testRunner/resumingStrategy/keepAfterResume",[],function(){"use strict";var sessionStateFactory=function(options){function _start(){if(null!==_interval)throw new TypeError("Tracking is already started");_interval=setInterval(function(){setLocalStorageData(getLocalStorageData()+_accuracy);
},_accuracy)}function _stop(){clearInterval(_interval),_interval=null}function _reset(){_stop(),clearLocalStorage()}function _init(){_accuracy=options&&options.accuracy||1e3}function setLocalStorageData(val){window.localStorage.setItem(_storageKey,val)}function getLocalStorageData(){var data=window.localStorage.getItem(_storageKey),result=JSON.parse(data)||0;return result}function clearLocalStorage(){window.localStorage.removeItem(_storageKey)}var _accuracy,_storageKey="sessionState_active_for",_interval=null,sessionState={reset:function(){_reset()},restart:function(){_reset(),_start()},getDuration:function(){return getLocalStorageData()}};return _init(),sessionState;
};return sessionStateFactory}),define("tpl!taoProctoring/templates/deliveryServer/authorizationSuccess",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="success-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'<span class="icon-result-ok"></span></span>';
})}),define("taoProctoring/controller/DeliveryServer/awaiting",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/listbox","ui/dialog/alert","core/polling","core/cachedStore","taoQtiTest/testRunner/resumingStrategy/keepAfterResume","tpl!taoProctoring/templates/deliveryServer/authorizationSuccess"],function(_,$,__,helpers,loadingBar,listBox,dialogAlert,polling,cachedStore,keepAfterResume,authSuccessTpl){"use strict";var refreshPolling=1e4,cssScope=".awaiting-authorization",awaitingAuthorizationCtlr={start:function(config){function authorized(){loadingBar.stop(),$container.removeClass("authorization-in-progress"),$content.html(authSuccessTpl({message:__("Authorized, you may proceed")
}))}function exit(){location.href=config.returnUrl}var $container=$(cssScope),isAuthorizedUrl=helpers._url("isAuthorized","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),runDeliveryUrl=helpers._url("runDeliveryExecution","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),boxes=[{id:"goToDelivery",label:config.deliveryLabel,url:runDeliveryUrl,content:__("Please wait, authorization in process ..."),text:__("Proceed")}],$content=(listBox({title:__(config.deliveryInit?"Start Test":"Resume Test"),textEmpty:"",textNumber:"",textLoading:"",renderTo:$container,list:boxes,width:12}),$container.find(".listbox .content"));
keepAfterResume().reset(),cachedStore("test-states-"+config.deliveryExecution,"states").then(function(states){return states.setItem("paused",!1)}),loadingBar.start(),polling({action:function(){var async=this.async();$.get(isAuthorizedUrl,function(result){var stop=!1;result.success?result.authorized&&(stop=!0,authorized()):(stop=!0,result.message?dialogAlert(result.message,exit):exit()),stop?async.reject():async.resolve()})},interval:refreshPolling,autoStart:!0})}};return awaitingAuthorizationCtlr}),define("taoClientDiagnostic/tools/diagnostic/status",["jquery","lodash","i18n"],function($,_,__){"use strict";function diagnosticStatusFactory(){return{thresholds:{
performances:performancesThresholds,bandwidth:bandwidthThresholds,summary:summaryThresholds},getThresholds:function(name){return this.thresholds[name]},getStatus:function(percentage,thresholds){var len,feedback,i,step,status;if(percentage=Math.max(0,Math.min(100,Math.round(parseInt(percentage,10)))),_.isString(thresholds)&&(thresholds=this.getThresholds(thresholds)),thresholds)for(_.isArray(thresholds)||(thresholds=[thresholds]),len=thresholds.length,feedback=thresholds[0],i=1;len>i&&(step=thresholds[i],step&&percentage>=step.threshold);i++)feedback=step;return status={percentage:percentage,quality:{}},feedback&&(status.feedback=_.clone(feedback)),status}}}var performancesThresholds=[{
threshold:0,message:__("Very slow performances"),type:"error"},{threshold:33,message:__("Average performances"),type:"warning"},{threshold:66,message:__("Good performances"),type:"success"}],bandwidthThresholds=[{threshold:0,message:__("Low bandwidth"),type:"error"},{threshold:33,message:__("Average bandwidth"),type:"warning"},{threshold:66,message:__("Good bandwidth"),type:"success"}],summaryThresholds=[{threshold:0,message:__("Your system requires a compatibility update, please contact your system administrator."),type:"error"},{threshold:33,message:__("Your system is not optimal, please contact your system administrator."),type:"warning"},{threshold:66,message:__("Your system is fully compliant."),
type:"success"}];return diagnosticStatusFactory}),define("taoClientDiagnostic/tools/fixedDecimals",[],function(){"use strict";var fixedDecimals=function(value,decimals){var shift=Math.pow(10,Math.abs(decimals||1));return Math.round(Number(value)*shift)/shift||0};return fixedDecimals}),define("taoClientDiagnostic/tools/stats",["lodash","taoClientDiagnostic/tools/fixedDecimals"],function(_,fixedDecimals){"use strict";var stats=function(list,fieldName,decimals){var variance,avg,med,middle,getValue,results,sum=0,sum2=0,min=Number.MAX_VALUE,max=0,count=0,values=[];return getValue=_.isFunction(fieldName)?fieldName:function(item){return item&&item[fieldName]||0},_.forEach(list,function(item){
var value;void 0!==item&&(value=getValue(item),values.push(value),min=Math.min(min,value),max=Math.max(max,value),sum+=value,count++)}),avg=sum/(count||1),_.forEach(values,function(value){var diff=value-avg;sum2+=diff*diff}),variance=count>1?Math.sqrt(sum2/(count-1)):0,values.sort(),middle=count/2,med=(values[Math.floor(middle)]+values[Math.ceil(middle)])/2,results={min:min,max:max,sum:sum,count:count,average:avg,median:med,variance:variance},decimals&&_.forEach(results,function(value,key){results[key]=fixedDecimals(value,decimals)}),results.values=list,results};return stats}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",
assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",
gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",
gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",
mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",
customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction",infoControl:"taoQtiItem/qtiItem/core/PortableInfoControl",include:"taoQtiItem/qtiItem/core/Include"}}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(_){"use strict";var util={buildSerial:function(prefix){for(var id=prefix||"",chars="abcdefghijklmnopqrstuvwxyz0123456789",i=0;22>i;i++)id+=chars.charAt(Math.floor(Math.random()*chars.length));return id},buildId:function(item,prefix){var id,usedIds,i=1,suffix="",exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIds();do exists=!1,id=prefix+suffix,_.contains(usedIds,id)&&(exists=!0,
suffix="_"+i,i++);while(exists);return id},buildIdentifier:function(item,prefix,useSuffix){var id,usedIds,suffix="",i=1,exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIdentifiers(),useSuffix=_.isUndefined(useSuffix)?!0:useSuffix,prefix?(prefix=prefix.replace(/_[0-9]+$/gi,"_").replace(/[^a-zA-Z0-9_]/gi,"_").replace(/(_)+/gi,"_"),useSuffix&&(suffix="_"+i)):(prefix=this.qtiClass,suffix="_"+i);do exists=!1,id=prefix+suffix,usedIds[id]&&(exists=!0,suffix="_"+i,i++);while(exists);return id},findInCollection:function(element,collectionNames,searchedSerial){var found=null;if(_.isString(collectionNames)&&(collectionNames=[collectionNames]),
!_.isArray(collectionNames))throw new Error("invalid argument : collectionNames must be an array or a string");return _.each(collectionNames,function(collectionName){var collection=element;_.each(collectionName.split("."),function(nameToken){collection=collection[nameToken]});var elt=collection[searchedSerial];return elt?(found={parent:element,element:elt},!1):(_.each(collection,function(elt){return _.isFunction(elt.find)&&(found=elt.find(searchedSerial))?!1:void 0}),found?!1:void 0)}),found},addMarkupNamespace:function(markup,ns){return ns?markup=markup.replace(/<(\/)?([a-z:]+)(\s?)([^><]*)>/g,function($0,$1,$2,$3,$4){return $2.indexOf(":")>0?$0:($1=$1||"",$3=$3||"",
"<"+$1+ns+":"+$2+$3+$4+">")}):markup},removeMarkupNamespaces:function(markup){return markup.replace(/<(\/)?(\w*):([^>]*)>/g,"<$1$3>")},getMarkupUsedNamespaces:function(markup){var namespaces=[];return markup.replace(/<(\/)?(\w*):([^>]*)>/g,function(original,slash,ns,node){return namespaces.push(ns),"<"+slash+node+">"}),_.uniq(namespaces)}};return util}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(_,$){var rendererConfigHelper={};return rendererConfigHelper.getOptionsFromArguments=function(args){var options={data:{},placeholder:null,subclass:"",renderer:null};return _.each(args,function(arg){arg&&(arg.isRenderer?options.renderer=arg:arg instanceof $&&arg.length?options.placeholder=arg:_.isString(arg)?options.subclass=arg:_.isPlainObject(arg)?options.data=arg:console.log("invalid arg",arg,args));
}),options},rendererConfigHelper}),define("taoQtiItem/qtiItem/core/Element",["jquery","lodash","class","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Class,util,rendererConfig){"use strict";var _instances={},Element=Class.extend({qtiClass:"",serial:"",relatedItem:null,init:function(serial,attributes){if(this.attributes={},this.metaData={},"object"==typeof serial&&(attributes=serial,serial=""),serial||(serial=util.buildSerial(this.qtiClass+"_")),serial&&("string"!=typeof serial||!serial.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof serial+") "+serial;if(_instances[serial])throw"a QTI Element with the same serial already exists "+serial;
_instances[serial]=this,this.serial=serial,this.setAttributes(attributes||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function(qtiClass){return qtiClass===this.qtiClass},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var usedIds={},elts=this.getComposingElements();for(var i in elts){var elt=elts[i],id=elt.attr("identifier");id&&(usedIds[id]=elt)}return usedIds},getUsedIds:function(){var usedIds=[];return _.forEach(this.getComposingElements(),function(elt){var id=elt.attr("id");id&&!_.contains(usedIds,id)&&usedIds.push(id);
}),usedIds},attr:function(name,value){if(name)if(void 0!==value)this.attributes[name]=value;else if("object"==typeof name)for(var prop in name)this.attr(prop,name[prop]);else if("string"==typeof name)return void 0===this.attributes[name]?void 0:this.attributes[name];return this},data:function(name,value){if(name)if(void 0!==value)this.metaData[name]=value,$(document).trigger("metaChange.qti-widget",{element:this,key:name,value:value});else if("object"==typeof name)for(var prop in name)this.data(prop,name[prop]);else if("string"==typeof name)return void 0===this.metaData[name]?void 0:this.metaData[name];return this},removeData:function(name){return delete this.metaData[name],
this},removeAttr:function(name){return this.removeAttributes(name)},setAttributes:function(attributes){return this.attributes=attributes,this},getAttributes:function(){return _.clone(this.attributes)},removeAttributes:function(attrNames){"string"==typeof attrNames&&(attrNames=[attrNames]);for(var i in attrNames)delete this.attributes[attrNames[i]];return this},getComposingElements:function(){function append(element){elts[element.getSerial()]=element,elts=_.extend(elts,element.getComposingElements())}var elts={};return"function"==typeof this.initContainer&&append(this.getBody()),"function"==typeof this.initObject&&append(this.getObject()),_.each(this.metaData,function(v){
Element.isA(v,"_container")?append(v):_.isArray(v)&&_.each(v,function(v){Element.isA(v,"_container")&&append(v)})}),elts},getUsedClasses:function(){var ret=[this.qtiClass],composingElts=this.getComposingElements();return _.each(composingElts,function(elt){ret.push(elt.qtiClass)}),_.uniq(ret)},find:function(serial){var found=null;if("function"==typeof this.initObject){var object=this.getObject();object.serial===serial&&(found={parent:this,element:object,location:"object"})}return found||"function"!=typeof this.initContainer||(found=this.getBody().find(serial,this)),found},parent:function(){var item=this.getRelatedItem();if(item){var found=item.find(this.getSerial());
if(found)return found.parent}return null},setRelatedItem:function(item,recursive){if(recursive="undefined"==typeof recursive?!0:recursive,Element.isA(item,"assessmentItem")){this.relatedItem=item;var composingElts=this.getComposingElements();for(var i in composingElts)composingElts[i].setRelatedItem(item,!1)}},getRelatedItem:function(){var ret=null;return Element.isA(this.relatedItem,"assessmentItem")&&(ret=this.relatedItem),ret},setRenderer:function(renderer){if(!renderer||!renderer.isRenderer)throw"invalid qti rendering engine";this.renderer=renderer;var elts=this.getComposingElements();for(var serial in elts)elts[serial].setRenderer(renderer)},getRenderer:function(){
return this.renderer},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),_renderer=args.renderer||this.getRenderer(),tplData={},defaultData={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!_renderer)throw"render: no renderer found for the element "+this.qtiClass+":"+this.serial;"function"==typeof this.initContainer&&(defaultData.body=this.getBody().render(args.renderer)),"function"==typeof this.initObject&&(defaultData.object={attributes:this.object.getAttributes()},defaultData.object.attributes.data=_renderer.resolveUrl(this.object.attr("data"))),tplData=_.merge(defaultData,args.data||{}),tplData=_renderer.getData(this,tplData,args.subclass);
var rendering=_renderer.renderTpl(this,tplData,args.subclass);return args.placeholder&&args.placeholder.replaceWith(rendering),rendering},postRender:function(data,altClassName,renderer){var postRenderers=[],_renderer=renderer||this.getRenderer();if("function"==typeof this.initContainer&&(postRenderers=this.getBody().postRender({},"",renderer)),!_renderer)throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial;return postRenderers.push(_renderer.postRender(this,data,altClassName)),_.compact(postRenderers)},getContainer:function($scope,subclass){var renderer=this.getRenderer();if(renderer)return renderer.getContainer(this,$scope,subclass);
throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var arr={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(arr.body=this.getBody().toArray()),"function"==typeof this.initObject&&(arr.object=this.object.toArray()),arr},isEmpty:function(){return!1},addClass:function(className){var clazz=this.attr("class")||"";_containClass(clazz,className)||this.attr("class",clazz+(clazz.length?" ":"")+className)},hasClass:function(className){return _containClass(this.attr("class"),className)},removeClass:function(className){var clazz=this.attr("class")||"";
if(clazz){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)");clazz=clazz.replace(regex," ").trim(),clazz?this.attr("class",clazz):this.removeAttr("class")}},toggleClass:function(className,state){return"boolean"==typeof state?state?this.addClass(className):this.removeClass(className):this.hasClass(className)?this.removeClass(className):this.addClass(className)},isset:function(){return Element.issetElement(this.serial)},unset:function(){return Element.unsetElement(this.serial)}}),_containClass=function(allClassStr,className){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)","");return allClassStr&&regex.test(allClassStr)};return Element.isA=function(qtiElement,qtiClass){
return qtiElement instanceof Element&&qtiElement.is(qtiClass)},Element.getElementBySerial=function(serial){return _instances[serial]},Element.issetElement=function(serial){return!!_instances[serial]},Element.unsetElement=function(serial){var element=Element.getElementBySerial(serial);if(element){var composingElements=element.getComposingElements();return _.each(composingElements,function(elt){delete _instances[elt.serial]}),delete _instances[element.serial],!0}return!1},Element}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element"],function(_,Class,qtiClasses,Element){function loadPortableCustomElementData(portableElement,data){
portableElement.typeIdentifier=data.typeIdentifier,portableElement.markup=data.markup,portableElement.entryPoint=data.entryPoint,portableElement.properties=data.properties,portableElement.libraries=data.libraries}var Loader=Class.extend({init:function(item,classesLocation){this.qti={},this.classesLocation={},this.item=item||null,this.setClassesLocation(classesLocation||qtiClasses)},setClassesLocation:function(qtiClasses){return _.extend(this.classesLocation,qtiClasses),this},getRequiredClasses:function(data){var ret=[];for(var i in data)"qtiClass"===i&&"_container"!==data[i]&&"relatedItem"!==i?ret.push(data[i]):"object"==typeof data[i]&&"responseRules"!==i&&(ret=_.union(ret,this.getRequiredClasses(data[i])));
return ret},loadRequiredClasses:function(data,callback,reload){var requiredClasses=this.getRequiredClasses(data,reload),required=[];for(var i in requiredClasses){var requiredClass=requiredClasses[i];if(!this.classesLocation[requiredClass])throw new Error("missing qti class location declaration : "+requiredClass);required.push(this.classesLocation[requiredClass])}var _this=this;require(required,function(){_.each(arguments,function(QtiClass){_this.qti[QtiClass.prototype.qtiClass]=QtiClass}),callback.call(_this,_this.qti)})},getLoadedClasses:function(){return _.keys(this.qti)},loadItemData:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){
var i;if("object"==typeof data&&"assessmentItem"===data.qtiClass){data.serial&&Element.unsetElement(data.serial),_this.item=new Qti.assessmentItem(data.serial,data.attributes||{}),_this.loadContainer(_this.item.getBody(),data.body);for(i in data.outcomes){var outcome=_this.buildOutcome(data.outcomes[i]);outcome&&_this.item.addOutcomeDeclaration(outcome)}for(i in data.feedbacks){var feedback=_this.buildElement(data.feedbacks[i]);feedback&&_this.item.addModalFeedback(feedback)}for(i in data.stylesheets){var stylesheet=_this.buildElement(data.stylesheets[i]);stylesheet&&_this.item.addStylesheet(stylesheet)}for(i in data.responses){var response=_this.buildResponse(data.responses[i]);
if(response){_this.item.addResponseDeclaration(response);var feedbackRules=data.responses[i].feedbackRules;feedbackRules&&_.forIn(feedbackRules,function(fbData,serial){response.feedbackRules[serial]=_this.buildSimpleFeedbackRule(fbData,response)})}}data.responseProcessing&&_this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing)),_this.item.setNamespaces(data.namespaces),_this.item.setSchemaLocations(data.schemaLocations),_this.item.setApipAccessibility(data.apipAccessibility)}"function"==typeof callback&&callback.call(_this,_this.item)})},loadAndBuildElement:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){
var element=_this.buildElement(data);"function"==typeof callback&&callback.call(_this,element)})},loadElement:function(element,data,callback){var _this=this;this.loadRequiredClasses(data,function(){_this.loadElementData(element,data),"function"==typeof callback&&callback.call(_this,element)})},loadElements:function(data,callback){var _this=this;if(!_this.item)throw"QtiLoader : cannot load elements in empty item";this.loadRequiredClasses(data,function(){var allElements=_this.item.getComposingElements();for(var i in data){var elementData=data[i];elementData&&elementData.qtiClass&&elementData.serial&&allElements[elementData.serial]&&_this.loadElementData(allElements[elementData.serial],elementData);
}"function"==typeof callback&&callback.call(_this,_this.item)})},buildResponse:function(data){var response=this.buildElement(data);return response.template=data.howMatch||null,response.defaultValue=data.defaultValue||null,response.correctResponse=data.correctResponses||null,_.size(data.mapping)?response.mapEntries=data.mapping:_.size(data.areaMapping)?response.mapEntries=data.areaMapping:response.mapEntries={},response.mappingAttributes=data.mappingAttributes||{},response},buildSimpleFeedbackRule:function(data,response){var feedbackRule=this.buildElement(data);feedbackRule.setCondition(response,data.condition,data.comparedValue||null),feedbackRule.feedbackOutcome=this.item.outcomes[data.feedbackOutcome]||null,
feedbackRule.feedbackThen=this.item.modalFeedbacks[data.feedbackThen]||null,feedbackRule.feedbackElse=this.item.modalFeedbacks[data.feedbackElse]||null;var response=feedbackRule.comparedOutcome;return feedbackRule.feedbackThen&&feedbackRule.feedbackThen.data("relatedResponse",response),feedbackRule.feedbackElse&&feedbackRule.feedbackElse.data("relatedResponse",response),feedbackRule},buildOutcome:function(data){var outcome=this.buildElement(data);return outcome.defaultValue=data.defaultValue||null,outcome},buildResponseProcessing:function(data){var rp=this.buildElement(data);return data&&data.processingType&&("custom"===data.processingType?(rp.xml=data.data,rp.processingType="custom"):rp.processingType="templateDriven"),
rp},loadContainer:function(bodyObject,bodyData){if(!Element.isA(bodyObject,"_container"))throw"bodyObject must be a QTI Container";if(!bodyData||"string"!=typeof bodyData.body||"array"!=typeof bodyData.elements&&"object"!=typeof bodyData.elements)throw"wrong bodydata format";for(var serial in bodyData.elements){var eltData=bodyData.elements[serial],element=this.buildElement(eltData);element&&bodyObject.setElement(element,bodyData.body)}bodyObject.body(bodyData.body)},buildElement:function(elementData){var elt=null;if(!(elementData&&elementData.qtiClass&&elementData.serial))throw"wrong elementData format";var className=elementData.qtiClass;if(!this.qti[className])throw"the qti element class does not exist: "+className;
return elt=new this.qti[className](elementData.serial),this.loadElementData(elt,elementData),elt},loadElementData:function(element,data){var attributes=_.defaults(data.attributes||{},element.attributes||{});return element.setAttributes(attributes),element.body&&data.body&&element.bdy&&this.loadContainer(element.getBody(),data.body),element.object&&data.object&&element.object&&this.loadObjectData(element.object,data.object),Element.isA(element,"interaction")?this.loadInteractionData(element,data):Element.isA(element,"choice")?this.loadChoiceData(element,data):Element.isA(element,"math")?this.loadMathData(element,data):Element.isA(element,"infoControl")&&this.loadPicData(element,data),
element},loadInteractionData:function(interaction,data){Element.isA(interaction,"blockInteraction")&&data.prompt&&this.loadContainer(interaction.prompt.getBody(),data.prompt),this.buildInteractionChoices(interaction,data),Element.isA(interaction,"customInteraction")&&this.loadPciData(interaction,data)},buildInteractionChoices:function(interaction,data){if(data.choices){if(Element.isA(interaction,"matchInteraction"))for(var set=0;2>set;set++){if(!data.choices[set])throw"missing match set #"+set;var matchSet=data.choices[set];for(var serial in matchSet){var choice=this.buildElement(matchSet[serial]);choice&&interaction.addChoice(choice,set)}}else for(var serial in data.choices){
var choice=this.buildElement(data.choices[serial]);choice&&interaction.addChoice(choice)}if(Element.isA(interaction,"graphicGapMatchInteraction")&&data.gapImgs)for(var serial in data.gapImgs){var gapImg=this.buildElement(data.gapImgs[serial]);gapImg&&interaction.addGapImg(gapImg)}}},loadChoiceData:function(choice,data){Element.isA(choice,"textVariableChoice")?choice.val(data.text):Element.isA(choice,"gapImg")||Element.isA(choice,"containerChoice")},loadObjectData:function(object,data){object.setAttributes(data.attributes),data._alt&&("object"===data._alt.qtiClass?object._alt=Loader.buildElement(data._alt):object._alt=data._alt)},loadMathData:function(math,data){
math.ns=data.ns||{},math.setMathML(data.mathML||""),_.forIn(data.annotations||{},function(value,encoding){math.setAnnotation(encoding,value)})},loadPciData:function(pci,data){loadPortableCustomElementData(pci,data)},loadPicData:function(pic,data){loadPortableCustomElementData(pic,data)}});return Loader}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(_,Element){return{convertChoices:function(choices,outputType){var ret=[],_this=this;return _.each(choices,function(c){if(Element.isA(c,"choice"))switch(outputType){case"serial":ret.push(c.getSerial());break;case"identifier":ret.push(c.id());break;default:
ret.push(c)}else _.isArray(c)&&ret.push(_this.convertChoices(c,outputType))}),ret},findChoices:function(interaction,choices,inputType){var ret=[],_this=this;return _.each(choices,function(c){var choice;_.isString(c)?"serial"===inputType?(choice=interaction.getChoice(c),choice&&ret.push(choice)):"identifier"===inputType?(choice=interaction.getChoiceByIdentifier(c),choice&&ret.push(choice)):ret.push(c):_.isArray(c)?ret.push(_this.findChoices(interaction,c,inputType)):ret.push(c)}),ret},shuffleChoices:function(choices){var r=[],f={},j=0;for(var i in choices){if(!Element.isA(choices[i],"choice"))throw"invalid element in array: is not a qti choice";var choice=choices[i];
choice.attr("fixed")&&(f[j]=choice),r.push(choice),j++}for(var n=0;n<r.length-1;n++)if(!f[n]){var k=-1;do k=n+Math.floor(Math.random()*(r.length-n));while(f[k]);var tmp=r[k];r[k]=r[n],r[n]=tmp}return r},serialToIdentifier:function(interaction,choiceSerial){var choice=interaction.getChoice(choiceSerial);return choice?choice.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper","ui/themeLoader"],function(_,$,Handlebars,Promise,Element,interactionHelper,themeLoader){"use strict";function getDocumentBaseUrl(){return window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/([^\/]*)$/,"");
}var _isValidRenderer=function(renderer){var valid=!0;if("object"!=typeof renderer)return!1;var classCorrect=!1;if(renderer.qtiClass)if(_.indexOf(_renderableClasses,renderer.qtiClass)>=0)classCorrect=!0;else{var pos=renderer.qtiClass.indexOf(".");if(pos>0){var qtiClass=renderer.qtiClass.slice(0,pos),subClass=renderer.qtiClass.slice(pos+1);_renderableSubclasses[qtiClass]&&_.indexOf(_renderableSubclasses[qtiClass],subClass)>=0&&(classCorrect=!0)}}if(!classCorrect)throw valid=!1,new Error("invalid qti class name in renderer declaration : "+renderer.qtiClass);if(!renderer.template)throw valid=!1,new Error("missing template in renderer declaration : "+renderer.qtiClass);
return valid},_renderableClasses=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","img","math","object","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","infoControl","include"],_dependencies={
assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:["_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},_renderableSubclasses={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]
},_defaults={shuffleChoices:!0},Renderer=function(options){var _locations={},_renderers={};options=_.defaults(options||{},_defaults),this.isRenderer=!0,this.name="",this.shuffledChoices=[];var _getClassRenderer=function(qtiClass){var ret=null;if(_renderers[qtiClass])ret=_renderers[qtiClass];else{var pos=qtiClass.indexOf(".");pos>0&&(qtiClass=qtiClass.slice(0,pos),_renderers[qtiClass]&&(ret=_renderers[qtiClass]))}return ret};this.setOption=function(key,value){return"string"==typeof key&&(options[key]=value),this},this.setOptions=function(opts){return options=_.extend(options,opts),this},this.getOption=function(key){return"string"==typeof key&&options[key]?options[key]:null;
},this.getAssetManager=function(){return options.assetManager},this.getThemeLoader=function(){return this.themeLoader},this.renderTpl=function(element,data,qtiSubclass){var res,ret="",qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass),decorators=this.getOption("decorators");if(!renderer||!_.isFunction(renderer.template))throw new Error("no renderer template loaded under the class name : "+qtiClass);return _.isObject(decorators)&&_.isFunction(decorators.before)&&(res=decorators.before(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret+=renderer.template(data),_.isObject(decorators)&&_.isFunction(decorators.after)&&(res=decorators.after(element,qtiSubclass),
_.isString(res)&&(ret+=res)),ret},this.getData=function(element,data,qtiSubclass){var ret=data,qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.getData&&(ret=renderer.getData.call(this,element,data)),ret},this.renderDirect=function(tpl,data){return Handlebars.compile(tpl)(data)},this.getContainer=function(qtiElement,$scope,qtiSubclass){var ret=null,qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer found for the class : "+qtiElement.qtiClass;return ret=renderer.getContainer(qtiElement,$scope)},this.postRender=function(qtiElement,data,qtiSubclass){
var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.render?renderer.render.call(this,qtiElement,data):void 0},this.setResponse=function(qtiInteraction,response,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;if("function"==typeof renderer.setResponse){ret=renderer.setResponse.call(this,qtiInteraction,response);var $container=renderer.getContainer.call(this,qtiInteraction);$container instanceof $&&$container.length&&$container.trigger("responseSet",[qtiInteraction,response]);
}return ret},this.getResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.getResponse&&(ret=renderer.getResponse.call(this,qtiInteraction)),ret},this.resetResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.resetResponse&&(ret=renderer.resetResponse.call(this,qtiInteraction)),ret},this.getState=function(qtiInteraction,qtiSubclass){
var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return ret=_.isFunction(renderer.getState)?renderer.getState.call(this,qtiInteraction):renderer.getResponse.call(this,qtiInteraction)},this.setState=function(qtiInteraction,state,qtiSubclass){var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;_.isFunction(renderer.setState)?renderer.setState.call(this,qtiInteraction,state):(renderer.resetResponse.call(this,qtiInteraction),renderer.setResponse.call(this,qtiInteraction,state));
},this.destroy=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return _.isFunction(renderer.destroy)&&(ret=renderer.destroy.call(this,qtiInteraction)),ret},this.getLoadedRenderers=function(){return _renderers},this.register=function(renderersLocations){_.extend(_locations,renderersLocations)},this.load=function(callback,requiredClasses){var self=this,required=[];if(options.themes&&(options.themes.base=this.resolveUrl(options.themes.base),_.forEach(options.themes.available,function(theme,index){options.themes.available[index].path=self.resolveUrl(theme.path);
}),this.themeLoader=themeLoader(options.themes).load()),requiredClasses){if(!_.isArray(requiredClasses))throw new Error('invalid argument type: expected array for arg "requireClasses"');requiredClasses=_.intersection(requiredClasses,_renderableClasses),_.each(requiredClasses,function(reqClass){var deps=_dependencies[reqClass];deps&&(requiredClasses=_.union(requiredClasses,deps))}),_.forEach(requiredClasses,function(qtiClass){if(_renderableSubclasses[qtiClass]){var requiredSubClasses=_.intersection(requiredClasses,_renderableSubclasses[qtiClass]);_.each(requiredSubClasses,function(subclass){if(_locations[qtiClass+"."+subclass])required.push(_locations[qtiClass+"."+subclass]);else{
if(!_locations[qtiClass])throw new Error(self.name+" : missing qti class location declaration: "+qtiClass+", subclass: "+subclass);required.push(_locations[qtiClass])}})}else if(_locations[qtiClass]===!1)_renderers[qtiClass]=!1;else{if(!_locations[qtiClass])throw new Error(self.name+" : missing qti class location declaration: "+qtiClass);required.push(_locations[qtiClass])}})}else required=_.values(_locations);var _this=this;return require(required,function(){_.each(arguments,function(clazz){_isValidRenderer(clazz)&&(_renderers[clazz.qtiClass]=clazz)}),"function"==typeof callback&&callback.call(_this,_renderers)}),this},this.unload=function(){return this.themeLoader&&themeLoader(options.themes).unload(),
this},this.setShuffledChoices=function(interaction,choices,identificationType){Element.isA(interaction,"interaction")&&(this.shuffledChoices[interaction.getSerial()]=_.pluck(interactionHelper.findChoices(interaction,choices,identificationType),"serial"))},this.getShuffledChoices=function(interaction,reshuffle,returnedType){var serial,i,choices=[];if(Element.isA(interaction,"interaction")){if(serial=interaction.getSerial(),!this.shuffledChoices[serial]||reshuffle)if(Element.isA(interaction,"matchInteraction"))for(this.shuffledChoices[serial]=[],i=0;2>i;i++)choices[i]=interactionHelper.shuffleChoices(interaction.getChoices(i)),this.shuffledChoices[serial][i]=_.pluck(choices[i],"serial");else choices=interactionHelper.shuffleChoices(interaction.getChoices()),
this.shuffledChoices[serial]=_.pluck(choices,"serial");else Element.isA(interaction,"matchInteraction")?_.forEach(choices,function(choice,index){2>index&&_.forEach(this.shuffledChoices[serial][i],function(choiceSerial){choice.push(interaction.getChoice(choiceSerial))})}):_.forEach(this.shuffledChoices[serial],function(choiceSerial){choices.push(interaction.getChoice(choiceSerial))});return"serial"===returnedType||"identifier"===returnedType?interactionHelper.convertChoices(choices,returnedType):_.clone(choices)}return[]},this.getRenderers=function(){return _renderers},this.getLocations=function(){return _locations},this.resolveUrl=function(url){return options.assetManager?"string"==typeof url&&url.length>0?options.assetManager.resolve(url):void 0:url;
},this.getAbsoluteUrl=function(relUrl){if(console.warn("DEPRECATED used getAbsoluteUrl with ",arguments),this.getOption("userRelativeUrl"))return relUrl.replace(/^\.?\//,"");if(/^http(s)?:\/\//i.test(relUrl)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(relUrl))return relUrl;var absUrl="",runtimeLocations=this.getOption("runtimeLocations");if(runtimeLocations&&_.size(runtimeLocations)&&_.forIn(runtimeLocations,function(runtimeLocation,typeIdentifier){return 0===relUrl.indexOf(typeIdentifier)?(absUrl=relUrl.replace(typeIdentifier,runtimeLocation),!1):void 0}),absUrl)return absUrl;var baseUrl=this.getOption("baseUrl")||getDocumentBaseUrl();return baseUrl+relUrl;
}};return{build:function(renderersLocations,name,defaultOptions){var NewRenderer=function(){var options=_.isPlainObject(arguments[0])?arguments[0]:{};Renderer.apply(this),this.register(renderersLocations),this.name=name||"",this.setOptions(_.defaults(options,defaultOptions||{}))};return NewRenderer.prototype=Renderer.prototype,NewRenderer}}}),define("taoItems/assets/manager",["lodash","util/url"],function(_,urlUtil){"use strict";var assetManagerFactory=function(strategies,data,options){var cache={};strategies=_.isArray(strategies)?strategies:[strategies],data=data||{},options=_.defaults(options||{},{parseUrl:!0});var assetManager={_strategies:[],addStrategy:function(strategy){
if(!_.isPlainObject(strategy)||!_.isFunction(strategy.handle)||!_.isString(strategy.name))throw new TypeError("An asset resolution strategy is an object with a handle method and a name");this._strategies.push(strategy)},setStrategies:function(newStrategies){var self=this;this._strategies=[],_.forEach(newStrategies,function(strategy){_.isPlainObject(strategy)?assetManager.addStrategy(strategy):_.isFunction(strategy)&&self.addStrategy({name:"strategy_"+(self._strategies.length+1),handle:strategy})})},setData:function(key,value){_.isString(key)&&"undefined"!=typeof value?data[key]=value:_.isPlainObject(key)&&(data=key)},getData:function(key){return _.isString(key)?data[key]:data;
},resolve:function(url){var resolved,inputUrl;return options.cache&&cache.hasOwnProperty(url)?cache[url]:(inputUrl=options.parseUrl?urlUtil.parse(url):url,_.forEach(this._strategies,function(strategy){var result=strategy.handle(inputUrl,data);return result?(resolved=result,!1):void 0}),resolved=resolved||"",options.cache&&(cache[url]=resolved),resolved)},resolveBy:function(name,url){var inputUrl,resolved="",strategy=_.find(this._strategies,{name:name});return strategy&&(inputUrl=options.parseUrl?urlUtil.parse(url):url,resolved=strategy.handle(inputUrl,data)),resolved},clearCache:function(){options.cache&&(cache={})}};return assetManager.setStrategies(strategies),
assetManager};return assetManagerFactory}),define("taoItems/assets/strategies",["util/url"],function(urlUtil){"use strict";var strategies={baseUrl:{name:"baseUrl",handle:function(url,data){return"string"==typeof data.baseUrl&&urlUtil.isRelative(url)?data.slashcat===!0?data.baseUrl.replace(/\/$/,"")+"/"+url.directory.replace(/^\.\//,"").replace(/^\//,"")+encodeURIComponent(url.file.replace(/^\.\//,"").replace(/^\//,"")):data.baseUrl+url.directory.replace(/^\.?\//,"")+encodeURIComponent(url.file.replace(/^\.?\//,"")):void 0}},external:{name:"external",handle:function(url,data){return urlUtil.isAbsolute(url)?url.toString():void 0}},base64:{name:"base64",handle:function(url){
return urlUtil.isBase64(url)?url.toString():void 0}},taomedia:{name:"taomedia",handle:function(url,data){var baseUrl=data.baseUrl||"./";return"object"==typeof url&&"taomedia"===url.protocol||/^taomedia:\/\//.test(url.toString())?baseUrl+url.toString():void 0}}};return strategies}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","context","ui/themes","taoItems/assets/manager","taoItems/assets/strategies","module"],function(_,context,themes,assetManagerFactory,assetStrategies,module){"use strict";var itemThemes=themes.get("items"),portableAssetStrategy={name:"portableElementLocation",handle:function(url){return url.source===url.relative?window.location.pathname.replace(/([^\/]*)$/,"")+url.toString()+"/":void 0;
}},assetManager=assetManagerFactory([{name:"theme",handle:function(url){return itemThemes&&url.path&&(url.path===itemThemes.base||_.contains(_.pluck(itemThemes.available,"path"),url.path))?context.root_url+url.toString():void 0}},assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl,portableAssetStrategy],{baseUrl:""}),locations={assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:!1,responseDeclaration:!1,responseProcessing:!1,img:"taoQtiItem/qtiCommonRenderer/renderers/Img",
math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",
matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",
gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",hotspotChoice:!1,gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",
selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",associableHotspot:!1,
customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",infoControl:"taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiCommonRenderer/renderers/Include",endAttemptInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction"};return{name:"commonRenderer",locations:locations,options:{assetManager:assetManager,themes:itemThemes,enableDragAndDrop:{associate:!!module.config().associateDragAndDrop,gapMatch:!!module.config().gapMatchDragAndDrop,graphicGapMatch:!!module.config().graphicGapMatchDragAndDrop,order:!!module.config().orderDragAndDrop}}}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config"],function(Renderer,config){
"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoClientDiagnostic/tools/performances/tester",["jquery","lodash","async","context","helpers","taoClientDiagnostic/tools/stats","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCommonRenderer/renderers/Renderer","lib/polyfill/performance-now"],function($,_,async,context,helpers,stats,Loader,Renderer){"use strict";function loadItem(data,done){var qtiJsonFile=data.url+"qti.json",urlTokens=data.url.split("/"),extension=urlTokens[0],fullpath=require.s.contexts._.config.paths[extension],baseUrl=data.url.replace(extension,fullpath),loader=new Loader,renderer=new Renderer({baseUrl:baseUrl
});renderer.getAssetManager&&renderer.getAssetManager().setData("baseUrl",baseUrl),require(["json!"+qtiJsonFile],function(itemData){loader.loadItemData(itemData,function(item){renderer.load(function(){var $container,duration,start,end,result;start=window.performance.now(),item.setRenderer(this),$container=$("<div>").appendTo("body"),$container.append(item.render()),item.postRender(),$container.remove(),end=window.performance.now(),duration=(end-start)/_second,result={id:data.id,url:data.url,duration:duration},done(null,result)},this.getLoadedClasses())})})}var _second=1e3,_defaultTimeout=30*_second,_defaultOccurrencesCount=10,_defaultSamples=["taoClientDiagnostic/tools/performances/data/sample1/","taoClientDiagnostic/tools/performances/data/sample2/","taoClientDiagnostic/tools/performances/data/sample3/"],_sampleBaseId="sample",performancesTester=function(samples,occurrences,timeout){
var idx=0,_samples=_.map(!_.isEmpty(samples)&&samples||_defaultSamples,function(sample){return idx++,{id:_sampleBaseId+idx,url:sample,timeout:timeout||_defaultTimeout,nb:occurrences||_defaultOccurrencesCount}});return _samples[0].nb++,{start:function(done){var tests=[];_.forEach(_samples,function(data){for(var cb=_.partial(loadItem,data),iterations=data.nb||1;iterations--;)tests.push(cb)}),async.series(tests,function(err,measures){var results,decimals=2;if(err&&!measures.length)throw err;measures.shift(),results=stats(measures,"duration",decimals),done(results.average,results)})}}};return performancesTester}),define("taoClientDiagnostic/tools/bandwidth/tester",["lodash","async","context","taoClientDiagnostic/tools/stats","taoClientDiagnostic/tools/fixedDecimals","lib/polyfill/performance-now"],function(_,async,context,stats,fixedDecimals){
"use strict";var _kilo=1024,_mega=_kilo*_kilo,_second=1e3,_downloadData={"10KB":{id:"10KB",file:"data/bin10KB.data",size:10*_kilo,timeout:_second,threshold:0,nb:10},"100KB":{id:"100KB",file:"data/bin100KB.data",size:100*_kilo,timeout:2*_second,threshold:0,nb:5},"1MB":{id:"1MB",file:"data/bin1MB.data",size:_mega,timeout:20*_second,threshold:0,nb:3},"10MB":{id:"10MB",file:"data/bin10MB.data",size:10*_mega,timeout:20*_second,threshold:8,nb:3}},download=function(data,cb){var start,end,timeoutId,url,request,self=this;return data.threshold&&this.bandwidth<data.threshold?cb("threshold"):(url=context.root_url+"/taoClientDiagnostic/views/js/tools/bandwidth/"+data.file+"?"+Date.now(),
request=new XMLHttpRequest,request.open("GET",url,!0),request.setRequestHeader("Accept","application/octet-stream"),request.onload=function(){var duration,bytes,seconds,speed;return end=window.performance.now(),clearTimeout(timeoutId),duration=end-start,bytes=data.size,seconds=duration/_second,speed=8*bytes/seconds/_mega,self.bandwidth=Math.max(self.bandwidth,speed),cb(null,{id:data.id,file:data.file,size:data.size,duration:duration,speed:speed})},request.onerror=function(err){clearTimeout(timeoutId),cb(err)},timeoutId=_.delay(cb,data.timeout,"timeout"),start=window.performance.now(),void request.send())},bandwidthTester=function(){return{start:function(done){
var self=this,tests=[];_.forEach(_downloadData,function(data){for(var cb=_.bind(download,self,data),iterations=data.nb||1;iterations--;)tests.push(cb)}),this.bandwidth=0,async.series(tests,function(err,measures){var getValue,results,duration=0,size=0,decimals=2;if(err&&!measures.length)throw err;getValue=function(value){var speed=0;return value&&(duration+=value.duration,size+=value.size,speed=value.speed,value.speed=fixedDecimals(speed,decimals)),speed},results=stats(measures,getValue,decimals),results.duration=fixedDecimals(duration/_second,decimals),results.size=size,done(results.average,results)})}}};return bandwidthTester}),define("taoClientDiagnostic/tools/getconfig",["lodash"],function(_){
"use strict";return function(config,defaults){return _(config||{}).omit(function(value){return null===value||void 0===value}).defaults(defaults||{}).value()}}),define("taoClientDiagnostic/tools/browser/tester",["i18n","helpers","taoClientDiagnostic/tools/getconfig"],function(__,helpers,getConfig){"use strict";function getTesterUrl(window,action,controller,extension){var document=window.document,navigator=window.navigator,screen=window.screen,params={},e=0,f=0;return params.ua=navigator.userAgent,e|=window.ActiveXObject?1:0,e|=window.opera?2:0,e|=window.chrome?4:0,e|="getBoxObjectFor"in document||"mozInnerScreenX"in window?8:0,e|="WebKitCSSMatrix"in window||"WebKitPoint"in window||"webkitStorageInfo"in window||"webkitURL"in window?16:0,
e|=16&e&&-1==={}.toString.toString().indexOf("\n")?32:0,params.e=e,f|="sandbox"in document.createElement("iframe")?1:0,f|="WebSocket"in window?2:0,f|=window.Worker?4:0,f|=window.applicationCache?8:0,f|=window.history&&window.history.pushState?16:0,f|=document.documentElement.webkitRequestFullScreen?32:0,f|="FileReader"in window?64:0,params.f=f,params.r=Math.random().toString(36).substring(7),params.w=screen.width,params.h=screen.height,helpers._url(action,controller,extension,params)}function browserTester(window,config){var initConfig=getConfig(config||{},_defaults);return{start:function(done){var url=getTesterUrl(window,initConfig.action,initConfig.controller,initConfig.extension);
require([url],function(){var info=new WhichBrowser,browser=info.browser,os=info.os;done({browser:browser&&browser.name||__("Unknown browser"),browserVersion:browser&&browser.version&&browser.version.original||__("Unknown version"),os:os&&os.name||__("Unknown OS"),osVersion:os&&os.version&&(os.version.alias||os.version.original)||__("Unknown version")})})}}}var _defaults={action:"whichBrowser",controller:"CompatibilityChecker",extension:"taoClientDiagnostic"};return browserTester}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/main",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,helper,buffer="";return buffer+="<p>",(helper=helpers.header)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.header,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</p>"}function program3(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",(helper=helpers.info)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.info,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</p>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="diagnostics-main-area">\n\n    <h1>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h1>\n\n    <div class="intro">\n        ',stack1=helpers["if"].call(depth0,depth0&&depth0.header,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.info,{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </div>\n\n    <div class="clearfix">\n        <button data-action="test-launcher" class="btn-info small rgt">',(helper=helpers.button)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.button,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</button>\n    </div>\n\n    <ul class="plain results"></ul>\n\n    <div class="status">\n        <h2></h2>\n    </div>\n\n</div>\n'})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/result",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <div class="small feedback feedback-',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <span class="icon icon-',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n            <span class="msg">',
(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.legend,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </div>\n        "}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="legend">',(helper=helpers.legend)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.legend,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>"}function program4(depth0,data){var stack1,buffer="";return buffer+='\n        <div class="quality-bar">\n            <div class="quality-indicator',stack1=helpers["if"].call(depth0,depth0&&depth0.wide,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"',stack1=helpers["if"].call(depth0,depth0&&depth0.label,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></div>\n        </div>\n        "}function program5(depth0,data){return" wide"}function program7(depth0,data){
var stack1,helper,buffer="";return buffer+=' title="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}function program9(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n    <div class="clearfix">\n        <button data-action="show-details" class="rgt btn-info small">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Show Details",options):helperMissing.call(depth0,"__","Show Details",options)))+'</button>\n        <button data-action="hide-details" class="rgt btn-info small hidden">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Hide Details",options):helperMissing.call(depth0,"__","Hide Details",options)))+'</button>\n        <div class="details hidden">\n            <h2>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Details",options):helperMissing.call(depth0,"__","Details",options)))+'</h2>\n            <div>\n                <table class="matrix">\n                    <tbody>\n                    ',stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n    ";
}function program10(depth0,data){var stack1,helper,buffer="";return buffer+="\n                        <tr><td>",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</td><td>",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</td></tr>\n                    "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<li data-result="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <h2>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h2>\n    <div>\n        ",stack1=helpers["with"].call(depth0,depth0&&depth0.feedback,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        ",stack1=helpers["with"].call(depth0,depth0&&depth0.quality,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    ",stack1=helpers["with"].call(depth0,depth0&&depth0.details,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</li>\n"})}),define("css!taoClientDiagnosticCss/diagnostics",[],function(){}),define("taoClientDiagnostic/tools/diagnostic/diagnostic",["jquery","lodash","i18n","async","helpers","ui/feedback","ui/component","taoClientDiagnostic/tools/diagnostic/status","taoClientDiagnostic/tools/performances/tester","taoClientDiagnostic/tools/bandwidth/tester","taoClientDiagnostic/tools/browser/tester","taoClientDiagnostic/tools/getconfig","tpl!taoClientDiagnostic/tools/diagnostic/tpl/main","tpl!taoClientDiagnostic/tools/diagnostic/tpl/result","css!taoClientDiagnosticCss/diagnostics"],function($,_,__,async,helpers,feedback,component,statusFactory,performancesTester,bandwidthTester,browserTester,getConfig,mainTpl,resultTpl){
"use strict";function diagnosticFactory(config){return component(diagnostic,_defaults).setTemplate(mainTpl).on("destroy",function(){this.controls=null,this.status=null}).on("render",function(){var self=this;this.status=statusFactory(),this.controls={$start:this.$component.find('[data-action="test-launcher"]'),$status:this.$component.find(".status h2"),$results:this.$component.find(".results")},this.controls.$start.on("click",function(){self.run()}),this.controls.$results.on("click",'button[data-action="show-details"]',function(){var $btn=$(this).closest("button"),$result=$btn.closest("[data-result]"),$details=$result.find(".details");$details.removeClass("hidden"),
$btn.addClass("hidden"),$result.find('[data-action="hide-details"]').removeClass("hidden")}),this.controls.$results.on("click",'button[data-action="hide-details"]',function(){var $btn=$(this).closest("button"),$result=$btn.closest("[data-result]"),$details=$result.find(".details");$details.addClass("hidden"),$btn.addClass("hidden"),$result.find('[data-action="show-details"]').removeClass("hidden")})}).init(config)}var _defaults={title:__("Diagnostic Tool"),header:__("This tool will run a number of tests in order to establish how well your current environment is suitable to run the TAO platform."),info:__("Be aware that these tests will take up to several minutes."),
button:__("Begin diagnostics"),actionStore:"storeData",actionCheck:"check",controller:"CompatibilityChecker",extension:"taoClientDiagnostic"},_defaultsBrowser={action:"whichBrowser",controller:"CompatibilityChecker",extension:"taoClientDiagnostic"},_defaultsBandwidth={unit:.16,ideal:45,max:100},_defaultsPerformances={optimal:.025,threshold:.25},diagnostic={changeStatus:function(status){return this.is("rendered")&&this.controls.$status.html(status),this},store:function(type,details,done){var config=this.config;details=_.omit(details,"values"),details.type=type,$.post(helpers._url(config.actionStore,config.controller,config.extension,config.storeParams),details,done,"json");
},checkBrowser:function(done){var self=this,config=this.config;this.changeStatus(__("Checking the browser...")),browserTester(window,getConfig(this.config.browser,_defaultsBrowser)).start(function(information){$.post(helpers._url(config.actionCheck,config.controller,config.extension,config.storeParams),information,function(data){var percentage="success"===data.type?100:0,status=self.status.getStatus(percentage,data),summary={browser:{message:__("Web browser"),value:information.browser+" "+information.browserVersion},os:{message:__("Operating system"),value:information.os+" "+information.osVersion}};status.id="browser",status.title=__("Operating system and web browser"),
self.addResult(status),done(status,summary)},"json")})},checkPerformances:function(done){var self=this,config=getConfig(this.config.performances,_defaultsPerformances),optimal=config.optimal,range=Math.abs(optimal-config.threshold);this.changeStatus(__("Checking the performances...")),performancesTester(config.samples,config.occurrences,1e3*config.timeout).start(function(average,details){var cursor=range-average+optimal,status=self.status.getStatus(cursor/range*100,"performances"),summary={performancesMin:{message:__("Minimum rendering time"),value:details.min+" s"},performancesMax:{message:__("Maximum rendering time"),value:details.max+" s"},performancesAverage:{
message:__("Average rendering time"),value:details.average+" s"}};self.store("performance",details,function(){status.id="performance",status.title=__("Workstation performances"),self.addResult(status),done(status,summary)})})},checkBandwidth:function(done){var self=this,config=getConfig(this.config.bandwidth,_defaultsBandwidth);this.changeStatus(__("Checking the bandwidth...")),bandwidthTester().start(function(average,details){var summary={bandwidthMin:{message:__("Minimum bandwidth"),value:details.min+" Mbps"},bandwidthMax:{message:__("Maximum bandwidth"),value:details.max+" Mbps"},bandwidthAverage:{message:__("Average bandwidth"),value:details.average+" Mbps"
}};self.store("bandwidth",details,function(){var status=[],bandwidthUnit=config.unit,testTakers=config.ideal,maxTestTakers=config.max;_.isArray(testTakers)||(testTakers=[testTakers]),_.forEach(testTakers,function(threshold,i){var max=threshold*bandwidthUnit,st=self.status.getStatus(details.max/max*100,"bandwidth"),nb=Math.floor(details.max/bandwidthUnit);nb>maxTestTakers&&(nb=">"+maxTestTakers),st.id="bandwidth-"+i,st.title=__("Bandwidth"),st.feedback.legend=__("Number of simultaneous test takers the connection can handle"),st.quality.label=nb,nb.toString().length>2&&(st.quality.wide=!0),status.push(st),self.addResult(st)}),done(status,summary)})})},addResult:function(result){
var $result,$indicator;return this.is("rendered")&&(result.quality&&result.quality.label&&result.quality.label.toString().length>2&&(result.quality.wide=!0),$result=$(resultTpl(result)),$indicator=$result.find(".quality-indicator"),this.controls.$results.append($result),$result.fadeIn(function(){$indicator.length&&$indicator.animate({left:result.percentage*$result.outerWidth()/100-$indicator.outerWidth()/2})})),this},prepare:function(){return this.trigger("start"),this.changeStatus(__("Starting...")),this.setState("running",!0),this.setState("done",!1),this.controls.$results.empty(),this.controls.$start.addClass("hidden"),this},finish:function(){return this.controls.$start.removeClass("hidden"),
this.trigger("end"),this.changeStatus(__("Done!")),this.setState("running",!1),this.setState("done",!0),this},run:function(){function doCheck(method,cb){self.trigger("starttester",method),self.setState(method,!0),self[method](function(status,details){_.assign(information,details),_.isArray(status)||(status=[status]),_.forEach(status,function(st){scores[st.id]=st}),self.trigger("endtester",method,status),self.setState(method,!1),cb()})}var self=this,information={},scores={};return this.is("rendered")&&(this.prepare(),async.series([function(cb){doCheck("checkBrowser",cb)},function(cb){doCheck("checkPerformances",cb)},function(cb){doCheck("checkBandwidth",cb)}],function(){
var total=_.min(scores,"percentage"),status=self.status.getStatus(total.percentage,"summary");status.title=__("Total"),status.id="total",status.details=information,self.addResult(status),self.finish()})),this}};return diagnosticFactory}),define("tpl!taoProctoring/templates/diagnostic/main",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",(helper=helpers.header)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.header,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</p>";
}function program3(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",(helper=helpers.info)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.info,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</p>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="diagnostics-main-area">\n\n    <h1>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h1>\n\n    <div class="intro">\n        ',stack1=helpers["if"].call(depth0,depth0&&depth0.header,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.info,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        <p>\n            <label for="workstation">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={
hash:{},data:data},helper?helper.call(depth0,"Workstation:",options):helperMissing.call(depth0,"__","Workstation:",options)))+'</label>\n            <input type="text" data-control="workstation" id="workstation" name="workstation" maxlength="64" placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Workstation name",options):helperMissing.call(depth0,"__","Workstation name",options)))+'" />\n        </p>\n    </div>\n\n    <div class="clearfix">\n        <button data-action="test-launcher" class="btn-info small rgt">',(helper=helpers.button)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.button,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</button>\n    </div>\n\n    <ul class="plain results"></ul>\n\n    <div class="status">\n        <h2></h2>\n    </div>\n\n</div>\n'})}),define("taoProctoring/controller/Diagnostic/diagnostic",["jquery","i18n","helpers","layout/loading-bar","ui/actionbar","ui/feedback","taoProctoring/component/breadcrumbs","taoClientDiagnostic/tools/diagnostic/diagnostic","tpl!taoProctoring/templates/diagnostic/main"],function($,__,helpers,loadingBar,actionbar,feedback,breadcrumbsFactory,diagnosticFactory,diagnosticTpl){"use strict";var cssScope=".diagnostic-runner";
loadingBar.start();var taoProctoringDiagnosticRunnerCtlr={start:function(){function installTester(workstation){diagnosticFactory(config).setTemplate(diagnosticTpl).on("render",function(){var self=this;this.controls.$workstation=this.getElement().find('[data-control="workstation"]').on("keypress",function(e){13===e.which&&(e.preventDefault(),self.run())}).val(workstation)}).on("start",function(){this.config.storeParams=this.config.storeParams||{},this.config.storeParams.workstation=this.controls.$workstation.val(),this.controls.$workstation.prop("disabled",!0),loadingBar.start()}).on("end",function(){this.controls.$workstation.removeProp("disabled"),loadingBar.stop();
}).on("render",function(){loadingBar.stop()}).render($list)}var $container=$(cssScope),$list=$container.find(".list"),$panel=$(".panel"),crumbs=$container.data("breadcrumbs"),config=$container.data("config"),testCenterId=$container.data("testcenter"),indexUrl=helpers._url("index","Diagnostic","taoProctoring",{testCenter:testCenterId}),workstationUrl=helpers._url("workstation","DiagnosticChecker","taoProctoring",{testCenter:testCenterId});breadcrumbsFactory($container,crumbs);actionbar({renderTo:$panel,buttons:[{id:"back",icon:"step-backward",title:__("Return to the list"),label:__("List of readiness checks"),action:function(){location.href=indexUrl}}]}),$.get(workstationUrl,"json").done(function(data){
installTester(data&&data.workstation)}).fail(function(){feedback().error(__("Unable to get the workstation name!")),installTester()})}};return taoProctoringDiagnosticRunnerCtlr}),define("taoProctoring/controller/Diagnostic/index",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","taoClientDiagnostic/tools/diagnostic/status","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory,statusFactory){"use strict";function formatNumber(number,digits){var nb=void 0===digits?2:Math.max(0,parseInt(digits,10)),factor=Math.pow(10,nb)||1;return Math.round(number*factor)/factor;
}var cssScope=".diagnostic-index";loadingBar.start();var taoProctoringDiagnosticCtlr={start:function(){function request(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{id:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}function remove(selection){request(removeUrl,selection,__("The readiness check result have been removed"))}var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),config=$container.data("config")||{},testCenterId=$container.data("testcenter"),diagnosticUrl=helpers._url("diagnostic","Diagnostic","taoProctoring",{
testCenter:testCenterId}),removeUrl=helpers._url("remove","Diagnostic","taoProctoring",{testCenter:testCenterId}),serviceUrl=helpers._url("diagnosticData","Diagnostic","taoProctoring",{testCenter:testCenterId}),performancesConfig=config.performances||{},performancesOptimal=performancesConfig.optimal,performancesRange=Math.abs(performancesOptimal-performancesConfig.threshold),diagnosticStatus=statusFactory(),tools=(breadcrumbsFactory($container,crumbs),[]),actions=[],model=[];tools.push({id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}}),tools.push({id:"launch",icon:"play",title:__("Launch another readiness check"),
label:__("Launch readiness check"),action:function(){location.href=diagnosticUrl}}),tools.push({id:"remove",icon:"remove",title:__("Remove the selected readiness check results"),label:__("Remove"),massAction:!0,action:function(selection){dialog({message:__("The selected readiness check results will be removed. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}),actions.push({id:"remove",icon:"remove",title:__("Remove the readiness check result?"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The readiness check result will be removed. Continue ?"),onOkBtn:function(){remove([id])}})}}),model.push({id:"workstation",
label:__("Workstation")}),model.push({id:"os",label:__("OS")}),model.push({id:"browser",label:__("Browser")}),model.push({id:"performance",label:__("Performances"),transform:function(value){var cursor=performancesRange-value+performancesOptimal,status=diagnosticStatus.getStatus(cursor/performancesRange*100,"performances");return status.feedback.message}}),model.push({id:"bandwidth",label:__("Bandwidth"),transform:function(value){var bandwidth=formatNumber(value);return value>100&&(bandwidth="> 100"),bandwidth+" Mbs"}}),model.push({id:"date",label:__("Date")}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){loadingBar.stop();
}).datatable({url:serviceUrl,status:{empty:__("No readiness checks have been done!"),available:__("Readiness checks already done"),loading:__("Loading")},tools:tools,actions:actions,selectable:!0,model:model},dataset)}};return taoProctoringDiagnosticCtlr}),define("tpl!taoProctoring/component/proctorForm/form",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function";return buffer+='<div class="proctor-form section-container">\n    <div class="content-block">\n        ',(helper=helpers.form)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.form,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n</div>"})}),define("taoProctoring/component/proctorForm",["lodash","jquery","i18n","helpers","users","ui/feedback","ui/component","tpl!taoProctoring/component/proctorForm/form"],function(_,$,__,helpers,users,feedback,component,formTpl){"use strict";function renderFormFromData($container,formData){$container.html(formTpl({form:formData.form})),users.checkLogin(formData.loginId,proctorLoginCheckUrl)}var _ns=".proctor-form",proctorFormUrl=helpers._url("createProctorForm","ProctorManager","taoProctoring"),proctorLoginCheckUrl=helpers._url("checkLogin","ProctorManager","taoProctoring");
return helpers.init(),function(config){return component().on("destroy",function(){this.getElement().off(_ns).empty()}).on("render",function(){var self=this,$element=this.getElement();$.get(proctorFormUrl,function(formData){renderFormFromData($element,formData),$element.on("submit"+_ns,"form",function(e){var $form=$(this),fields=$form.serializeArray(),list=self.config.testCenterList,data={testCenters:list&&list.getSelection()};_.each(fields,function(field){data[field.name]=field.value}),$.post(proctorFormUrl,data,function(res){res.created?(feedback().success(__("Proctor created")),self.destroy()):renderFormFromData($element,res)}),e.preventDefault()}).on("click","button.btn-diasble",function(){
self.destroy()})})}).init(config)}}),define("tpl!taoProctoring/templates/proctorManager/counters",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.count,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="',(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"><span class="text">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>: <span class="count">',(helper=helpers.count)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.count,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span></div>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;
return stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("tpl!taoProctoring/templates/proctorManager/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Authorized",options):helperMissing.call(depth0,"__","Authorized",options)))+' <span class="icon icon-authorize"></span>'}function program3(depth0,data){var stack1,helper,options,buffer="";
return buffer+='<span title="',(helper=helpers.testCenters)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.testCenters,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Partially authorized",options):helperMissing.call(depth0,"__","Partially authorized",options)))+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return stack1=helpers["if"].call(depth0,depth0&&depth0.authorized,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",stack1=helpers["if"].call(depth0,depth0&&depth0.partially,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoProctoring/controller/ProctorManager/index",["lodash","jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog/confirm","ui/bulkActionPopup","ui/datalist","taoProctoring/component/breadcrumbs","taoProctoring/component/proctorForm","tpl!taoProctoring/templates/proctorManager/counters","tpl!taoProctoring/templates/proctorManager/status","ui/datatable"],function(_,$,__,helpers,loadingBar,encode,feedback,dialogConfirm,bulkActionPopup,datalist,breadcrumbsFactory,proctorForm,counterTpl,statusTpl){
"use strict";var cssScope=".proctorManager-index",proctorsDataUrl=helpers._url("proctorAuthorizations","ProctorManager","taoProctoring"),authorizeUrl=helpers._url("authorize","ProctorManager","taoProctoring"),unauthorizeUrl=helpers._url("unauthorize","ProctorManager","taoProctoring"),_modes={EMPTY:0,LIST:1,FORM:2};loadingBar.start();var taoProctoringCtlr={start:function(){function request(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testCenters:list.getSelection(),proctors:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),
$containerList.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}function authorize(selection,message){dialogConfirm(message,function(){request(authorizeUrl,selection,__("Proctors authorized"))})}function revoke(selection,message){dialogConfirm(message,function(){request(unauthorizeUrl,selection,__("Proctors revoked"))})}function processMode(selection){if(selection.length)switch(pageMode){case _modes.EMPTY:pageMode=_modes.LIST;case _modes.LIST:$containerList.datatable("options",{params:{testCenters:null}}).datatable("options",{params:{testCenters:selection}}).datatable("refresh");break;
case _modes.FORM:}else _modes.LIST===pageMode?pageMode=_modes.EMPTY:_modes.EMPTY!==pageMode&&feedback().warning(__("You must select at least one test center!"));$noSelection.toggleClass("hidden",_modes.EMPTY!==pageMode),$containerList.toggleClass("hidden",_modes.LIST!==pageMode),$containerForm.toggleClass("hidden",_modes.FORM!==pageMode)}var $container=$(cssScope),$panelSelection=$(".test-center-panel"),$containerList=($(".proctor-panel"),$(".proctor-list")),$containerForm=$(".proctor-create"),$noSelection=$(".proctor-default"),testCenters=$container.data("list"),crumbs=$container.data("breadcrumbs"),pageMode=_modes.EMPTY,list=(breadcrumbsFactory($container,crumbs),
datalist({renderTo:$panelSelection,textNumber:__("Test sites"),labelText:__("Test site"),selectable:!0},testCenters));list.on("select",function(selection){processMode(selection)}),$containerList.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,dataset){var partially=0,authorized=0,lines=dataset&&dataset.data;_.forEach(lines,function(line){if(line&&line.status)switch(line.status){case 1:partially++;break;case 2:authorized++}}),$(this).find(".datatable-wrapper h2").append(counterTpl([{id:"authorized-list",label:__("Authorized proctors"),count:authorized},{id:"partially-list",label:__("Partially authorized proctors"),count:partially
}])),loadingBar.stop()}).datatable({url:proctorsDataUrl,status:{empty:__("No assigned proctors"),available:__("Assigned proctors"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$containerList.datatable("refresh")}},{id:"create",icon:"add",title:__("Creates and authorizes proctor"),label:__("Create Proctor"),action:function(){var selection=list.getSelection();proctorForm({renderTo:$containerForm,testCenterList:list}).on("destroy",function(){pageMode=_modes.LIST,processMode(list.getSelection())}),pageMode=_modes.FORM,processMode(selection)}},{id:"authorize",icon:"authorize",title:__("Authorize the selected proctors"),
label:__("Authorize"),massAction:!0,action:function(selection){authorize(selection,__("The proctors will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:__("Revoke authorization for the selected proctors"),label:__("Revoke"),massAction:!0,action:function(selection){revoke(selection,__("The proctors will be revoked. Continue ?"))}}],actions:[{id:"authorize",icon:"authorize",title:__("Authorize the proctor"),hidden:function(){return 2===this.status},action:function(id){authorize([id],__("The proctor will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:__("Revoke the proctor"),hidden:function(){return!this.status},action:function(id){
revoke([id],__("The proctor will be revoked. Continue ?"))}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"login",label:__("Login")},{id:"state",label:__("Status"),transform:function(value,row){return statusTpl({testCenters:row.authorized,partially:1===row.status,authorized:2===row.status})}}]},[]),loadingBar.stop()}};return taoProctoringCtlr}),define("tpl!taoProctoring/templates/reporting/datepicker",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";
return buffer+='<form class="datepicker">\n    <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"From",options):helperMissing.call(depth0,"__","From",options)))+'</label><input type="text" name="periodStart" value="',(helper=helpers.start)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.start,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>\n    <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"to",options):helperMissing.call(depth0,"__","to",options)))+'</label><input type="text" name="periodEnd" value="',
(helper=helpers.end)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.end,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>\n    <button class="small info" data-control="filter"><span class="icon icon-reset"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Refresh",options):helperMissing.call(depth0,"__","Refresh",options)))+"</button>\n</form>"})}),define("tpl!taoProctoring/templates/reporting/irregularities",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <li class="irregularity">\n        <span class="timestamp">',(helper=helpers.timestamp)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.timestamp,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n        <span class="type">',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.reason,{
hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.comment,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </li>\n"}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="reason">[',(helper=helpers.reason)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.reason,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>]"}function program4(depth0,data){
var stack1,helper,buffer="";return buffer+='- <span class="comment">',(helper=helpers.comment)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comment,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<ul class="irregularities plain">\n',stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</ul>"})}),define("taoProctoring/controller/Reporting/index",["jquery","lodash","i18n","helpers","layout/loading-bar","util/encode","moment","tpl!taoProctoring/templates/reporting/datepicker","tpl!taoProctoring/templates/reporting/irregularities","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","taoProctoring/helper/status","ui/datatable","jqueryui","jquery.timePicker"],function($,_,__,helpers,loadingBar,encode,moment,datepickerTpl,irregularitiesTpl,feedback,dialog,breadcrumbsFactory,_status){"use strict";function dateRangePicker(date,$container,$list){function refresh(){$list.datatable("options",{params:{periodStart:periodStart,periodEnd:periodEnd
}}).datatable("refresh")}var $panel=$container.find(".panel"),periodStart=date,periodEnd=date;$panel.append(datepickerTpl({start:periodStart,end:periodEnd}));var $periodStart=$panel.find("input[name=periodStart]"),$periodEnd=$panel.find("input[name=periodEnd]"),$filterBtn=$panel.find('[data-control="filter"]');$periodStart.datepicker({dateFormat:"yy-mm-dd",autoSize:!0}).change(function(){periodStart=$periodStart.val(),$periodEnd.datepicker("option","minDate",periodStart),refresh()}),$periodEnd.datepicker({dateFormat:"yy-mm-dd",autoSize:!0}).change(function(){periodEnd=$periodEnd.val(),$periodStart.datepicker("option","maxDate",periodEnd),refresh()}),$filterBtn.on("click",function(event){
event.preventDefault(),periodStart=$periodStart.val(),periodEnd=$periodEnd.val(),refresh()})}var cssScope=".reporting-index";loadingBar.start();var taoProctoringReportCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),printReportButton=$container.data("printreportbutton"),categories=$container.data("categories"),testCenterId=$container.data("testcenter"),serviceUrl=(helpers._url("download","Reporting","taoProctoring",{testCenter:testCenterId}),helpers._url("reports","Reporting","taoProctoring",{testCenter:testCenterId})),notYet=(breadcrumbsFactory($container,crumbs),
function(){dialog({message:__("Not yet implemented!"),autoRender:!0,autoDestroy:!0,buttons:"ok"})}),printResults=function(rowId){window.open(helpers._url("printReport","Reporting","taoProctoring",{id:rowId}),"printReport"+JSON.stringify(rowId))},printRubric=function(rowId){window.open(helpers._url("printRubric","Reporting","taoProctoring",{id:rowId}),"printRubric"+JSON.stringify(rowId))},today=moment().format("YYYY-MM-DD"),datatableTools=[{id:"download",icon:"download",title:__("Download the selected reports to a CSV file"),label:__("Download CSV"),action:function(){notYet()}},{id:"printRubric",title:__("Print rubric block with item tagged with tao-print tag"),
icon:"print",label:__("Print Score Report"),massAction:!0,action:printRubric}];printReportButton&&datatableTools.push({id:"printReport",title:__("Print the assessment results"),icon:"print",label:__("Print results"),massAction:!0,action:printResults});var datatableActions={printRubrick:{id:"printRubric",title:__("Print rubric block with item tagged with tao-print tag"),icon:"print",label:__("Print Score Report"),action:printRubric}};printReportButton&&(datatableActions.printReport={id:"printReport",title:__("Print the assessment results"),icon:"print",label:__("Print results"),action:printResults}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){
loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No reports to display!"),available:__("Available reports"),loading:__("Loading")},tools:datatableTools,selectable:!0,actions:datatableActions,model:[{id:"delivery",label:__("Test")},{id:"testtaker",label:__("Test Taker")},{id:"proctor",label:__("Proctor")},{id:"status",label:__("Status"),transform:function(value){var status=_status.getStatusByCode(value);return status?status.label:""}},{id:"start",label:__("Start")},{id:"end",label:__("End")},{id:"pause",label:__("Pause #")},{id:"resume",label:__("Resume #")},{id:"irregularities",label:__("Irregularities"),transform:function(value){return _.forEach(value,function(log){
var cat=categories[log.type];switch(log[log.type]=!0,log.type){case"pause":log.type=__("Pause");break;case"resume":log.type=__("Resume");break;case"terminate":log.type=__("Terminate");break;default:log.type=__("Irregularity")}cat&&(log.reason="",log.category&&(log.reason+=log.category),log.subCategory&&(log.reason+="/"+log.subCategory))}),irregularitiesTpl(value)}}],params:{periodStart:today,periodEnd:today}},dataset),dateRangePicker(today,$container,$list)}};return taoProctoringReportCtlr}),define("tpl!taoProctoring/templates/testSiteAdmin/adminLink",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<a href="',(helper=helpers.href)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.href,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="admin-link">\n    <span class="icon-users"></span>\n    '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Manage Proctors",options):helperMissing.call(depth0,"__","Manage Proctors",options)))+"\n</a>";
})}),define("taoProctoring/controller/TestCenter/index",["jquery","i18n","helpers","layout/loading-bar","ui/listbox","taoProctoring/component/breadcrumbs","tpl!taoProctoring/templates/testSiteAdmin/adminLink"],function($,__,helpers,loadingBar,listBox,breadcrumbsFactory,adminLinkTpl){"use strict";var cssScope=".testcenters-index";loadingBar.start();var taoProctoringIndexCtlr={start:function(){var $container=$(cssScope),admin=$container.data("administrator"),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),list=listBox({title:__("My Test sites"),textEmpty:__("No test site available"),textNumber:__("Available"),textLoading:__("Loading"),renderTo:$container.find(".content"),
replace:!0}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("index","TestCenter","taoProctoring")),adminUrl=helpers._url("index","ProctorManager","taoProctoring"),update=function(boxes){list.update(boxes),loadingBar.stop()},refresh=function(){loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})};boxes?update(boxes):refresh(),admin&&$container.find(".header").append(adminLinkTpl({href:adminUrl}))}};return taoProctoringIndexCtlr}),define("taoProctoring/controller/TestCenter/testCenter",["jquery","i18n","helpers","layout/loading-bar","ui/listbox","taoProctoring/component/breadcrumbs"],function($,__,helpers,loadingBar,listBox,breadcrumbsFactory){
"use strict";var cssScope=".testcenters-testcenter";loadingBar.start();var taoProctoringTestSiteCtlr={start:function(){var $container=$(cssScope),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),title=($container.data("id"),$container.data("title")),list=listBox({title:title,textEmpty:!1,textNumber:!1,textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0,width:4}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("testCenter","TestCenter","taoProctoring")),update=function(boxes){list.update(boxes),loadingBar.stop()},refresh=function(){loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",
type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})};boxes?update(boxes):refresh()}};return taoProctoringTestSiteCtlr}),define("tpl!taoProctoring/component/eligibilityEditor/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return" editing"}function program3(depth0,data){return"flex-col-12"}function program5(depth0,data){return"flex-col-6"}function program7(depth0,data){var stack1,helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"for",options):helperMissing.call(depth0,"__","for",options)))+' <span class="delivery-name">',
(helper=helpers.deliveryName)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deliveryName,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span> :"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return buffer+='<div class="eligibility-editor',stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='">\n    <h2 class="title">',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h2>\n\n    <div class="flex-grid ">\n        <div class="',stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' tree-container eligible-delivery">\n            <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Eligible Deliveries",options):helperMissing.call(depth0,"__","Eligible Deliveries",options)))+'</label>\n                <div id="',
(helper=helpers.deliveryTreeId)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deliveryTreeId,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n        <div class="',stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' tree-container eligible-testTaker">\n            <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Eligible Test Takers",options):helperMissing.call(depth0,"__","Eligible Test Takers",options)))+" ",
stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</label>\n                <div id="',(helper=helpers.subjectTreeId)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.subjectTreeId,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n    </div>\n    <div class="actions">\n        <button class="btn btn-info small done">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+'</button>\n        <a href="#" class="btn cancel" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"cancel the action",options):helperMissing.call(depth0,"__","cancel the action",options)))+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+"</a>\n    </div>\n</div>\n"})}),define("css!taoProctoringCss/eligibilityEditor",[],function(){}),define("taoProctoring/component/eligibilityEditor",["jquery","lodash","i18n","helpers","uri","ui/component","generis.tree.select","tpl!taoProctoring/component/eligibilityEditor/layout","ui/feedback","ui/modal","css!taoProctoringCss/eligibilityEditor"],function($,_,__,helpers,uri,component,GenerisTreeSelectClass,layoutTpl,feedback){
"use strict";var _ns=".eligibility-editor",_modalDefaults={width:600},config={dataUrl:helpers._url("getData","GenerisTree","tao")},eligibilityEditorFactory=function(){var eligibilityEditor,testTakerTreeId=_.uniqueId("eligible-testTaker-tree-"),deliveryTreeId=_.uniqueId("eligible-delivery-tree-"),buildTestTakerTree=function(id,url,testTakers){var selected=_.pluck(testTakers,"uri");return new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(selected,uri.encode),serverParameters:{openParentNodes:selected,rootNode:"http://www.tao.lu/Ontologies/TAOSubject.rdf#Subject"},paginate:10})},buildDeliveryTree=function(id,url,deliveries){
var selected=_.pluck(deliveries,"uri");return new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(selected,uri.encode),serverParameters:{openParentNodes:selected,rootNode:"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery"},paginate:10})},destroyModal=function(){eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().modal("destroy").remove()},initModal=function(modalConfig){modalConfig=_.defaults(modalConfig||{},_modalDefaults),eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().addClass("modal").on("closed.modal",destroyModal).modal(modalConfig);
},api={add:function($container){return this.on("render",function(){var self=this,deliveryTree=buildDeliveryTree(deliveryTreeId,this.config.dataUrl),testTakerTree=buildTestTakerTree(testTakerTreeId,this.config.dataUrl);initModal({width:650}),this.$component.on("click"+_ns,".actions .done",function(e){var deliveries=_(deliveryTree.getChecked()).uniq().compact().value(),testTakers=_(testTakerTree.getChecked()).uniq().compact().value();deliveries&&deliveries.length?(self.trigger("ok",{deliveries:deliveries,testTakers:testTakers}),destroyModal()):feedback(self.$component).warning(__("At least one delivery need to be selected to create"))}).on("click"+_ns,".actions .cancel",function(e){
e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Add Eligibility"),editingMode:!1,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId}).render($container)},edit:function($container,deliveryName,testTakers){return this.on("render",function(){var self=this,testTakerTree=buildTestTakerTree(testTakerTreeId,this.config.dataUrl,testTakers);initModal({width:400}),this.$component.on("click"+_ns,".actions .done",function(e){var testTakers=_(testTakerTree.getChecked()).uniq().compact().value();self.trigger("ok",{testTakers:testTakers}),destroyModal()}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),
destroyModal(),self.trigger("cancel")})}).init({title:__("Edit Eligibility"),editingMode:!0,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId,deliveryName:deliveryName}).render($container)}};return eligibilityEditor=component(api,config).setTemplate(layoutTpl)};return eligibilityEditorFactory}),define("tpl!taoProctoring/component/eligibilityTable/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+='\n    <span class="icon-unshield txt-danger" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data
},helper?helper.call(depth0,"This delivery can be launched without authorization",options):helperMissing.call(depth0,"__","This delivery can be launched without authorization",options)))+'"></span>\n'}function program3(depth0,data){var helper,options,buffer="";return buffer+='\n    <span class="icon-shield txt-success" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"This delivery needs proctor authorization",options):helperMissing.call(depth0,"__","This delivery needs proctor authorization",options)))+'"></span>\n'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;return stack1=helpers["if"].call(depth0,depth0&&depth0.byPassProctor,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"})}),define("tpl!taoProctoring/component/eligibilityTable/actions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+='\n    <button class="btn-info small edit" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Enable proctor authorization",options):helperMissing.call(depth0,"__","Enable proctor authorization",options)))+'" data-action="shield">\n        <span class="icon-shield"></span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Proctor",options):helperMissing.call(depth0,"__","Proctor",options)))+"\n    </button>\n"}function program3(depth0,data){var helper,options,buffer="";return buffer+='\n    <button class="btn-info small edit" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove proctor authorization",options):helperMissing.call(depth0,"__","Remove proctor authorization",options)))+'" data-action="unshield">\n        <span class="icon-unshield"></span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Un-Proctor",options):helperMissing.call(depth0,"__","Un-Proctor",options)))+"\n    </button>\n"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;return buffer+='<button class="btn-info small edit" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Edit eligibile test takers",options):helperMissing.call(depth0,"__","Edit eligibile test takers",options)))+'" data-action="edit">\n    <span class="icon-edit"></span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Edit",options):helperMissing.call(depth0,"__","Edit",options)))+"\n</button>\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.byPassProctor,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n\n<button class="btn-info small remove" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove eligibility",options):helperMissing.call(depth0,"__","Remove eligibility",options)))+'" data-action="remove">\n    <span class="icon-bin"></span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Remove",options):helperMissing.call(depth0,"__","Remove",options)))+"\n</button>\n\n"})}),define("css!taoProctoringCss/eligibilityTable",[],function(){}),define("taoProctoring/component/eligibilityTable",["jquery","lodash","i18n","ui/component","helpers","tpl!taoProctoring/component/eligibilityTable/status","tpl!taoProctoring/component/eligibilityTable/actions","css!taoProctoringCss/eligibilityTable.css","ui/datatable"],function($,_,__,component,helpers,statusTpl,actionsTpl){"use strict";var eligibilityTableFactory=function(testCenterId){var eligibilities=[];if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");
return component({},{dataUrl:helpers._url("getEligibilities","TestCenterManager","taoProctoring",{uri:testCenterId})}).on("render",function(){var self=this;this.$component.on("query.datatable",function(){self.trigger("loading")}).on("load.datatable",function(e){self.trigger("loaded")}).on("beforeload.datatable",function(e,dataSet){dataSet&&dataSet.data&&(eligibilities=dataSet.data)}).datatable({url:this.config.dataUrl,status:{empty:__("No Eligible Delivery yet"),available:__("Eligible Deliveries"),loading:__("Loading")},tools:[{id:"add",icon:"add",title:__("Add"),label:__("Add"),action:function(){self.trigger("add",eligibilities)}}],model:[{id:"status",label:"",
transform:function(value,row){return statusTpl(row)}},{id:"deliveryLabel",label:__("Delivery"),transform:function(value,row){return row.delivery.label}},{id:"testTakersCount",label:__("Eligible Test Takers"),transform:function(value,row){return row.testTakers&&row.testTakers.length?row.testTakers.length:0}},{id:"actions",label:__("Actions"),transform:function(value,row){return actionsTpl(row)}}],selectable:!1}).on("click",".actions button",function(e){e.preventDefault();var $button=$(this),itemId=$button.parents("[data-item-identifier]").data("item-identifier"),action=$button.data("action");self.trigger(action,itemId,eligibilities)})}).on("reload",function(){
this.$component&&this.$component.datatable("refresh")})};return eligibilityTableFactory}),define("taoProctoring/provider/eligibility",["jquery","lodash","helpers","core/promise"],function($,_,helpers,Promise){"use strict";var request=function(action,parameters){return $.ajax({url:helpers._url(action,"TestCenterManager","taoProctoring"),data:parameters,dataType:"json",type:"POST"})};return function(testCenterId){if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");return{addEligibilities:function(eligibilities){return new Promise(function(resolve,reject){return _.isPlainObject(eligibilities)?void request("addEligibilities",{
uri:testCenterId,eligibility:eligibilities}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))}):reject(new TypeError("Invalid eligibility"))})},editEligibility:function(eligibility){return new Promise(function(resolve,reject){return _.isPlainObject(eligibility)?void request("editEligibilities",{uri:testCenterId,eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))}):reject(new TypeError("Invalid eligibility"))})},removeEligibility:function(eligibility){return new Promise(function(resolve,reject){return _.isPlainObject(eligibility)?void request("removeEligibilities",{uri:testCenterId,
eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))}):reject(new TypeError("Invalid eligibility"))})},shieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request("shieldEligibility",{uri:testCenterId,eligibility:eligibilityId}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},unshieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request("unshieldEligibility",{uri:testCenterId,
eligibility:eligibilityId}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})}}}}),define("taoProctoring/controller/TestCenterManager/editCenter",["jquery","lodash","i18n","layout/loading-bar","ui/feedback","taoProctoring/component/eligibilityEditor","taoProctoring/component/eligibilityTable","taoProctoring/provider/eligibility"],function($,_,__,loadingBar,feedback,eligibilityEditorFactory,eligibilityTableFactory,eligibilityProvider){"use strict";var cssScope=".eligible-deliveries",editCenterCtlr={start:function(){var eligibilityTable,$container=$(cssScope),$tableContainer=$(".eligibility-table-container",$container),$editorContainer=$(".eligibility-editor-container",$container),testCenterId=$container.data("testcenter"),loading=function(){
loadingBar.start()},loaded=function(){loadingBar.stop()},handleError=function(err){loaded(),feedback().error(err.message)},success=function(message){loaded(),feedback().success(message),eligibilityTable.trigger("reload")};eligibilityTable=eligibilityTableFactory(testCenterId).on("loading",loading).on("loaded",loaded).on("add",function(){var self=this;eligibilityEditorFactory().add($editorContainer).on("ok",function(eligibility){loading(),eligibilityProvider(testCenterId).addEligibilities(eligibility).then(function(response){loaded(),response.failed&&response.failed.length?feedback().warning(__("The following delivery(ies) are already eligible : ")+response.failed.join(", ")):feedback().success(__("New eligible delivery added")),
self.trigger("reload")})["catch"](handleError)})}).on("edit",function(eligibilityId,eligibilities){var eligibility=_.find(eligibilities,{uri:eligibilityId});eligibilityEditorFactory().edit($editorContainer,eligibility.delivery.label,eligibility.testTakers).on("ok",function(updated){loading(),eligibilityProvider(testCenterId).editEligibility({deliveries:[eligibility.delivery.uri],testTakers:updated.testTakers}).then(function(response){success(__("Eligible test takers updated"))})["catch"](handleError)})}).on("remove",function(eligibilityId,eligibilities){var eligibility=_.find(eligibilities,{uri:eligibilityId});loading(),eligibilityProvider(testCenterId).removeEligibility({
deliveries:[eligibility.delivery.uri]}).then(function(){success(__("Eligible delivery removed"))})["catch"](handleError)}).on("shield",function(eligibilityId){loading(),eligibilityProvider(testCenterId).shieldEligibility(eligibilityId).then(function(){success(__("Eligibility needs proctor authorization"))})["catch"](handleError)}).on("unshield",function(eligibilityId){loading(),eligibilityProvider(testCenterId).unshieldEligibility(eligibilityId).then(function(){success(__("Eligibility don't need proctor authorization any more."))})["catch"](handleError)}).init({}).render($tableContainer)}};return editCenterCtlr}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");
s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}('.diagnostics-main-area{max-width:768px;margin:40px auto 0 auto;background:#f2f0ee;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;padding:20px}.diagnostics-main-area h1,.diagnostics-main-area h2,.diagnostics-main-area h3{font-style:normal;font-family:"Century Gothic",CenturyGothic,AppleGothic,sans-serif}.diagnostics-main-area h1{margin-bottom:20px;font-size:20px;font-size:2rem}.diagnostics-main-area h2{margin:0;font-size:14px;font-size:1.4rem}.diagnostics-main-area h3{margin-top:10px;margin-bottom:5px;font-size:12px;font-size:1.2rem}.diagnostics-main-area .status h2,.diagnostics-main-area .details h2{margin:1rem 0}.diagnostics-main-area .legend{font-style:italic;font-weight:normal;font-family:"Century Gothic",CenturyGothic,AppleGothic,sans-serif;font-size:11px;font-size:1.1rem}.diagnostics-main-area .quality-bar{height:15px;background:linear-gradient(to right, #CE1431 0%, #D57915 25%, #D5A215 50%, #D5CB15 75%, #36B111 100%);opacity:.8;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;margin:5px 0 10px;position:relative}.diagnostics-main-area .quality-indicator{position:absolute;border-width:10px 8px;border-style:solid;border-color:#333 transparent transparent;top:-1px;height:25px;width:0}.diagnostics-main-area .quality-indicator[title]:before{font-size:11px;font-size:1.1rem;content:attr(title);position:absolute;top:-36px;left:-12px;text-align:center;width:24px;height:24px;line-height:24px;display:inline-block;background-color:#0e5d91;color:rgba(255,255,255,0.9);-moz-border-radius:12px;-webkit-border-radius:12px;border-radius:12px}.diagnostics-main-area .quality-indicator.wide[title]:before{left:-16px;width:32px}.diagnostics-main-area [data-result],.diagnostics-main-area .bandwidth-box{display:none}.diagnostics-main-area [data-action=bandwidth-launcher]{margin:5px 0 10px}.diagnostics-main-area li{padding-bottom:10px}.diagnostics-main-area .intro{margin-bottom:20px}.diagnostics-main-area table.matrix{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;margin-top:5px}\n/*# sourceMappingURL=diagnostics.css.map */\n.eligibility-editor h2.title{margin-top:0}.eligibility-editor .tree-container label{top:10px}.eligibility-editor .tree{border:none}.eligibility-editor .eligible-delivery{margin-left:0}.eligibility-editor.editing .eligible-delivery{display:none}.eligibility-editor.editing .eligible-testTaker{margin-left:0}.eligibility-editor.editing .eligible-testTaker .delivery-name{font-weight:bold}.eligibility-editor .actions{margin-top:20px}.eligibility-editor .actions .btn{float:right;margin-left:20px}.eligibility-editor .actions .btn.cancel{position:relative;top:3px}\n/*# sourceMappingURL=eligibilityEditor.css.map */\n.eligible-deliveries th:last-child{text-align:center}.eligible-deliveries td.status{text-align:center;width:48px}.eligible-deliveries td.status>span{font-size:18px;font-size:1.8rem;vertical-align:bottom}\n/*# sourceMappingURL=eligibilityTable.css.map */\n');
//# sourceMappingURL=controllers.min.js.map