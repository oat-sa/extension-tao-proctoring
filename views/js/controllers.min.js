define("taoProctoring/controller/routes",{TestCenter:{actions:{index:"controller/TestCenter/index",testCenter:"controller/TestCenter/testCenter"}},TestCenterManager:{actions:{editCenter:"controller/TestCenterManager/editCenter"}},ProctorManager:{actions:{index:"controller/ProctorManager/index"}},Diagnostic:{actions:{index:"controller/Diagnostic/index"}},Reporting:{actions:{index:"controller/Reporting/index"}},Delivery:{actions:{index:"controller/Delivery/index",manage:"controller/Delivery/manage",monitoring:"controller/Delivery/monitoring",monitoringAll:"controller/Delivery/monitoring",testTakers:"controller/Delivery/testTakers"}}}),define("taoProctoring/helper/status",["lodash","i18n"],function(_,__){
"use strict";function getStatus(statusName){return _status[statusName]}function getStatusByCode(statusCode){return _.find(_status,{code:statusCode})}function verifyTestTaker(testTakerData,actionName){var formatted={id:testTakerData.id,label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(testTakerData.state.status);return status&&(formatted.allowed=status.can[actionName]===!0,formatted.allowed||(formatted.reason=status.can[actionName])),formatted}var _status={init:{code:"INIT",label:__("Init"),can:{authorize:__("not awaiting"),pause:__("not in progress"),terminate:!0,report:!0}},awaiting:{code:"AWAITING",label:__("Awaiting"),
can:{authorize:!0,pause:__("not in progress"),terminate:!0,report:!0}},authorized:{code:"AUTHORIZED",label:__("Authorized but not started"),can:{authorize:__("already authorized"),pause:__("not started"),terminate:!0,report:!0}},inprogress:{code:"INPROGRESS",label:__("In Progress"),can:{authorize:__("already authorized"),pause:!0,terminate:!0,report:!0}},paused:{code:"PAUSED",label:__("Paused"),can:{authorize:__("is paused"),pause:__("is already paused"),terminate:!0,report:!0}},completed:{code:"COMPLETED",label:__("Completed"),can:{authorize:__("is completed"),pause:__("is completed"),terminate:__("is completed"),report:__("is completed")}},terminated:{code:"TERMINATED",
label:__("Terminated"),can:{authorize:__("is terminated"),pause:__("is terminated"),terminate:__("is terminated"),report:__("is terminated")}}};return{getStatus:getStatus,getStatusByCode:getStatusByCode,verifyTestTaker:verifyTestTaker}}),define("taoProctoring/component/breadcrumbs",["ui/breadcrumbs"],function(breadcrumbs){return function($container,crumbs){return breadcrumbs({breadcrumbs:crumbs||$container.data("breadcrumbs"),renderTo:$container.find(".header"),replace:!0,cls:"action-bar horizontal-action-bar"})}}),define("tpl!taoProctoring/templates/delivery/listBoxActions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<span class="listbox-actions">\n    <span class="action pause" data-delivery="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n        <span class="icon-pause"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'\n    </span>\n    <span class="action play">\n        <span class="icon-play"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Monitor",options):helperMissing.call(depth0,"__","Monitor",options)))+"\n    </span>\n</span>"})}),define("tpl!taoProctoring/templates/delivery/listBoxStats",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n<ul class="plain listbox-properties">\n    <li>\n        <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start",options):helperMissing.call(depth0,"__","Start",options)))+"</label>: ",(helper=helpers.periodStart)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.periodStart,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </li>\n    <li>\n        <label>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"End",options):helperMissing.call(depth0,"__","End",options)))+"</label>: ",(helper=helpers.periodEnd)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.periodEnd,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </li>\n</ul>\n"}this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return stack1=helpers["if"].call(depth0,depth0&&depth0.showProperties,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n<p class="listbox-stats">\n    <span class="icon-lock"></span><span class="number">',(helper=helpers.locked)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.locked,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span class="icon-play"></span><span class="number">',
(helper=helpers.inProgress)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.inProgress,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span class="icon-pause"></span><span class="number">',(helper=helpers.paused)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.paused,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</p>"})}),define("taoProctoring/controller/Delivery/index",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/listbox","util/encode","ui/feedback","ui/bulkActionPopup","ui/cascadingComboBox","taoProctoring/helper/status","taoProctoring/component/breadcrumbs","tpl!taoProctoring/templates/delivery/listBoxActions","tpl!taoProctoring/templates/delivery/listBoxStats"],function(_,$,__,helpers,loadingBar,listBox,encode,feedback,bulkActionPopup,cascadingComboBox,_status,breadcrumbsFactory,actionsTpl,statsTpl){
"use strict";var refreshPolling=6e4,cssScope=".delivery-index";loadingBar.start();var taoProctoringCtlr={start:function(){function format(boxes){return _.each(boxes,function(box){var props=box.properties,tplData={locked:box.stats.awaitingApproval,inProgress:box.stats.inProgress,paused:box.stats.paused};props&&props.periodStart&&props.periodEnd&&(tplData.showProperties=!0,tplData.periodStart=props.periodStart,tplData.periodEnd=props.periodEnd,box.cls="has-properties-displayed"),box.html=actionsTpl({id:box.id}),box.content=statsTpl(tplData)}),boxes}function update(boxes){pollTo&&(clearTimeout(pollTo),pollTo=null),list.update(format(boxes)),loadingBar.stop(),refreshPolling&&(pollTo=setTimeout(refresh,refreshPolling));
}function refresh(){loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(boxes){update(boxes)})}function pause(deliveryId,selection){var allowed=_.map(selection,function(data){return{id:data.id,label:data.testTaker.firstName+" "+data.testTaker.lastName}});bulkActionPopup({renderTo:$container,actionName:__("Pause Session"),reason:!0,resourceType:"test taker",categoriesSelector:cascadingComboBox({categoriesDefinitions:categories.pause.categoriesDefinitions,categories:categories.pause.categories}),allowedResources:allowed}).on("ok",function(reason){$.ajax({url:helpers._url("pauseExecutions","Delivery","taoProctoring"),
data:{delivery:deliveryId,testCenter:testCenterId,execution:_.pluck(selection,"id"),reason:reason},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success("Selected deliveries successfully paused"),refresh()):feedback().warning(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})})})}var $container=$(cssScope),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),categories=$container.data("categories"),testCenterId=$container.data("testcenter"),list=listBox({title:__("Sessions"),textEmpty:__("No sessions available"),textNumber:__("Available"),
textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0,list:format(boxes),width:12,countRenderer:function(count){return count-1}}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("deliveries","Delivery","taoProctoring",{testCenter:testCenterId})),pollTo=null;$container.on("click",".pause",function(e){var deliveryId=$(this).data("delivery"),pauseUrl="all"===deliveryId?helpers._url("allDeliveriesExecutions","Delivery","taoProctoring",{testCenter:testCenterId}):helpers._url("deliveryExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId});e.stopPropagation(),e.preventDefault(),$.get(pauseUrl,function(res){
if(_.isPlainObject(res)&&_.isArray(res.data)){var inProgressExecs=_.filter(res.data,function(data){return data.state&&data.state.status===_status.getStatus("inprogress").code});inProgressExecs.length?pause(deliveryId,inProgressExecs):feedback().info(__("There is no delivery in progress"))}})}),boxes?loadingBar.stop():refresh()}};return taoProctoringCtlr}),define("taoProctoring/controller/Delivery/manage",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory){"use strict";var cssScope=".delivery-manager";
loadingBar.start();var proctorDeliveryIndexCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),assignUrl=helpers._url("testTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),removeUrl=helpers._url("removeTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),monitoringUrl=helpers._url("monitoring","Delivery","taoProctoring",{
delivery:deliveryId,testCenter:testCenterId}),request=(breadcrumbsFactory($container,crumbs),function(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}),remove=function(selection){request(removeUrl,selection,__("Test takers have been removed"))};$list.on("query.datatable",function(){loadingBar.start();
}).on("load.datatable",function(){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No assigned test takers"),available:__("Assigned test takers"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"back",icon:"preview",title:__("Return to the session monitoring"),label:__("Monitoring"),action:function(){location.href=monitoringUrl}},{id:"assign",icon:"add",title:__("Assign more test takers to this session"),label:__("Add test takers"),action:function(){location.href=assignUrl}},{id:"remove",icon:"remove",title:__("Remove the selected test takers from the session"),
label:__("Remove"),massAction:!0,action:function(selection){dialog({message:__("The test takers will be removed from this session. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}],actions:[{id:"remove",icon:"remove",title:__("Remove the test taker from the session"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The test taker will be removed from this session. Continue ?"),onOkBtn:function(){remove([id])}})}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")},{id:"status",label:__("Status")}]},dataset)}};return proctorDeliveryIndexCtlr;
}),define("tpl!taoProctoring/templates/delivery/itemProgress",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.position,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.label,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"}function program2(depth0,data){var stack1,helper,options,buffer="";return buffer+='<span class="state section-progress">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"section",options):helperMissing.call(depth0,"__","section",options)))+" ",(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.total,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>"}function program3(depth0,data){var stack1,helper,buffer="";return buffer+="/",(helper=helpers.total)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.total,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)}function program5(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="state section-label">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}function program7(depth0,data){var stack1,buffer="";return buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.position,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["with"].call(depth0,depth0&&depth0.time,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"}function program8(depth0,data){var stack1,helper,options,buffer="";return buffer+='<span class="state item-progress">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"item",options):helperMissing.call(depth0,"__","item",options)))+" ",(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.total,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>"}function program10(depth0,data){var stack1,buffer="";return buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.display,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program11(depth0,data){var stack1,buffer="";return buffer+='\n    <span class="item-time">\n        <span class="icon icon-time"></span>\n            ',
stack1=helpers["if"].call(depth0,depth0&&depth0.elapsedStr,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.totalStr,{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </span>\n        "}function program12(depth0,data){var stack1,helper,options,buffer="";return buffer+='<span class="elapsed" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Elapsed time",options):helperMissing.call(depth0,"__","Elapsed time",options)))+'">',
(helper=helpers.elapsedStr)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.elapsedStr,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}function program14(depth0,data){var stack1,helper,options,buffer="";return buffer+='<span class="total" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Total time",options):helperMissing.call(depth0,"__","Total time",options)))+'">',(helper=helpers.totalStr)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.totalStr,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+='<span class="progress">\n',stack1=helpers["with"].call(depth0,depth0&&depth0.section,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",stack1=helpers["with"].call(depth0,depth0&&depth0.item,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</span>"})}),define("tpl!taoProctoring/templates/delivery/deliveryLink",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<a class="elipsis" href="',(helper=helpers.url)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.url,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="',(helper=helpers.label)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</a>"})}),define("taoProctoring/controller/Delivery/monitoring",["jquery","lodash","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","ui/bulkActionPopup","ui/cascadingComboBox","taoProctoring/component/breadcrumbs","taoProctoring/helper/status","tpl!taoProctoring/templates/delivery/itemProgress","tpl!taoProctoring/templates/delivery/deliveryLink","ui/datatable"],function($,_,__,helpers,loadingBar,encode,feedback,dialog,bulkActionPopup,cascadingComboBox,breadcrumbsFactory,_status,itemProgressTpl,deliveryLinkTpl){
"use strict";var cssScope=".delivery-monitoring";loadingBar.start();var proctorDeliveryIndexCtlr={start:function(){function request(url,selection,reason,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{execution:selection,reason:reason},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}function authorise(selection){execBulkAction("authorize",__("Authorize Session"),selection,function(selection,reason){
request(authoriseUrl,selection,reason,__("Sessions authorized"))})}function pause(selection){execBulkAction("pause",__("Pause Session"),selection,function(selection,reason){request(pauseUrl,selection,reason,__("Sessions paused"))})}function terminate(selection){execBulkAction("terminate",__("Terminate Session"),selection,function(selection,reason){request(terminateUrl,selection,reason,__("Sessions terminated"))})}function report(selection){execBulkAction("report",__("Report Irregularity"),selection,function(selection,reason){request(reportUrl,selection,reason,__("Sessions reported"))})}function verifyTestTaker(testTakerData,actionName){var formatted={id:testTakerData.id,
label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(testTakerData.state.status);return status&&(formatted.allowed=status.can[actionName]===!0,formatted.allowed||(formatted.reason=status.can[actionName])),formatted}function getExecutionData(uri){return _.find(dataset.data,{id:uri})}function execBulkAction(actionName,actionTitle,selection,cb){var allowedTestTakers=[],forbiddenTestTakers=[],_selection=_.isArray(selection)?selection:[selection],askForReason=categories[actionName]&&categories[actionName].categoriesDefinitions&&categories[actionName].categoriesDefinitions.length;_.each(_selection,function(uri){var checkedTestTaker,testTaker=getExecutionData(uri);
testTaker&&(checkedTestTaker=verifyTestTaker(testTaker,actionName),checkedTestTaker.allowed?allowedTestTakers.push(checkedTestTaker):forbiddenTestTakers.push(checkedTestTaker))});var config={renderTo:$content,actionName:actionTitle,reason:askForReason,resourceType:"test taker",categoriesSelector:cascadingComboBox(categories[actionName]),allowedResources:allowedTestTakers,deniedResources:forbiddenTestTakers};bulkActionPopup(config).on("ok",function(reason){_.isFunction(cb)&&cb(_selection,reason)})}var actionButtons,$container=$(cssScope),$content=$container.find(".content"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),categories=$container.data("categories"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),manageUrl=helpers._url("manage","Delivery","taoProctoring",{
delivery:deliveryId,testCenter:testCenterId}),terminateUrl=helpers._url("terminateExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),pauseUrl=helpers._url("pauseExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),authoriseUrl=helpers._url("authoriseExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),reportUrl=helpers._url("reportExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryExecutions","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),serviceAllUrl=helpers._url("allDeliveriesExecutions","Delivery","taoProctoring",{
testCenter:testCenterId}),tools=[],actions=[],model=[];breadcrumbsFactory($container,crumbs);tools.push({id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}}),deliveryId&&tools.push({id:"manage",icon:"property-advanced",title:__("Manage sessions"),label:__("Manage"),action:function(){location.href=manageUrl}}),tools.push({id:"authorise",icon:"play",title:__("Authorize sessions"),label:__("Authorise"),massAction:!0,action:authorise}),tools.push({id:"pause",icon:"pause",title:__("Pause sessions"),label:__("Pause"),massAction:!0,action:pause}),tools.push({id:"terminate",icon:"stop",title:__("Terminate sessions"),
label:__("Terminate"),massAction:!0,action:terminate}),tools.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularities"),label:__("Report"),massAction:!0,action:report}),actions.push({id:"authorise",icon:"play",title:__("Authorize session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.authorize!==!0):!0},action:authorise}),actions.push({id:"pause",icon:"pause",title:__("Pause session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.pause!==!0):!0},action:pause}),
actions.push({id:"terminate",icon:"stop",title:__("Terminate session"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.terminate!==!0):!0},action:terminate}),actions.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularity"),hidden:function(){var status;return this.state&&this.state.status?(status=_status.getStatusByCode(this.state.status),!status||status.can.report!==!0):!0},action:report}),deliveryId||model.push({id:"delivery",label:__("Session"),transform:function(value,row){var delivery=row&&row.delivery;return delivery&&(delivery.url=helpers._url("monitoring","Delivery","taoProctoring",{
delivery:delivery.uri,testCenter:testCenterId}),value=deliveryLinkTpl(delivery)),value}}),model.push({id:"firstname",label:__("First name"),transform:function(value,row){return row&&row.testTaker&&row.testTaker.firstName||""}}),model.push({id:"lastname",label:__("Last name"),transform:function(value,row){return row&&row.testTaker&&row.testTaker.lastName||""}}),model.push({id:"identifier",label:__("Identifier"),transform:function(value,row){return row&&row.testTaker&&row.testTaker.id||""}}),model.push({id:"date",label:__("Started at")}),model.push({id:"status",label:__("Status"),transform:function(value,row){if(row&&row.state&&row.state.status){var status=_status.getStatusByCode(row.state.status);
if(status)return status.label}return""}}),model.push({id:"progress",label:__("Progress"),transform:function(value,row){return row.state.description}}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,newDataset){dataset=newDataset,actionButtons=_({authorize:$list.find(".action-bar").children(".tool-authorise"),pause:$list.find(".action-bar").children(".tool-pause"),terminate:$list.find(".action-bar").children(".tool-terminate"),report:$list.find(".action-bar").children(".tool-irregularity")}),loadingBar.stop()}).on("select.datatable",function(e,newDataset){actionButtons.each(function($btn){$btn.hide()}),_($list.datatable("selection")).map(function(uri){
var row=getExecutionData(uri);return row.state.status}).uniq().each(function(statusCode){var status=_status.getStatusByCode(statusCode);actionButtons.forIn(function($btn,action){status&&status.can[action]===!0&&$btn.show()})})}).datatable({url:deliveryId?serviceUrl:serviceAllUrl,status:{empty:__("No sessions"),available:__("Current sessions"),loading:__("Loading")},tools:tools,actions:actions,model:model,selectable:!0},dataset)}};return proctorDeliveryIndexCtlr}),define("taoProctoring/controller/Delivery/testTakers",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,breadcrumbsFactory){
"use strict";var cssScope=".delivery-testtakers";loadingBar.start();var proctorDeliveryAssignCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),serviceUrl=helpers._url("availableTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),assignUrl=helpers._url("assignTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),managerUrl=helpers._url("manage","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),assign=(breadcrumbsFactory($container,crumbs),
function(selection){selection&&selection.length&&(loadingBar.start(),$.ajax({url:assignUrl,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success(__("Test takers have been added")),location.href=managerUrl):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))});$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(event,response){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No available test takers to assign"),available:__("Available test takers"),
loading:__("Loading")},tools:[{id:"back",icon:"left",title:__("Return to the session manager"),label:__("Back"),action:function(){location.href=managerUrl}},{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"assign",icon:"add",title:__("Assign the selected test takers to the session"),label:__("Assign the selected test takers"),massAction:!0,action:function(selection){assign(selection)}}],actions:[{id:"assign",icon:"add",title:__("Assign the test taker to the session"),action:function(id){assign([id])}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")
},{id:"identifier",label:__("Identifier")}]},dataset)}};return proctorDeliveryAssignCtlr}),define("taoQtiTest/testRunner/resumingStrategy/keepAfterResume",[],function(){"use strict";var sessionStateFactory=function(options){function _start(){if(null!==_interval)throw new TypeError("Tracking is already started");_interval=setInterval(function(){setLocalStorageData(getLocalStorageData()+_accuracy)},_accuracy)}function _stop(){clearInterval(_interval),_interval=null}function _reset(){_stop(),clearLocalStorage()}function _init(){_accuracy=options&&options.accuracy||1e3}function setLocalStorageData(val){window.localStorage.setItem(_storageKey,val)}function getLocalStorageData(){
var data=window.localStorage.getItem(_storageKey),result=JSON.parse(data)||0;return result}function clearLocalStorage(){window.localStorage.removeItem(_storageKey)}var _accuracy,_storageKey="sessionState_active_for",_interval=null,sessionState={reset:function(){_reset()},restart:function(){_reset(),_start()},getDuration:function(){return getLocalStorageData()}};return _init(),sessionState};return sessionStateFactory}),define("tpl!taoProctoring/templates/deliveryServer/authorizationSuccess",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="success-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'<span class="icon-result-ok"></span></span>'})}),define("taoProctoring/controller/DeliveryServer/awaiting",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/listbox","ui/dialog/alert","core/polling","taoQtiTest/testRunner/resumingStrategy/keepAfterResume","tpl!taoProctoring/templates/deliveryServer/authorizationSuccess"],function(_,$,__,helpers,loadingBar,listBox,dialogAlert,polling,keepAfterResume,authSuccessTpl){
"use strict";var refreshPolling=1e4,cssScope=".awaiting-authorization",awaitingAuthorizationCtlr={start:function(config){function authorized(){loadingBar.stop(),$container.removeClass("authorization-in-progress"),$content.html(authSuccessTpl({message:__("Authorized, you may proceed")}))}function exit(){location.href=config.returnUrl}var $container=$(cssScope),isAuthorizedUrl=helpers._url("isAuthorized","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),runDeliveryUrl=helpers._url("runDeliveryExecution","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),boxes=[{id:"goToDelivery",label:config.deliveryLabel,
url:runDeliveryUrl,content:__("Please wait, authorization in process ..."),text:__("Proceed")}],$content=(listBox({title:__(config.deliveryInit?"Start Test":"Resume Test"),textEmpty:"",textNumber:"",textLoading:"",renderTo:$container,list:boxes,width:12}),$container.find(".listbox .content"));keepAfterResume().reset(),loadingBar.start(),polling({action:function(){var async=this.async();$.get(isAuthorizedUrl,function(result){var stop=!1;result.success?result.authorized&&(stop=!0,authorized()):(stop=!0,result.message?dialogAlert(result.message,exit):exit()),stop?async.reject():async.resolve()})},interval:refreshPolling,autoStart:!0})}};return awaitingAuthorizationCtlr;
}),define("taoProctoring/controller/Diagnostic/index",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory){"use strict";var cssScope=".diagnostic-index";loadingBar.start();var taoProctoringDiagnosticCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),testCenterId=$container.data("testCenter"),serviceUrl=(helpers._url("remove","Diagnostic","taoProctoring",{testCenter:testCenterId}),helpers._url("index","Diagnostic","taoProctoring",{
testCenter:testCenterId})),notYet=(breadcrumbsFactory($container,crumbs),function(){dialog({message:__("Not yet implemented!"),autoRender:!0,autoDestroy:!0,buttons:"ok"})}),remove=function(selection){notYet()};$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No readiness checks have been done!"),available:__("Readiness checks already done"),loading:__("Loading")},tools:[{id:"launch",icon:"play",title:__("Launch another readiness check"),label:__("Launch readiness check"),action:function(){notYet()}},{id:"remove",icon:"remove",title:__("Remove the selected readiness check results"),
label:__("Remove"),massAction:!0,action:function(selection){dialog({message:__("The selected readiness check results will be removed. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}],actions:[{id:"remove",icon:"remove",title:__("Remove the readiness check result?"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The readiness check result will be removed. Continue ?"),onOkBtn:function(){remove([id])}})}}],selectable:!0,model:[{id:"workstation",label:__("Workstation")},{id:"os",label:__("OS")},{id:"browser",label:__("Browser")},{id:"performance",label:__("Performance")},{id:"bandwidth",label:__("Bandwidth"),
transform:function(value){var bandwidth=value;return value>100&&(bandwidth="> 100"),bandwidth+" Mbs"}},{id:"date",label:__("Date")}]},dataset)}};return taoProctoringDiagnosticCtlr}),define("tpl!taoProctoring/component/proctorForm/form",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function";return buffer+='<div class="proctor-form section-container">\n    <div class="content-block">\n        ',(helper=helpers.form)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.form,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n</div>"})}),define("taoProctoring/component/proctorForm",["lodash","jquery","i18n","helpers","users","ui/feedback","ui/component","tpl!taoProctoring/component/proctorForm/form"],function(_,$,__,helpers,users,feedback,component,formTpl){"use strict";function renderFormFromData($container,formData){$container.html(formTpl({form:formData.form})),users.checkLogin(formData.loginId,proctorLoginCheckUrl)}var _ns=".proctor-form",proctorFormUrl=helpers._url("createProctorForm","ProctorManager","taoProctoring"),proctorLoginCheckUrl=helpers._url("checkLogin","ProctorManager","taoProctoring");
return helpers.init(),function(config){return component().on("destroy",function(){this.getElement().off(_ns).empty()}).on("render",function(){var self=this,$element=this.getElement();$.get(proctorFormUrl,function(formData){renderFormFromData($element,formData),$element.on("submit"+_ns,"form",function(e){var $form=$(this),fields=$form.serializeArray(),list=self.config.testCenterList,data={testCenters:list&&list.getSelection()};_.each(fields,function(field){data[field.name]=field.value}),$.post(proctorFormUrl,data,function(res){res.created?(feedback().success(__("Proctor created")),self.destroy()):renderFormFromData($element,res)}),e.preventDefault()}).on("click","button.btn-diasble",function(){
self.destroy()})})}).init(config)}}),define("tpl!taoProctoring/templates/proctorManager/counters",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.count,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="',(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"><span class="text">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>: <span class="count">',(helper=helpers.count)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.count,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span></div>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;
return stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("tpl!taoProctoring/templates/proctorManager/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Authorized",options):helperMissing.call(depth0,"__","Authorized",options)))+' <span class="icon icon-authorize"></span>'}function program3(depth0,data){var stack1,helper,options,buffer="";
return buffer+='<span title="',(helper=helpers.testCenters)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.testCenters,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Partially authorized",options):helperMissing.call(depth0,"__","Partially authorized",options)))+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return stack1=helpers["if"].call(depth0,depth0&&depth0.authorized,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",stack1=helpers["if"].call(depth0,depth0&&depth0.partially,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoProctoring/controller/ProctorManager/index",["lodash","jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog/confirm","ui/bulkActionPopup","ui/datalist","taoProctoring/component/breadcrumbs","taoProctoring/component/proctorForm","tpl!taoProctoring/templates/proctorManager/counters","tpl!taoProctoring/templates/proctorManager/status","ui/datatable"],function(_,$,__,helpers,loadingBar,encode,feedback,dialogConfirm,bulkActionPopup,datalist,breadcrumbsFactory,proctorForm,counterTpl,statusTpl){
"use strict";var cssScope=".proctorManager-index",proctorsDataUrl=helpers._url("proctorAuthorizations","ProctorManager","taoProctoring"),authorizeUrl=helpers._url("authorize","ProctorManager","taoProctoring"),unauthorizeUrl=helpers._url("unauthorize","ProctorManager","taoProctoring"),_modes={EMPTY:0,LIST:1,FORM:2};loadingBar.start();var taoProctoringCtlr={start:function(){function request(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testCenters:list.getSelection(),proctors:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),
$containerList.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}function authorize(selection,message){dialogConfirm(message,function(){request(authorizeUrl,selection,__("Proctors authorized"))})}function revoke(selection,message){dialogConfirm(message,function(){request(unauthorizeUrl,selection,__("Proctors revoked"))})}function processMode(selection){if(selection.length)switch(pageMode){case _modes.EMPTY:pageMode=_modes.LIST;case _modes.LIST:$containerList.datatable("options",{params:{testCenters:null}}).datatable("options",{params:{testCenters:selection}}).datatable("refresh");break;
case _modes.FORM:}else _modes.LIST===pageMode?pageMode=_modes.EMPTY:_modes.EMPTY!==pageMode&&feedback().warning(__("You must select at least one test center!"));$noSelection.toggleClass("hidden",_modes.EMPTY!==pageMode),$containerList.toggleClass("hidden",_modes.LIST!==pageMode),$containerForm.toggleClass("hidden",_modes.FORM!==pageMode)}var $container=$(cssScope),$panelSelection=$(".test-center-panel"),$containerList=($(".proctor-panel"),$(".proctor-list")),$containerForm=$(".proctor-create"),$noSelection=$(".proctor-default"),testCenters=$container.data("list"),crumbs=$container.data("breadcrumbs"),pageMode=_modes.EMPTY,list=(breadcrumbsFactory($container,crumbs),
datalist({renderTo:$panelSelection,textNumber:__("Test sites"),labelText:__("Test site"),selectable:!0},testCenters));list.on("select",function(selection){processMode(selection)}),$containerList.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,dataset){var partially=0,authorized=0,lines=dataset&&dataset.data;_.forEach(lines,function(line){if(line&&line.status)switch(line.status){case 1:partially++;break;case 2:authorized++}}),$(this).find(".datatable-wrapper h2").append(counterTpl([{id:"authorized-list",label:__("Authorized proctors"),count:authorized},{id:"partially-list",label:__("Partially authorized proctors"),count:partially
}])),loadingBar.stop()}).datatable({url:proctorsDataUrl,status:{empty:__("No assigned proctors"),available:__("Assigned proctors"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$containerList.datatable("refresh")}},{id:"create",icon:"add",title:__("Creates and authorizes proctor"),label:__("Create Proctor"),action:function(){var selection=list.getSelection();proctorForm({renderTo:$containerForm,testCenterList:list}).on("destroy",function(){pageMode=_modes.LIST,processMode(list.getSelection())}),pageMode=_modes.FORM,processMode(selection)}},{id:"authorize",icon:"authorize",title:__("Authorize the selected proctors"),
label:__("Authorize"),massAction:!0,action:function(selection){authorize(selection,__("The proctors will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:__("Revoke authorization for the selected proctors"),label:__("Revoke"),massAction:!0,action:function(selection){revoke(selection,__("The proctors will be revoked. Continue ?"))}}],actions:[{id:"authorize",icon:"authorize",title:__("Authorize the proctor"),hidden:function(){return 2===this.status},action:function(id){authorize([id],__("The proctor will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:__("Revoke the proctor"),hidden:function(){return!this.status},action:function(id){
revoke([id],__("The proctor will be revoked. Continue ?"))}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"login",label:__("Login")},{id:"state",label:__("Status"),transform:function(value,row){return statusTpl({testCenters:row.authorized,partially:1===row.status,authorized:2===row.status})}}]},[]),loadingBar.stop()}};return taoProctoringCtlr}),define("tpl!taoProctoring/templates/reporting/datepicker",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";
return buffer+='<form class="datepicker">\n    <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"From",options):helperMissing.call(depth0,"__","From",options)))+'</label><input type="text" name="periodStart" value="',(helper=helpers.start)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.start,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>\n    <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"to",options):helperMissing.call(depth0,"__","to",options)))+'</label><input type="text" name="periodEnd" value="',
(helper=helpers.end)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.end,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>\n    <button class="small info" data-control="filter"><span class="icon icon-reset"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Refresh",options):helperMissing.call(depth0,"__","Refresh",options)))+"</button>\n</form>"})}),define("tpl!taoProctoring/templates/reporting/irregularities",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <li class="irregularity">\n        <span class="timestamp">',(helper=helpers.timestamp)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.timestamp,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n        <span class="type">',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.reason,{
hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.comment,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </li>\n"}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="reason">[',(helper=helpers.reason)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.reason,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>]"}function program4(depth0,data){
var stack1,helper,buffer="";return buffer+='- <span class="comment">',(helper=helpers.comment)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comment,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<ul class="irregularities plain">\n',stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</ul>"})}),define("taoProctoring/controller/Reporting/index",["jquery","lodash","i18n","helpers","layout/loading-bar","util/encode","moment","tpl!taoProctoring/templates/reporting/datepicker","tpl!taoProctoring/templates/reporting/irregularities","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","taoProctoring/helper/status","ui/datatable","jqueryui","jquery.timePicker"],function($,_,__,helpers,loadingBar,encode,moment,datepickerTpl,irregularitiesTpl,feedback,dialog,breadcrumbsFactory,_status){"use strict";function dateRangePicker(date,$container,$list){function refresh(){$list.datatable("options",{params:{periodStart:periodStart,periodEnd:periodEnd
}}).datatable("refresh")}var $panel=$container.find(".panel"),periodStart=date,periodEnd=date;$panel.append(datepickerTpl({start:periodStart,end:periodEnd}));var $periodStart=$panel.find("input[name=periodStart]"),$periodEnd=$panel.find("input[name=periodEnd]"),$filterBtn=$panel.find('[data-control="filter"]');$periodStart.datepicker({dateFormat:"yy-mm-dd",autoSize:!0}).change(function(){periodStart=$periodStart.val(),$periodEnd.datepicker("option","minDate",periodStart),refresh()}),$periodEnd.datepicker({dateFormat:"yy-mm-dd",autoSize:!0}).change(function(){periodEnd=$periodEnd.val(),$periodStart.datepicker("option","maxDate",periodEnd),refresh()}),$filterBtn.on("click",function(event){
event.preventDefault(),periodStart=$periodStart.val(),periodEnd=$periodEnd.val(),refresh()})}var cssScope=".reporting-index";loadingBar.start();var taoProctoringReportCtlr={start:function(){var $container=$(cssScope),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),printReportButton=$container.data("printreportbutton"),categories=$container.data("categories"),testCenterId=$container.data("testcenter"),serviceUrl=(helpers._url("download","Reporting","taoProctoring",{testCenter:testCenterId}),helpers._url("reports","Reporting","taoProctoring",{testCenter:testCenterId})),notYet=(breadcrumbsFactory($container,crumbs),
function(){dialog({message:__("Not yet implemented!"),autoRender:!0,autoDestroy:!0,buttons:"ok"})}),printResults=function(rowId){window.open(helpers._url("printReport","Reporting","taoProctoring",{id:rowId}),"printReport"+JSON.stringify(rowId))},printRubric=function(rowId){window.open(helpers._url("printRubric","Reporting","taoProctoring",{id:rowId}),"printRubric"+JSON.stringify(rowId))},today=moment().format("YYYY-MM-DD"),datatableTools=[{id:"download",icon:"download",title:__("Download the selected reports to a CSV file"),label:__("Download CSV"),action:function(){notYet()}},{id:"printRubric",title:__("Print rubric block with item tagged with tao-print tag"),
icon:"print",label:__("Print Score Report"),massAction:!0,action:printRubric}];printReportButton&&datatableTools.push({id:"printReport",title:__("Print the assessment results"),icon:"print",label:__("Print results"),massAction:!0,action:printResults});var datatableActions={printRubrick:{id:"printRubric",title:__("Print rubric block with item tagged with tao-print tag"),icon:"print",label:__("Print Score Report"),action:printRubric}};printReportButton&&(datatableActions.printReport={id:"printReport",title:__("Print the assessment results"),icon:"print",label:__("Print results"),action:printResults}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){
loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No reports to display!"),available:__("Available reports"),loading:__("Loading")},tools:datatableTools,selectable:!0,actions:datatableActions,model:[{id:"delivery",label:__("Test")},{id:"testtaker",label:__("Test Taker")},{id:"proctor",label:__("Proctor")},{id:"status",label:__("Status"),transform:function(value){var status=_status.getStatusByCode(value);return status?status.label:""}},{id:"start",label:__("Start")},{id:"end",label:__("End")},{id:"pause",label:__("Pause #")},{id:"resume",label:__("Resume #")},{id:"irregularities",label:__("Irregularities"),transform:function(value){return _.forEach(value,function(log){
var cat=categories[log.type];switch(log[log.type]=!0,log.type){case"pause":log.type=__("Pause");break;case"resume":log.type=__("Resume");break;case"terminate":log.type=__("Terminate");break;default:log.type=__("Irregularity")}cat&&(log.reason="",log.category&&(log.reason+=log.category),log.subCategory&&(log.reason+="/"+log.subCategory))}),irregularitiesTpl(value)}}],params:{periodStart:today,periodEnd:today}},dataset),dateRangePicker(today,$container,$list)}};return taoProctoringReportCtlr}),define("tpl!taoProctoring/templates/testSiteAdmin/adminLink",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<a href="',(helper=helpers.href)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.href,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="admin-link">\n    <span class="icon-users"></span>\n    '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Manage Proctors",options):helperMissing.call(depth0,"__","Manage Proctors",options)))+"\n</a>";
})}),define("taoProctoring/controller/TestCenter/index",["jquery","i18n","helpers","layout/loading-bar","ui/listbox","taoProctoring/component/breadcrumbs","tpl!taoProctoring/templates/testSiteAdmin/adminLink"],function($,__,helpers,loadingBar,listBox,breadcrumbsFactory,adminLinkTpl){"use strict";var refreshPolling=6e4,cssScope=".testcenters-index";loadingBar.start();var taoProctoringIndexCtlr={start:function(){var $container=$(cssScope),admin=$container.data("administrator"),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),list=listBox({title:__("My Test sites"),textEmpty:__("No test site available"),textNumber:__("Available"),textLoading:__("Loading"),
renderTo:$container.find(".content"),replace:!0}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("index","TestCenter","taoProctoring")),adminUrl=helpers._url("index","ProctorManager","taoProctoring"),pollTo=null,update=function(boxes){pollTo&&(clearTimeout(pollTo),pollTo=null),list.update(boxes),loadingBar.stop(),refreshPolling&&(pollTo=setTimeout(refresh,refreshPolling))},refresh=function(){loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})};boxes?update(boxes):refresh(),admin&&$container.find(".header").append(adminLinkTpl({
href:adminUrl}))}};return taoProctoringIndexCtlr}),define("taoProctoring/controller/TestCenter/testCenter",["jquery","i18n","helpers","layout/loading-bar","ui/listbox","taoProctoring/component/breadcrumbs"],function($,__,helpers,loadingBar,listBox,breadcrumbsFactory){"use strict";var cssScope=".testcenters-testcenter";loadingBar.start();var taoProctoringTestSiteCtlr={start:function(){var $container=$(cssScope),boxes=$container.data("list"),crumbs=$container.data("breadcrumbs"),title=($container.data("id"),$container.data("title")),list=listBox({title:title,textEmpty:!1,textNumber:!1,textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0,width:4
}),serviceUrl=(breadcrumbsFactory($container,crumbs),helpers._url("testCenter","TestCenter","taoProctoring")),update=function(boxes){list.update(boxes),loadingBar.stop()},refresh=function(){loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})};boxes?update(boxes):refresh()}};return taoProctoringTestSiteCtlr}),define("tpl!taoProctoring/component/eligibilityEditor/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return" editing"}function program3(depth0,data){return"flex-col-12";
}function program5(depth0,data){return"flex-col-6"}function program7(depth0,data){var stack1,helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"for",options):helperMissing.call(depth0,"__","for",options)))+' <span class="delivery-name">',(helper=helpers.deliveryName)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deliveryName,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span> :"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return buffer+='<div class="eligibility-editor',stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n    <h2 class="title">',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h2>\n    <div class="flex-grid ">\n        <div class="',
stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' tree-container eligible-delivery">\n            <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Eligible Deliveries",options):helperMissing.call(depth0,"__","Eligible Deliveries",options)))+'</label>\n                <div id="',(helper=helpers.deliveryTreeId)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deliveryTreeId,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n        <div class="',stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' tree-container eligible-testTaker">\n            <label>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Eligible Test Takers",options):helperMissing.call(depth0,"__","Eligible Test Takers",options)))+" ",stack1=helpers["if"].call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</label>\n                <div id="',(helper=helpers.subjectTreeId)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.subjectTreeId,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n    </div>\n    <div class="actions">\n        <button class="btn btn-info small done">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+'</button>\n        <a href="#" class="btn cancel" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"cancel the action",options):helperMissing.call(depth0,"__","cancel the action",options)))+'">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+"</a>\n    </div>\n</div>"})}),define("taoProctoring/component/eligibilityEditor",["lodash","jquery","i18n","helpers","core/eventifier","generis.tree.select","tpl!taoProctoring/component/eligibilityEditor/layout","ui/feedback","ui/modal"],function(_,$,__,helpers,eventifier,GenerisTreeSelectClass,layoutTpl,feedback){"use strict";function buildTestTakerTree(instance,selector,testTakers){
var tree=new GenerisTreeSelectClass(selector,helpers._url("getData","GenerisTree","tao"),{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.pluck(testTakers,"encodedUri"),serverParameters:{openParentNodes:_.pluck(testTakers,"uri"),rootNode:"http://www.tao.lu/Ontologies/TAOSubject.rdf#Subject"},paginate:10,onChangeCallback:function(){_.delay(function(){instance.eligibility.testTakers=_.uniq(tree.getChecked()),instance.trigger("change",instance.eligibility)},100)}});return tree}function buildDeliveryTree(instance,selector,deliveries){var tree=new GenerisTreeSelectClass(selector,helpers._url("getData","GenerisTree","tao"),{
actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.pluck(deliveries,"encodedUri"),serverParameters:{openParentNodes:_.pluck(deliveries,"uri"),rootNode:"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery"},paginate:10,onChangeCallback:function(){_.delay(function(){instance.eligibility.deliveries=_.uniq(tree.getChecked()),instance.trigger("change",instance.eligibility)},100)}});return tree}function initModal(instance,modalConfig){modalConfig=_.defaults(modalConfig||{},_modalDefaults),instance.$container.children(".eligibility-editor").addClass("modal").on("closed.modal",function(){destroy(instance)}).modal(modalConfig).on("click"+_ns,".actions .done",function(e){
instance.eligibility&&instance.eligibility.deliveries&&instance.eligibility.deliveries.length?(instance.trigger("ok",instance.eligibility),destroy(instance)):feedback(instance.$container).warning(__("At least one delivery need to be selected to create"))}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),instance.trigger("cancel"),destroy(instance)})}function destroy(instance){instance.$container.children(".eligibility-editor").modal("destroy").remove()}function init($container,eligibilities,delivery){var $deliverySelector,instance=eventifier({eligibility:{}}),subjectTreeId=_.uniqueId("eligible-testTaker-tree-"),deliveryTreeId=_.uniqueId("eligible-delivery-tree-"),creationMode=!0,deliveryName="";
if(!_.isArray(eligibilities))throw"the egibility editor requires an array of eligibilities";if(delivery&&delivery.uri&&delivery.label){var eligibility=_.find(eligibilities,{delivery:delivery.uri});if(!eligibility)throw"given delivery does not exist in the list of eligibilities";creationMode=!1,deliveryName=delivery.label,instance.eligibility=_.defaults(eligibility,{deliveries:[delivery.uri],testTakers:[]})}return instance.$container=$container,$container.append(layoutTpl({title:__(creationMode?"Add Eligibility":"Edit Eligibility"),editingMode:!creationMode,subjectTreeId:subjectTreeId,deliveryTreeId:deliveryTreeId,deliveryName:deliveryName})),creationMode&&($deliverySelector=$container.find(".eligible-delivery"),
buildDeliveryTree(instance,"#"+deliveryTreeId,[])),buildTestTakerTree(instance,"#"+subjectTreeId,instance.eligibility.testTakers||[]),initModal(instance,{width:creationMode?650:400}),instance}var _ns=".eligibility-editor",_modalDefaults={width:600};return{init:init}}),define("taoProctoring/controller/TestCenterManager/editCenter",["jquery","lodash","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","taoProctoring/component/eligibilityEditor","ui/datatable"],function($,_,__,helpers,loadingBar,encode,feedback,eligibilityEditor){"use strict";function formatEligibilities(dataset){return dataset.data&&_.isArray(dataset.data)?_.map(dataset.data,function(eligibility){
return{delivery:eligibility.id,testTakers:eligibility.testTakers}}):[]}var cssScope=".eligible-deliveries",editCenterCtlr={start:function(){function _getDelivery(uri){return _.find(deliveries,{uri:uri})}function _request(url,eligibility,message,errorCallback){eligibility&&(loadingBar.start(),$.ajax({url:url,data:{eligibility:eligibility},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):_.isFunction(errorCallback)?errorCallback(response):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{
encodeHtml:!1})}))}var eligEditor,$container=$(cssScope),$list=$container.find(".list"),$eligibilityEditor=$container.find(".eligibility-editor-container"),deliveries=$container.data("deliveries"),eligibilities=$container.data("eligibilities"),testCenterId=$container.data("testcenter"),serviceUrl=helpers._url("getEligibilities","TestCenterManager","taoProctoring",{uri:testCenterId}),addUrl=helpers._url("addEligibilities","TestCenterManager","taoProctoring",{uri:testCenterId}),editUrl=helpers._url("editEligibilities","TestCenterManager","taoProctoring",{uri:testCenterId}),removeUrl=helpers._url("removeEligibilities","TestCenterManager","taoProctoring",{uri:testCenterId
}),tools=[],actions=[],model=[];tools.push({id:"add",icon:"add",title:__("Add"),label:__("Add"),action:function(){eligEditor=eligibilityEditor.init($eligibilityEditor,formatEligibilities(eligibilities)),eligEditor.on("ok",function(eligibility){_request(addUrl,eligibility,__("New eligible delivery added"),function(res){feedback().warning(__("The following delivery(ies) are already eligible : ")+res.failed.join(", ")),$list.datatable("refresh")})})}}),actions.push({id:"edit",icon:"edit",label:__("Edit"),title:__("Edit eligibile test takers"),action:function(uri){eligEditor=eligibilityEditor.init($eligibilityEditor,formatEligibilities(eligibilities),_getDelivery(uri)),
eligEditor.on("ok",function(eligibility){_request(editUrl,eligibility,__("Eligible test takers updated"))})}}),actions.push({id:"remove",icon:"bin",label:__("Remove"),title:__("Remove eligibility"),action:function(uri){_request(removeUrl,{deliveries:[uri]},__("Eligible delivery removed"))}}),model.push({id:"del",label:__("Delivery"),transform:function(value,row){return _getDelivery(row.id).label}}),model.push({id:"ttakers",label:__("Eligible Test Takers"),transform:function(value,row){return row.testTakers.length}}),$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,newDataset){eligibilities=newDataset,loadingBar.stop()}).datatable({
url:serviceUrl,status:{empty:__("No Eligible Delivery yet"),available:__("Eligible Deliveries"),loading:__("Loading")},tools:tools,actions:actions,model:model,selectable:!1},eligibilities)}};return editCenterCtlr});
//# sourceMappingURL=controllers.min.js.map